// Code generated by petri-pilot. DO NOT EDIT.

package erc20token

import (
	"encoding/base64"
	"encoding/json"
	"io/fs"
	"net/http"
	"os"
	"path/filepath"
	"strconv"
	"strings"

	"github.com/pflow-xyz/petri-pilot/pkg/runtime/api"
)

// BuildRouter creates an HTTP router for the erc20-token workflow.
func BuildRouter(app *Application) http.Handler {
	r := api.NewRouter()

	// Health check - always returns ok if server is running
	r.GET("/health", "Health check", func(w http.ResponseWriter, r *http.Request) {
		api.JSON(w, http.StatusOK, map[string]string{"status": "ok"})
	})

	// Readiness check - verifies dependencies (database, etc.)
	r.GET("/ready", "Readiness check", HandleReady(app))

	// Create new aggregate
	r.POST("/api/erc20token", "Create new erc20-token", HandleCreate(app))

	// Get aggregate state
	r.GET("/api/erc20token/{id}", "Get erc20-token state", HandleGetState(app))


	// Schema viewer endpoint
	r.GET("/api/schema", "Get model schema", HandleGetSchema())



	// Event replay endpoints
	r.GET("/api/erc20token/{id}/events", "Get event history", HandleGetEvents(app))
	r.GET("/api/erc20token/{id}/at/{version}", "Get state at version", HandleGetStateAtVersion(app))
	r.POST("/api/erc20token/{id}/truncate", "Truncate event history to version", HandleTruncate(app))






















	// Transition endpoints
	r.Transition("transfer", "/api/transfer", "Transfer tokens from sender to recipient", HandleTransfer(app))
	r.Transition("approve", "/api/approve", "Approve spender to transfer tokens on owner's behalf", HandleApprove(app))
	r.Transition("transfer_from", "/api/transfer_from", "Transfer tokens using allowance (delegated transfer)", HandleTransferFrom(app))
	r.Transition("mint", "/api/mint", "Create new tokens and add to recipient balance", HandleMint(app))
	r.Transition("burn", "/api/burn", "Destroy tokens from holder's balance", HandleBurn(app))

	// Serve frontend static files
	r.StaticFiles("/", StaticFileHandler())

	return r.Build()
}

// StaticFileHandler returns an http.Handler that serves static files from frontend/.
// It supports SPA routing by returning index.html for paths that don't match static files.
func StaticFileHandler() http.HandlerFunc {
	// Find frontend directory - try custom frontends first, then generated
	frontendPath := ""
	candidates := []string{
		"frontends/erc20-token",                    // Custom frontend (top priority)
		"frontend",                                    // Running from service directory
		"generated/erc20token/frontend",         // Generated frontend from repo root
		filepath.Join("generated", "erc20token", "frontend"), // Platform-safe
	}

	// Also try relative to executable
	if exe, err := os.Executable(); err == nil {
		exeDir := filepath.Dir(exe)
		candidates = append(candidates,
			filepath.Join(exeDir, "frontends", "erc20-token"),
			filepath.Join(exeDir, "frontend"),
			filepath.Join(exeDir, "generated", "erc20token", "frontend"),
		)
	}

	for _, candidate := range candidates {
		if _, err := os.Stat(candidate); err == nil {
			frontendPath = candidate
			break
		}
	}

	return func(w http.ResponseWriter, r *http.Request) {
		// No frontend found
		if frontendPath == "" {
			http.Error(w, "Frontend not found", http.StatusNotFound)
			return
		}

		// Clean the path
		path := strings.TrimPrefix(r.URL.Path, "/")
		if path == "" {
			path = "index.html"
		}

		// Try to serve the file
		fullPath := filepath.Join(frontendPath, path)

		// Check if file exists
		info, err := os.Stat(fullPath)
		if err != nil || info.IsDir() {
			// File doesn't exist, serve index.html for SPA routing
			http.ServeFile(w, r, filepath.Join(frontendPath, "index.html"))
			return
		}

		http.ServeFile(w, r, fullPath)
	}
}

// StaticFS is a helper interface for embedding static files (optional).
type StaticFS interface {
	fs.FS
}

// HandleCreate creates a new aggregate instance.
func HandleCreate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		id, err := app.Create(ctx)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "CREATE_FAILED", err.Error())
			return
		}

		// Load the new aggregate to get initial state
		agg, err := app.Load(ctx, id)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "LOAD_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusCreated, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleGetState returns the current state of an aggregate.
func HandleGetState(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		if id == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate ID is required")
			return
		}

		agg, err := app.GetState(ctx, id)
		if err != nil {
			api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleReady checks if the application is ready to serve requests.
// Returns 200 if all dependencies are available, 503 otherwise.
func HandleReady(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		checks := make(map[string]string)
		ready := true

		// Check event store connectivity
		if err := app.HealthCheck(r.Context()); err != nil {
			checks["eventstore"] = err.Error()
			ready = false
		} else {
			checks["eventstore"] = "ok"
		}

		status := http.StatusOK
		statusText := "ready"
		if !ready {
			status = http.StatusServiceUnavailable
			statusText = "not ready"
		}

		api.JSON(w, status, map[string]any{
			"status": statusText,
			"checks": checks,
		})
	}
}


// HandleTransfer handles the transfer transition.
func HandleTransfer(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionTransfer, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleApprove handles the approve transition.
func HandleApprove(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionApprove, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleTransferFrom handles the transfer_from transition.
func HandleTransferFrom(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionTransferFrom, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleMint handles the mint transition.
func HandleMint(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionMint, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleBurn handles the burn transition.
func HandleBurn(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionBurn, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}








// HandleGetEvents returns the event history for an aggregate.
func HandleGetEvents(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		from := getIntQueryParam(r, "from", 0)

		events, err := app.store.Read(ctx, id, from)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"events": events,
		})
	}
}

// HandleGetStateAtVersion returns the aggregate state at a specific version.
func HandleGetStateAtVersion(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		versionStr := r.PathValue("version")

		version := getInt(versionStr, 0)
		if version <= 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be a positive integer")
			return
		}

		events, err := app.store.Read(ctx, id, 0)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		// Create temporary aggregate and replay up to version
		agg := NewAggregate(id)
		for _, evt := range events {
			if evt.Version > version {
				break
			}
			if err := agg.Apply(evt); err != nil {
				api.Error(w, http.StatusInternalServerError, "APPLY_FAILED", err.Error())
				return
			}
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":      agg.ID(),
			"version": version,
			"state":   agg.State(),
		})
	}
}

// HandleTruncate truncates the event stream to a specific version.
// This enables "undo and redo differently" workflows by discarding events after the target version.
func HandleTruncate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")

		var req struct {
			Version int `json:"version"`
		}
		if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", "request body must contain version field")
			return
		}

		if req.Version < 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be non-negative")
			return
		}

		agg, err := app.TruncateTo(ctx, id, req.Version)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "TRUNCATE_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":                    agg.ID(),
			"version":               agg.Version(),
			"state":                 agg.State(),
			"enabled_transitions":   agg.EnabledTransitions(),
		})
	}
}





// Helper functions

func getIntQueryParam(r *http.Request, name string, defaultVal int) int {
	val := r.URL.Query().Get(name)
	return getInt(val, defaultVal)
}

func getInt(s string, defaultVal int) int {
	if s == "" {
		return defaultVal
	}

	intVal, err := strconv.Atoi(s)
	if err != nil {
		return defaultVal
	}

	return intVal
}


// HandleGetSchema returns the model schema JSON for the schema viewer.
func HandleGetSchema() http.HandlerFunc {
	// Schema JSON is embedded at generation time (base64 encoded)
	schemaBase64 := "ewogICJuYW1lIjogImVyYzIwLXRva2VuIiwKICAidmVyc2lvbiI6ICIxLjAuMCIsCiAgImRlc2NyaXB0aW9uIjogIkVSQy0yMCBmdW5naWJsZSB0b2tlbiBpbXBsZW1lbnRhdGlvbiB1c2luZyBQZXRyaSBuZXQgc2VtYW50aWNzIiwKICAicGxhY2VzIjogWwogICAgewogICAgICAiaWQiOiAidG90YWxfc3VwcGx5IiwKICAgICAgImRlc2NyaXB0aW9uIjogIlRvdGFsIHRva2VucyBpbiBjaXJjdWxhdGlvbiIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAiZGF0YSIsCiAgICAgICJ0eXBlIjogImludDY0IiwKICAgICAgInBlcnNpc3RlZCI6IHRydWUsCiAgICAgICJpbml0aWFsX3ZhbHVlIjogMAogICAgfSwKICAgIHsKICAgICAgImlkIjogImJhbGFuY2VzIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlRva2VuIGJhbGFuY2UgcGVyIGFkZHJlc3MiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogImRhdGEiLAogICAgICAidHlwZSI6ICJtYXBbc3RyaW5nXWludDY0IiwKICAgICAgImV4cG9ydGVkIjogdHJ1ZSwKICAgICAgInBlcnNpc3RlZCI6IHRydWUKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJhbGxvd2FuY2VzIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlNwZW5kaW5nIGFsbG93YW5jZXM6IG93bmVyIC1cdTAwM2Ugc3BlbmRlciAtXHUwMDNlIGFtb3VudCAobmVzdGVkIG1hcCkiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogImRhdGEiLAogICAgICAidHlwZSI6ICJtYXBbc3RyaW5nXW1hcFtzdHJpbmddaW50NjQiLAogICAgICAiZXhwb3J0ZWQiOiB0cnVlLAogICAgICAicGVyc2lzdGVkIjogdHJ1ZQogICAgfQogIF0sCiAgInRyYW5zaXRpb25zIjogWwogICAgewogICAgICAiaWQiOiAidHJhbnNmZXIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiVHJhbnNmZXIgdG9rZW5zIGZyb20gc2VuZGVyIHRvIHJlY2lwaWVudCIsCiAgICAgICJndWFyZCI6ICJiYWxhbmNlc1tmcm9tXSBcdTAwM2U9IGFtb3VudCIsCiAgICAgICJldmVudCI6ICJ0cmFuc2Zlcl9ldmVudCIsCiAgICAgICJiaW5kaW5ncyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJmcm9tIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAia2V5cyI6IFsKICAgICAgICAgICAgImZyb20iCiAgICAgICAgICBdLAogICAgICAgICAgInBsYWNlIjogImJhbGFuY2VzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidG8iLAogICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICJrZXlzIjogWwogICAgICAgICAgICAidG8iCiAgICAgICAgICBdLAogICAgICAgICAgInBsYWNlIjogImJhbGFuY2VzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYW1vdW50IiwKICAgICAgICAgICJ0eXBlIjogImludDY0IiwKICAgICAgICAgICJ2YWx1ZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZnJvbSIsCiAgICAgICAgICAibGFiZWwiOiAiRnJvbSBBZGRyZXNzIiwKICAgICAgICAgICJ0eXBlIjogImFkZHJlc3MiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICJhdXRvRmlsbCI6ICJ3YWxsZXQiLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlNlbmRlciBhZGRyZXNzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAidG8iLAogICAgICAgICAgImxhYmVsIjogIlRvIEFkZHJlc3MiLAogICAgICAgICAgInR5cGUiOiAiYWRkcmVzcyIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIlJlY2lwaWVudCBhZGRyZXNzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYW1vdW50IiwKICAgICAgICAgICJsYWJlbCI6ICJBbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiYW1vdW50IiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiQW1vdW50IHRvIHRyYW5zZmVyIgogICAgICAgIH0KICAgICAgXSwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvdHJhbnNmZXIiLAogICAgICAiZXZlbnRfdHlwZSI6ICJ0cmFuc2Zlcl9ldmVudCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJhcHByb3ZlIiwKICAgICAgImRlc2NyaXB0aW9uIjogIkFwcHJvdmUgc3BlbmRlciB0byB0cmFuc2ZlciB0b2tlbnMgb24gb3duZXIncyBiZWhhbGYiLAogICAgICAiZXZlbnQiOiAiYXBwcm92YWxfZXZlbnQiLAogICAgICAiYmluZGluZ3MiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAib3duZXIiLAogICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICJrZXlzIjogWwogICAgICAgICAgICAib3duZXIiCiAgICAgICAgICBdLAogICAgICAgICAgInBsYWNlIjogImFsbG93YW5jZXMiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzcGVuZGVyIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAia2V5cyI6IFsKICAgICAgICAgICAgInNwZW5kZXIiCiAgICAgICAgICBdLAogICAgICAgICAgInBsYWNlIjogImFsbG93YW5jZXMiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiLAogICAgICAgICAgInZhbHVlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXSwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJvd25lciIsCiAgICAgICAgICAibGFiZWwiOiAiT3duZXIgQWRkcmVzcyIsCiAgICAgICAgICAidHlwZSI6ICJhZGRyZXNzIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiYXV0b0ZpbGwiOiAid2FsbGV0IiwKICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJUb2tlbiBvd25lciIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInNwZW5kZXIiLAogICAgICAgICAgImxhYmVsIjogIlNwZW5kZXIgQWRkcmVzcyIsCiAgICAgICAgICAidHlwZSI6ICJhZGRyZXNzIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiQWRkcmVzcyB0byBhcHByb3ZlIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYW1vdW50IiwKICAgICAgICAgICJsYWJlbCI6ICJBbGxvd2FuY2UgQW1vdW50IiwKICAgICAgICAgICJ0eXBlIjogImFtb3VudCIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIkFtb3VudCB0byBhcHByb3ZlIgogICAgICAgIH0KICAgICAgXSwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvYXBwcm92ZSIsCiAgICAgICJldmVudF90eXBlIjogImFwcHJvdmFsX2V2ZW50IgogICAgfSwKICAgIHsKICAgICAgImlkIjogInRyYW5zZmVyX2Zyb20iLAogICAgICAiZGVzY3JpcHRpb24iOiAiVHJhbnNmZXIgdG9rZW5zIHVzaW5nIGFsbG93YW5jZSAoZGVsZWdhdGVkIHRyYW5zZmVyKSIsCiAgICAgICJndWFyZCI6ICJiYWxhbmNlc1tmcm9tXSBcdTAwM2U9IGFtb3VudCBcdTAwMjZcdTAwMjYgYWxsb3dhbmNlc1tmcm9tXVtjYWxsZXJdIFx1MDAzZT0gYW1vdW50IiwKICAgICAgImV2ZW50IjogInRyYW5zZmVyX2Zyb21fZXZlbnQiLAogICAgICAiYmluZGluZ3MiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZnJvbSIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgImtleXMiOiBbCiAgICAgICAgICAgICJmcm9tIgogICAgICAgICAgXSwKICAgICAgICAgICJwbGFjZSI6ICJiYWxhbmNlcyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRvIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAia2V5cyI6IFsKICAgICAgICAgICAgInRvIgogICAgICAgICAgXSwKICAgICAgICAgICJwbGFjZSI6ICJiYWxhbmNlcyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNhbGxlciIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgImtleXMiOiBbCiAgICAgICAgICAgICJjYWxsZXIiCiAgICAgICAgICBdLAogICAgICAgICAgInBsYWNlIjogImFsbG93YW5jZXMiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiLAogICAgICAgICAgInZhbHVlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXSwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJmcm9tIiwKICAgICAgICAgICJsYWJlbCI6ICJGcm9tIEFkZHJlc3MiLAogICAgICAgICAgInR5cGUiOiAiYWRkcmVzcyIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIk93bmVyIGFkZHJlc3MiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0byIsCiAgICAgICAgICAibGFiZWwiOiAiVG8gQWRkcmVzcyIsCiAgICAgICAgICAidHlwZSI6ICJhZGRyZXNzIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiUmVjaXBpZW50IGFkZHJlc3MiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjYWxsZXIiLAogICAgICAgICAgImxhYmVsIjogIkNhbGxlciBBZGRyZXNzIiwKICAgICAgICAgICJ0eXBlIjogImFkZHJlc3MiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICJhdXRvRmlsbCI6ICJ3YWxsZXQiLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIllvdXIgYWRkcmVzcyAobXVzdCBoYXZlIGFsbG93YW5jZSkiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgImxhYmVsIjogIkFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJhbW91bnQiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICJwbGFjZWhvbGRlciI6ICJBbW91bnQgdG8gdHJhbnNmZXIiCiAgICAgICAgfQogICAgICBdLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS90cmFuc2Zlcl9mcm9tIiwKICAgICAgImV2ZW50X3R5cGUiOiAidHJhbnNmZXJfZnJvbV9ldmVudCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJtaW50IiwKICAgICAgImRlc2NyaXB0aW9uIjogIkNyZWF0ZSBuZXcgdG9rZW5zIGFuZCBhZGQgdG8gcmVjaXBpZW50IGJhbGFuY2UiLAogICAgICAiZXZlbnQiOiAibWludF9ldmVudCIsCiAgICAgICJiaW5kaW5ncyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0byIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgImtleXMiOiBbCiAgICAgICAgICAgICJ0byIKICAgICAgICAgIF0sCiAgICAgICAgICAicGxhY2UiOiAiYmFsYW5jZXMiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiLAogICAgICAgICAgInZhbHVlIjogdHJ1ZQogICAgICAgIH0KICAgICAgXSwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0byIsCiAgICAgICAgICAibGFiZWwiOiAiUmVjaXBpZW50IEFkZHJlc3MiLAogICAgICAgICAgInR5cGUiOiAiYWRkcmVzcyIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIkFkZHJlc3MgdG8gbWludCB0byIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAibGFiZWwiOiAiQW1vdW50IiwKICAgICAgICAgICJ0eXBlIjogImFtb3VudCIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIkFtb3VudCB0byBtaW50IgogICAgICAgIH0KICAgICAgXSwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvbWludCIsCiAgICAgICJldmVudF90eXBlIjogIm1pbnRfZXZlbnQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAiYnVybiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEZXN0cm95IHRva2VucyBmcm9tIGhvbGRlcidzIGJhbGFuY2UiLAogICAgICAiZ3VhcmQiOiAiYmFsYW5jZXNbZnJvbV0gXHUwMDNlPSBhbW91bnQiLAogICAgICAiZXZlbnQiOiAiYnVybl9ldmVudCIsCiAgICAgICJiaW5kaW5ncyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJmcm9tIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAia2V5cyI6IFsKICAgICAgICAgICAgImZyb20iCiAgICAgICAgICBdLAogICAgICAgICAgInBsYWNlIjogImJhbGFuY2VzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYW1vdW50IiwKICAgICAgICAgICJ0eXBlIjogImludDY0IiwKICAgICAgICAgICJ2YWx1ZSI6IHRydWUKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZnJvbSIsCiAgICAgICAgICAibGFiZWwiOiAiRnJvbSBBZGRyZXNzIiwKICAgICAgICAgICJ0eXBlIjogImFkZHJlc3MiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICJhdXRvRmlsbCI6ICJ3YWxsZXQiLAogICAgICAgICAgInBsYWNlaG9sZGVyIjogIkFkZHJlc3MgdG8gYnVybiBmcm9tIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiYW1vdW50IiwKICAgICAgICAgICJsYWJlbCI6ICJBbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiYW1vdW50IiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAicGxhY2Vob2xkZXIiOiAiQW1vdW50IHRvIGJ1cm4iCiAgICAgICAgfQogICAgICBdLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9idXJuIiwKICAgICAgImV2ZW50X3R5cGUiOiAiYnVybl9ldmVudCIKICAgIH0KICBdLAogICJhcmNzIjogWwogICAgewogICAgICAiZnJvbSI6ICJiYWxhbmNlcyIsCiAgICAgICJ0byI6ICJ0cmFuc2ZlciIsCiAgICAgICJrZXlzIjogWwogICAgICAgICJmcm9tIgogICAgICBdLAogICAgICAidmFsdWUiOiAiYW1vdW50IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAidHJhbnNmZXIiLAogICAgICAidG8iOiAiYmFsYW5jZXMiLAogICAgICAia2V5cyI6IFsKICAgICAgICAidG8iCiAgICAgIF0sCiAgICAgICJ2YWx1ZSI6ICJhbW91bnQiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJhcHByb3ZlIiwKICAgICAgInRvIjogImFsbG93YW5jZXMiLAogICAgICAia2V5cyI6IFsKICAgICAgICAib3duZXIiLAogICAgICAgICJzcGVuZGVyIgogICAgICBdLAogICAgICAidmFsdWUiOiAiYW1vdW50IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiYmFsYW5jZXMiLAogICAgICAidG8iOiAidHJhbnNmZXJfZnJvbSIsCiAgICAgICJrZXlzIjogWwogICAgICAgICJmcm9tIgogICAgICBdLAogICAgICAidmFsdWUiOiAiYW1vdW50IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiYWxsb3dhbmNlcyIsCiAgICAgICJ0byI6ICJ0cmFuc2Zlcl9mcm9tIiwKICAgICAgImtleXMiOiBbCiAgICAgICAgImZyb20iLAogICAgICAgICJjYWxsZXIiCiAgICAgIF0sCiAgICAgICJ2YWx1ZSI6ICJhbW91bnQiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ0cmFuc2Zlcl9mcm9tIiwKICAgICAgInRvIjogImJhbGFuY2VzIiwKICAgICAgImtleXMiOiBbCiAgICAgICAgInRvIgogICAgICBdLAogICAgICAidmFsdWUiOiAiYW1vdW50IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibWludCIsCiAgICAgICJ0byI6ICJiYWxhbmNlcyIsCiAgICAgICJrZXlzIjogWwogICAgICAgICJ0byIKICAgICAgXSwKICAgICAgInZhbHVlIjogImFtb3VudCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm1pbnQiLAogICAgICAidG8iOiAidG90YWxfc3VwcGx5IiwKICAgICAgInZhbHVlIjogImFtb3VudCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImJhbGFuY2VzIiwKICAgICAgInRvIjogImJ1cm4iLAogICAgICAia2V5cyI6IFsKICAgICAgICAiZnJvbSIKICAgICAgXSwKICAgICAgInZhbHVlIjogImFtb3VudCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInRvdGFsX3N1cHBseSIsCiAgICAgICJ0byI6ICJidXJuIiwKICAgICAgInZhbHVlIjogImFtb3VudCIKICAgIH0KICBdLAogICJjb25zdHJhaW50cyI6IFsKICAgIHsKICAgICAgImlkIjogImNvbnNlcnZhdGlvbiIsCiAgICAgICJleHByIjogInN1bShiYWxhbmNlcykgPT0gdG90YWxfc3VwcGx5IgogICAgfQogIF0sCiAgImV2ZW50cyI6IFsKICAgIHsKICAgICAgImlkIjogInRyYW5zZmVyX2V2ZW50IiwKICAgICAgIm5hbWUiOiAiVHJhbnNmZXIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiRW1pdHRlZCB3aGVuIHRva2VucyBhcmUgdHJhbnNmZXJyZWQgZGlyZWN0bHkiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImZyb20iLAogICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiU2VuZGVyIGFkZHJlc3MiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0byIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJSZWNpcGllbnQgYWRkcmVzcyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnRlZ2VyIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiQW1vdW50IHRyYW5zZmVycmVkIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInRyYW5zZmVyX2Zyb21fZXZlbnQiLAogICAgICAibmFtZSI6ICJUcmFuc2ZlckZyb20iLAogICAgICAiZGVzY3JpcHRpb24iOiAiRW1pdHRlZCB3aGVuIHRva2VucyBhcmUgdHJhbnNmZXJyZWQgdmlhIGFsbG93YW5jZSIsCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiZnJvbSIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJTZW5kZXIgYWRkcmVzcyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInRvIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgImRlc2NyaXB0aW9uIjogIlJlY2lwaWVudCBhZGRyZXNzIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY2FsbGVyIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgImRlc2NyaXB0aW9uIjogIkNhbGxlciB3aG8gaW5pdGlhdGVkIHRoZSB0cmFuc2ZlciIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnRlZ2VyIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiQW1vdW50IHRyYW5zZmVycmVkIgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgImlkIjogImFwcHJvdmFsX2V2ZW50IiwKICAgICAgIm5hbWUiOiAiQXBwcm92YWwiLAogICAgICAiZGVzY3JpcHRpb24iOiAiRW1pdHRlZCB3aGVuIHNwZW5kaW5nIGFwcHJvdmFsIGlzIGdyYW50ZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIm93bmVyIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgImRlc2NyaXB0aW9uIjogIlRva2VuIG93bmVyIGFkZHJlc3MiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJzcGVuZGVyIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlLAogICAgICAgICAgImRlc2NyaXB0aW9uIjogIkFwcHJvdmVkIHNwZW5kZXIgYWRkcmVzcyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnRlZ2VyIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiQXBwcm92ZWQgYW1vdW50IgogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgImlkIjogIm1pbnRfZXZlbnQiLAogICAgICAibmFtZSI6ICJNaW50IiwKICAgICAgImRlc2NyaXB0aW9uIjogIkVtaXR0ZWQgd2hlbiBuZXcgdG9rZW5zIGFyZSBjcmVhdGVkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJ0byIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZSwKICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJSZWNpcGllbnQgYWRkcmVzcyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnRlZ2VyIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiQW1vdW50IG1pbnRlZCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJidXJuX2V2ZW50IiwKICAgICAgIm5hbWUiOiAiQnVybiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJFbWl0dGVkIHdoZW4gdG9rZW5zIGFyZSBkZXN0cm95ZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImZyb20iLAogICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiQWRkcmVzcyBidXJuaW5nIHRva2VucyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnRlZ2VyIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUsCiAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiQW1vdW50IGJ1cm5lZCIKICAgICAgICB9CiAgICAgIF0KICAgIH0KICBdLAogICJkZWNpbWFscyI6IDE4LAogICJ1bml0IjogIkVUSCIKfQ=="

	return func(w http.ResponseWriter, r *http.Request) {
		schemaJSON, err := base64.StdEncoding.DecodeString(schemaBase64)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "schema_decode_error", "Failed to decode schema")
			return
		}
		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusOK)
		w.Write(schemaJSON)
	}
}

