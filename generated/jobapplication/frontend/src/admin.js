// Generated by petri-pilot. DO NOT EDIT.

/**
 * Admin Dashboard for job-application application
 * Provides statistics, instance list, and event history viewing
 */

// Import customizable extensions (preserved across regeneration)
import { adminExtensions, hooks, triggerHook } from '../custom/extensions.js'

// API helpers from main.js
const API_BASE = window.API_BASE || ''
const getHeaders = window.getHeaders || (() => ({}))
const handleResponse = window.handleResponse || (r => r.json())
const showError = window.showError || console.error

// Status configuration from schema
const STATUS_PLACES = {}
const STATUS_DEFAULT = "Unknown"

// Admin state
let currentStats = null
let currentInstances = []
let currentInstance = null
let currentFilters = { place: '', limit: 50, offset: 0, archived: false }
let totalInstances = 0
let hasSoftDelete = false // Will be set from API response

// Admin API client
const adminAPI = {
  // Get dashboard statistics
  async getStats() {
    const response = await fetch(`${API_BASE}/admin/stats`, {
      headers: getHeaders(),
    })
    return handleResponse(response)
  },

  // Get paginated instance list with optional filters
  async getInstances(params = {}) {
    const query = new URLSearchParams()
    if (params.place) query.set('place', params.place)
    if (params.limit) query.set('limit', params.limit)
    if (params.offset) query.set('offset', params.offset)
    if (params.archived) query.set('archived', 'true')

    const url = `${API_BASE}/admin/instances${query.toString() ? '?' + query.toString() : ''}`
    const response = await fetch(url, {
      headers: getHeaders(),
    })
    return handleResponse(response)
  },

  // Get a single instance by ID
  async getInstance(id) {
    const response = await fetch(`${API_BASE}/admin/instances/${encodeURIComponent(id)}`, {
      headers: getHeaders(),
    })
    return handleResponse(response)
  },

  // Get events for an instance
  async getInstanceEvents(id, fromVersion = 0) {
    const response = await fetch(`${API_BASE}/admin/instances/${encodeURIComponent(id)}/events?from=${fromVersion}`, {
      headers: getHeaders(),
    })
    return handleResponse(response)
  },

  // Get state at a specific version (time travel)
  async getStateAtVersion(id, version) {
    const response = await fetch(`${API_BASE}/admin/instances/${encodeURIComponent(id)}/at/${version}`, {
      headers: getHeaders(),
    })
    return handleResponse(response)
  },

  // Delete an instance and all its events (permanent)
  async deleteInstance(id) {
    const response = await fetch(`${API_BASE}/admin/instances/${encodeURIComponent(id)}`, {
      method: 'DELETE',
      headers: getHeaders(),
    })
    return handleResponse(response)
  },

  // Archive an instance (soft delete)
  async archiveInstance(id) {
    const response = await fetch(`${API_BASE}/admin/instances/${encodeURIComponent(id)}/archive`, {
      method: 'POST',
      headers: getHeaders(),
    })
    return handleResponse(response)
  },

  // Restore an archived instance
  async restoreInstance(id) {
    const response = await fetch(`${API_BASE}/admin/instances/${encodeURIComponent(id)}/restore`, {
      method: 'POST',
      headers: getHeaders(),
    })
    return handleResponse(response)
  },
}

/**
 * Render the admin dashboard overview
 */
export function renderAdminDashboard() {
  return `
    <div class="admin-dashboard">
      <div class="admin-header">
        <h1>Admin Dashboard</h1>
        <p class="admin-subtitle">job-application System Overview</p>
      </div>

      <div class="admin-stats" id="admin-stats">
        <p class="loading">Loading statistics...</p>
      </div>

      <div class="admin-quick-links">
        <h3>Quick Actions</h3>
        <div class="quick-links">
          <a href="/admin/instances" onclick="handleAdminNav(event, '/admin/instances')" class="quick-link">
            <span class="quick-link-icon">üìã</span>
            <span class="quick-link-label">View All Instances</span>
          </a>
        </div>
      </div>
    </div>
  `
}

/**
 * Load and display dashboard stats
 */
export async function loadAdminStats() {
  const statsContainer = document.getElementById('admin-stats')
  if (!statsContainer) return

  try {
    currentStats = await adminAPI.getStats()
    renderStats()
  } catch (err) {
    statsContainer.innerHTML = `<p class="error">Failed to load statistics: ${err.message}</p>`
  }
}

function renderStats() {
  const statsContainer = document.getElementById('admin-stats')
  if (!statsContainer || !currentStats) return

  const total = currentStats.total_instances || 0
  const byPlace = currentStats.instances_by_place || {}

  statsContainer.innerHTML = `
    <div class="stats-grid">
      <div class="stat-card stat-card-primary">
        <div class="stat-value">${total}</div>
        <div class="stat-label">Total Instances</div>
      </div>

      ${Object.entries(byPlace).map(([place, count]) => `
        <div class="stat-card stat-card-clickable" onclick="handleAdminNav(event, '/admin/instances?place=${encodeURIComponent(place)}')">
          <div class="stat-value">${count}</div>
          <div class="stat-label">${formatPlaceName(place)}</div>
        </div>
      `).join('')}
    </div>
  `
}

/**
 * Render the instance list view
 */
export function renderAdminInstances() {
  // Parse URL params for initial filters
  const urlParams = new URLSearchParams(window.location.search)
  currentFilters.place = urlParams.get('place') || ''
  currentFilters.offset = parseInt(urlParams.get('offset') || '0', 10)

  return `
    <div class="admin-instances">
      <div class="admin-header">
        <h1>Instances</h1>
        <a href="/admin" onclick="handleAdminNav(event, '/admin')" class="btn btn-link">‚Üê Back to Dashboard</a>
      </div>

      <div class="admin-filters" id="admin-filters">
        <div class="filter-group">
          <label for="filter-place">Filter by Place:</label>
          <select id="filter-place" onchange="handlePlaceFilter(this.value)">
            <option value="">All Places</option>
          </select>
        </div>
        <div class="filter-group" id="archived-toggle" style="display: none;">
          <label>
            <input type="checkbox" onchange="toggleArchivedFilter()" />
            Show Archived
          </label>
        </div>
        <button onclick="refreshInstances()" class="btn btn-secondary">Refresh</button>
      </div>

      <div class="admin-instances-table" id="admin-instances-table">
        <p class="loading">Loading instances...</p>
      </div>

      <div class="admin-pagination" id="admin-pagination"></div>
    </div>
  `
}

/**
 * Load and display instance list
 */
export async function loadAdminInstances() {
  const tableContainer = document.getElementById('admin-instances-table')
  if (!tableContainer) return

  try {
    const result = await adminAPI.getInstances(currentFilters)
    currentInstances = result.instances || []
    totalInstances = result.total || currentInstances.length
    hasSoftDelete = result.has_soft_delete || false

    // Populate place filter dropdown
    populatePlaceFilter(result.places || [])

    // Update archived toggle visibility
    updateArchivedToggle()

    renderInstancesTable()
    renderPagination()
  } catch (err) {
    tableContainer.innerHTML = `<p class="error">Failed to load instances: ${err.message}</p>`
  }
}

function populatePlaceFilter(places) {
  const select = document.getElementById('filter-place')
  if (!select) return

  // Keep existing options and add any new ones
  const existingValues = new Set([...select.options].map(o => o.value))

  for (const place of places) {
    if (!existingValues.has(place)) {
      const option = document.createElement('option')
      option.value = place
      option.textContent = formatPlaceName(place)
      select.appendChild(option)
    }
  }

  // Set current filter value
  select.value = currentFilters.place || ''
}

function renderInstancesTable() {
  const tableContainer = document.getElementById('admin-instances-table')
  if (!tableContainer) return

  if (currentInstances.length === 0) {
    const message = currentFilters.archived
      ? 'No archived instances found'
      : `No instances found${currentFilters.place ? ` in place "${formatPlaceName(currentFilters.place)}"` : ''}`
    tableContainer.innerHTML = `
      <div class="empty-state">
        <p>${message}</p>
      </div>
    `
    return
  }

  tableContainer.innerHTML = `
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Version</th>
          <th>Current State</th>
          <th>Updated</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${currentInstances.map(instance => `
          <tr class="instance-row ${currentFilters.archived ? 'archived' : ''}" data-id="${escapeHtml(instance.id)}">
            <td class="instance-id">
              <code>${escapeHtml(instance.id.substring(0, 8))}...</code>
              ${currentFilters.archived ? '<span class="archived-badge">Archived</span>' : ''}
            </td>
            <td class="instance-version">v${instance.version || 0}</td>
            <td class="instance-state">
              ${renderStateSummary(instance.state || instance.places)}
            </td>
            <td class="instance-updated">
              ${formatRelativeTime(instance.updated_at)}
            </td>
            <td class="instance-actions">
              ${currentFilters.archived ? `
                <button onclick="handleRestoreInstance('${escapeHtml(instance.id)}')" class="btn btn-sm btn-success">
                  Restore
                </button>
              ` : `
                <button onclick="handleAdminNav(event, '/admin/instances/${encodeURIComponent(instance.id)}')" class="btn btn-sm btn-primary">
                  View
                </button>
              `}
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `
}

function renderStateSummary(state) {
  if (!state) return `<span class="state-tag">${STATUS_DEFAULT}</span>`

  // If state has places, check for configured status labels
  const places = state.places || state
  if (typeof places === 'object') {
    for (const [place, tokens] of Object.entries(places)) {
      if (tokens > 0 && STATUS_PLACES[place]) {
        return `<span class="state-tag state-tag-terminal">${STATUS_PLACES[place]}</span>`
      }
    }
    // Default status for active workflows
    return `<span class="state-tag">${STATUS_DEFAULT}</span>`
  }

  return `<span class="state-tag">${STATUS_DEFAULT}</span>`
}

function renderPagination() {
  const paginationContainer = document.getElementById('admin-pagination')
  if (!paginationContainer) return

  const totalPages = Math.ceil(totalInstances / currentFilters.limit)
  const currentPage = Math.floor(currentFilters.offset / currentFilters.limit) + 1

  if (totalPages <= 1) {
    paginationContainer.innerHTML = ''
    return
  }

  paginationContainer.innerHTML = `
    <div class="pagination">
      <button
        onclick="handlePageChange(${currentPage - 2})"
        class="btn btn-sm"
        ${currentPage <= 1 ? 'disabled' : ''}
      >Previous</button>
      <span class="pagination-info">Page ${currentPage} of ${totalPages}</span>
      <button
        onclick="handlePageChange(${currentPage})"
        class="btn btn-sm"
        ${currentPage >= totalPages ? 'disabled' : ''}
      >Next</button>
    </div>
  `
}

/**
 * Render single instance detail view
 */
export function renderAdminInstance(id) {
  return `
    <div class="admin-instance-detail">
      <div class="admin-header">
        <h1>Instance Detail</h1>
        <a href="/admin/instances" onclick="handleAdminNav(event, '/admin/instances')" class="btn btn-link">‚Üê Back to Instances</a>
      </div>

      <div class="instance-detail-content" id="instance-detail-content">
        <p class="loading">Loading instance ${escapeHtml(id)}...</p>
      </div>
    </div>
  `
}

/**
 * Load and display instance detail
 */
export async function loadAdminInstance(id) {
  const container = document.getElementById('instance-detail-content')
  if (!container) return

  try {
    currentInstance = await adminAPI.getInstance(id)
    renderInstanceDetail()
  } catch (err) {
    container.innerHTML = `<p class="error">Failed to load instance: ${err.message}</p>`
  }
}

function renderInstanceDetail() {
  const container = document.getElementById('instance-detail-content')
  if (!container || !currentInstance) return

  const instance = currentInstance

  container.innerHTML = `
    <div class="instance-meta">
      <div class="meta-grid">
        <div class="meta-item">
          <label>ID</label>
          <code>${escapeHtml(instance.id)}</code>
        </div>
        <div class="meta-item">
          <label>Version</label>
          <span>${instance.version || 0}</span>
        </div>
        <div class="meta-item">
          <label>Updated</label>
          <span>${formatTimestamp(instance.updated_at)}</span>
        </div>
      </div>
    </div>

    <div class="instance-state-section">
      <h3>Current State</h3>
      <div class="state-viewer">
        ${renderStateDetails(instance.state || instance.places)}
      </div>
    </div>

    <div class="instance-actions-section">
      <h3>Actions</h3>
      <div class="action-buttons">
        <button onclick="loadInstanceEvents('${escapeHtml(instance.id)}')" class="btn btn-secondary">
          View Event History
        </button>
        <button onclick="toggleTimeTravelControls()" class="btn btn-secondary">
          Time Travel
        </button>
        ${hasSoftDelete ? `
          <button onclick="handleArchiveInstance('${escapeHtml(instance.id)}')" class="btn btn-warning">
            Archive
          </button>
          <button onclick="handleDeleteInstance('${escapeHtml(instance.id)}')" class="btn btn-danger">
            Delete Permanently
          </button>
        ` : `
          <button onclick="handleDeleteInstance('${escapeHtml(instance.id)}')" class="btn btn-danger">
            Delete Instance
          </button>
        `}
        ${renderCustomActions(instance)}
      </div>
    </div>

    <div class="instance-time-travel" id="time-travel-controls" style="display: none;">
      <h3>Time Travel</h3>
      <div class="time-travel-slider">
        <label for="version-slider">Version: <span id="version-display">${instance.version || 0}</span></label>
        <input
          type="range"
          id="version-slider"
          min="0"
          max="${instance.version || 0}"
          value="${instance.version || 0}"
          onchange="handleVersionChange(this.value, '${escapeHtml(instance.id)}')"
        />
      </div>
      <div id="time-travel-state"></div>
    </div>

    <div class="instance-events-section" id="instance-events-section" style="display: none;">
      <h3>Event History</h3>
      <div id="instance-events-timeline">
        <p class="loading">Loading events...</p>
      </div>
    </div>
  `
}

function renderStateDetails(state) {
  if (!state) return '<p class="muted">No state data</p>'

  const places = state.places || state

  if (typeof places === 'object' && !Array.isArray(places)) {
    return `
      <div class="state-places-detail">
        ${Object.entries(places).map(([place, tokens]) => `
          <div class="state-place-row ${tokens > 0 ? 'active' : 'inactive'}">
            <span class="place-name">${escapeHtml(place)}</span>
            <span class="place-tokens">${tokens}</span>
          </div>
        `).join('')}
      </div>
    `
  }

  // Fallback: show raw JSON
  return `<pre class="state-json">${escapeHtml(JSON.stringify(state, null, 2))}</pre>`
}

/**
 * Render custom action buttons from extensions
 * @param {Object} instance - The current instance
 * @returns {string} HTML for custom action buttons
 */
function renderCustomActions(instance) {
  if (!adminExtensions.customActions || adminExtensions.customActions.length === 0) {
    return ''
  }

  return adminExtensions.customActions.map((action, index) => {
    const className = action.className || 'btn btn-secondary'
    const handlerName = `_customAction_${index}`
    // Register the handler on window for onclick access
    window[handlerName] = () => action.onClick(instance)
    return `<button onclick="${handlerName}()" class="${escapeHtml(className)}">${escapeHtml(action.label)}</button>`
  }).join('')
}

/**
 * Load and display event history for an instance
 */
export async function loadInstanceEvents(id) {
  const section = document.getElementById('instance-events-section')
  const timeline = document.getElementById('instance-events-timeline')
  if (!section || !timeline) return

  section.style.display = 'block'

  try {
    const result = await adminAPI.getInstanceEvents(id)
    const events = result.events || []

    if (events.length === 0) {
      timeline.innerHTML = '<p class="empty">No events found</p>'
      return
    }

    timeline.innerHTML = `
      <div class="events-timeline">
        ${events.map(event => `
          <div class="event-item" data-version="${event.version}">
            <div class="event-marker">
              <span class="event-version">v${event.version}</span>
            </div>
            <div class="event-content">
              <div class="event-type">${formatEventType(event.type)}</div>
              <div class="event-meta">
                <span class="event-timestamp">${formatTimestamp(event.timestamp)}</span>
              </div>
              ${event.data ? `
                <details class="event-data">
                  <summary>Event Data</summary>
                  <pre>${escapeHtml(JSON.stringify(event.data, null, 2))}</pre>
                </details>
              ` : ''}
            </div>
          </div>
        `).join('')}
      </div>
    `
  } catch (err) {
    timeline.innerHTML = `<p class="error">Failed to load events: ${err.message}</p>`
  }
}

// Global handlers
window.handleAdminNav = function(event, path) {
  event.preventDefault()
  if (typeof window.navigate === 'function') {
    window.navigate(path)
  } else {
    window.location.href = path
  }
}

window.handlePlaceFilter = async function(place) {
  currentFilters.place = place
  currentFilters.offset = 0
  await loadAdminInstances()
}

window.handlePageChange = async function(pageIndex) {
  currentFilters.offset = pageIndex * currentFilters.limit
  await loadAdminInstances()
}

window.refreshInstances = async function() {
  await loadAdminInstances()
}

window.handleDeleteInstance = async function(id) {
  const message = hasSoftDelete
    ? 'Are you sure you want to PERMANENTLY delete this instance? This cannot be undone. Consider archiving instead.'
    : 'Are you sure you want to delete this instance? This will permanently remove all events and cannot be undone.'

  if (!confirm(message)) {
    return
  }

  try {
    await adminAPI.deleteInstance(id)
    triggerHook('onInstanceDeleted', id)
    // Navigate back to instances list
    if (typeof window.navigate === 'function') {
      window.navigate('/admin/instances')
    } else {
      window.location.href = '/admin/instances'
    }
  } catch (err) {
    showError('Failed to delete instance: ' + err.message)
  }
}

window.handleArchiveInstance = async function(id) {
  if (!confirm('Archive this instance? It can be restored later from the archived instances view.')) {
    return
  }

  try {
    await adminAPI.archiveInstance(id)
    triggerHook('onInstanceArchived', id)
    // Navigate back to instances list
    if (typeof window.navigate === 'function') {
      window.navigate('/admin/instances')
    } else {
      window.location.href = '/admin/instances'
    }
  } catch (err) {
    showError('Failed to archive instance: ' + err.message)
  }
}

window.handleRestoreInstance = async function(id) {
  try {
    await adminAPI.restoreInstance(id)
    triggerHook('onInstanceRestored', id)
    // Refresh the list
    await loadAdminInstances()
  } catch (err) {
    showError('Failed to restore instance: ' + err.message)
  }
}

window.toggleArchivedFilter = async function() {
  currentFilters.archived = !currentFilters.archived
  await loadAdminInstances()
}

function updateArchivedToggle() {
  const toggle = document.getElementById('archived-toggle')
  if (toggle) {
    toggle.style.display = hasSoftDelete ? 'flex' : 'none'
    const checkbox = toggle.querySelector('input')
    if (checkbox) {
      checkbox.checked = currentFilters.archived
    }
  }
}

window.toggleTimeTravelControls = function() {
  const controls = document.getElementById('time-travel-controls')
  if (controls) {
    controls.style.display = controls.style.display === 'none' ? 'block' : 'none'
  }
}

window.handleVersionChange = async function(version, id) {
  const display = document.getElementById('version-display')
  const stateContainer = document.getElementById('time-travel-state')

  if (display) display.textContent = version
  if (!stateContainer) return

  stateContainer.innerHTML = '<p class="loading">Loading state at version ' + version + '...</p>'

  try {
    const result = await adminAPI.getStateAtVersion(id, parseInt(version, 10))
    stateContainer.innerHTML = `
      <div class="time-travel-state-content">
        ${renderStateDetails(result.state || result.places || result)}
      </div>
    `
  } catch (err) {
    stateContainer.innerHTML = `<p class="error">Failed to load state: ${err.message}</p>`
  }
}

// Formatting helpers
function formatPlaceName(place) {
  return place
    .replace(/_/g, ' ')
    .replace(/([A-Z])/g, ' $1')
    .replace(/^./, str => str.toUpperCase())
    .trim()
}

function formatEventType(type) {
  return type
    .replace(/([A-Z])/g, (match, p1, offset) => (offset > 0 ? ' ' : '') + p1)
    .replace(/_/g, ' ')
    .replace(/^./, str => str.toUpperCase())
    .trim()
}

function formatTimestamp(timestamp) {
  if (!timestamp) return 'Unknown'
  const date = new Date(timestamp)
  return date.toLocaleString()
}

function formatRelativeTime(timestamp) {
  if (!timestamp) return 'Unknown'

  const date = new Date(timestamp)
  const now = new Date()
  const diffMs = now - date
  const diffMins = Math.floor(diffMs / 60000)
  const diffHours = Math.floor(diffMs / 3600000)
  const diffDays = Math.floor(diffMs / 86400000)

  if (diffMins < 1) return 'Just now'
  if (diffMins < 60) return `${diffMins}m ago`
  if (diffHours < 24) return `${diffHours}h ago`
  if (diffDays < 7) return `${diffDays}d ago`
  return date.toLocaleDateString()
}

function escapeHtml(text) {
  if (text === null || text === undefined) return ''
  const str = String(text)
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  }
  return str.replace(/[&<>"']/g, m => map[m])
}

/**
 * Initialize admin module - call this when admin pages are loaded
 */
export function initAdmin() {
  // Add admin styles if not already present
  if (!document.getElementById('admin-styles')) {
    const style = document.createElement('style')
    style.id = 'admin-styles'
    style.textContent = adminStyles
    document.head.appendChild(style)
  }
}

// Admin CSS styles
const adminStyles = `
.admin-dashboard,
.admin-instances,
.admin-instance-detail {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.admin-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #e0e0e0;
}

.admin-header h1 {
  margin: 0;
}

.admin-subtitle {
  color: #666;
  margin: 0.5rem 0 0 0;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1.5rem;
  text-align: center;
}

.stat-card-primary {
  background: #e3f2fd;
  border: 2px solid #2196f3;
}

.stat-card-clickable {
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.stat-card-clickable:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.stat-value {
  font-size: 2rem;
  font-weight: bold;
  color: #333;
}

.stat-label {
  color: #666;
  margin-top: 0.5rem;
}

.quick-links {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.quick-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem 1.5rem;
  background: #fff;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  text-decoration: none;
  color: #333;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.quick-link:hover {
  border-color: #2196f3;
  box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);
}

.quick-link-icon {
  font-size: 1.5rem;
}

.admin-filters {
  display: flex;
  gap: 1rem;
  align-items: center;
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.filter-group select {
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.admin-table th,
.admin-table td {
  padding: 1rem;
  text-align: left;
  border-bottom: 1px solid #e0e0e0;
}

.admin-table th {
  background: #f8f9fa;
  font-weight: 600;
}

.admin-table tbody tr:hover {
  background: #f5f5f5;
}

.instance-id code {
  background: #e8e8e8;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
}

.state-tag {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  margin: 0.125rem;
  background: #e3f2fd;
  border-radius: 4px;
  font-size: 0.75rem;
}

.state-tag-more {
  background: #f0f0f0;
  color: #666;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 1.5rem;
}

.pagination-info {
  color: #666;
}

.meta-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin-bottom: 1.5rem;
}

.meta-item label {
  display: block;
  font-weight: 600;
  color: #666;
  margin-bottom: 0.25rem;
  font-size: 0.875rem;
}

.meta-item code {
  word-break: break-all;
}

.instance-state-section,
.instance-actions-section,
.instance-events-section,
.instance-time-travel {
  margin-bottom: 2rem;
}

.instance-state-section h3,
.instance-actions-section h3,
.instance-events-section h3,
.instance-time-travel h3 {
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #e0e0e0;
}

.state-viewer {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1rem;
}

.state-places-detail {
  display: grid;
  gap: 0.5rem;
}

.state-place-row {
  display: flex;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  background: #fff;
  border-radius: 4px;
  border: 1px solid #e0e0e0;
}

.state-place-row.active {
  border-color: #4caf50;
  background: #e8f5e9;
}

.state-place-row.inactive {
  opacity: 0.6;
}

.place-name {
  font-weight: 500;
}

.place-tokens {
  font-weight: bold;
}

.state-json {
  background: #263238;
  color: #aed581;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto;
  font-size: 0.875rem;
}

.action-buttons {
  display: flex;
  gap: 0.5rem;
}

.time-travel-slider {
  margin-bottom: 1rem;
}

.time-travel-slider input[type="range"] {
  width: 100%;
  margin-top: 0.5rem;
}

.events-timeline {
  position: relative;
  padding-left: 2rem;
}

.events-timeline::before {
  content: '';
  position: absolute;
  left: 0.5rem;
  top: 0;
  bottom: 0;
  width: 2px;
  background: #e0e0e0;
}

.event-item {
  position: relative;
  padding: 1rem;
  margin-bottom: 1rem;
  background: #fff;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
}

.event-marker {
  position: absolute;
  left: -2rem;
  top: 1rem;
  background: #2196f3;
  color: #fff;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: bold;
}

.event-type {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.event-meta {
  color: #666;
  font-size: 0.875rem;
}

.event-data {
  margin-top: 0.5rem;
}

.event-data summary {
  cursor: pointer;
  color: #2196f3;
  font-size: 0.875rem;
}

.event-data pre {
  margin-top: 0.5rem;
  padding: 0.75rem;
  background: #f5f5f5;
  border-radius: 4px;
  font-size: 0.75rem;
  overflow-x: auto;
}

.empty-state {
  text-align: center;
  padding: 3rem;
  color: #666;
}

.loading {
  color: #666;
  font-style: italic;
}

.error {
  color: #d32f2f;
}

.muted {
  color: #999;
}

.btn {
  display: inline-block;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.875rem;
  text-decoration: none;
  transition: background 0.2s;
}

.btn-primary {
  background: #2196f3;
  color: #fff;
}

.btn-primary:hover {
  background: #1976d2;
}

.btn-secondary {
  background: #e0e0e0;
  color: #333;
}

.btn-secondary:hover {
  background: #d0d0d0;
}

.btn-danger {
  background: #d32f2f;
  color: #fff;
}

.btn-danger:hover {
  background: #b71c1c;
}

.btn-warning {
  background: #ff9800;
  color: #fff;
}

.btn-warning:hover {
  background: #f57c00;
}

.btn-success {
  background: #4caf50;
  color: #fff;
}

.btn-success:hover {
  background: #388e3c;
}

.archived-badge {
  display: inline-block;
  margin-left: 0.5rem;
  padding: 0.125rem 0.375rem;
  background: #9e9e9e;
  color: #fff;
  border-radius: 3px;
  font-size: 0.625rem;
  text-transform: uppercase;
}

.instance-row.archived {
  opacity: 0.7;
  background: #fafafa;
}

.btn-link {
  background: none;
  color: #2196f3;
  padding: 0;
}

.btn-link:hover {
  text-decoration: underline;
}

.btn-sm {
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
`
