{
  "name": "vet-clinic",
  "version": "1.0.0",
  "description": "Veterinary clinic appointment and visit management system with role-based access control",
  "entities": [
    {
      "id": "visit",
      "name": "Visit",
      "description": "A patient visit from request through checkout",
      "fields": [
        {
          "id": "patient_name",
          "type": "string",
          "required": true
        },
        {
          "id": "owner_name",
          "type": "string",
          "required": true
        },
        {
          "id": "phone",
          "type": "string"
        },
        {
          "id": "appointment_type",
          "type": "string"
        },
        {
          "id": "scheduled_time",
          "type": "datetime"
        },
        {
          "id": "duration_minutes",
          "type": "number"
        },
        {
          "id": "assigned_provider",
          "type": "string"
        },
        {
          "id": "provider_type",
          "type": "string"
        },
        {
          "id": "assigned_room",
          "type": "string"
        },
        {
          "id": "weight_lbs",
          "type": "number"
        },
        {
          "id": "diagnosis",
          "type": "text"
        },
        {
          "id": "treatment",
          "type": "text"
        },
        {
          "id": "notes",
          "type": "text"
        }
      ],
      "states": [
        {
          "id": "requested",
          "initial": true
        },
        {
          "id": "scheduled"
        },
        {
          "id": "checked_in"
        },
        {
          "id": "in_progress"
        },
        {
          "id": "completed"
        },
        {
          "id": "checked_out",
          "terminal": true
        },
        {
          "id": "cancelled",
          "terminal": true
        },
        {
          "id": "no_show",
          "terminal": true
        },
        {
          "id": "awaiting_lab"
        },
        {
          "id": "awaiting_authorization"
        },
        {
          "id": "referred",
          "terminal": true
        }
      ],
      "actions": [
        {
          "id": "schedule",
          "from_states": ["requested"],
          "to_state": "scheduled",
          "event": "AppointmentScheduled",
          "input": [
            {"id": "patient_name", "type": "string", "required": true},
            {"id": "owner_name", "type": "string", "required": true},
            {"id": "phone", "type": "string"},
            {"id": "appointment_type", "type": "string"},
            {"id": "scheduled_time", "type": "datetime"},
            {"id": "duration_minutes", "type": "number"},
            {"id": "assigned_provider", "type": "string"},
            {"id": "provider_type", "type": "string"},
            {"id": "assigned_room", "type": "string"},
            {"id": "notes", "type": "text"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/schedule"
          }
        },
        {
          "id": "check_in",
          "from_states": ["scheduled"],
          "to_state": "checked_in",
          "event": "PatientCheckedIn",
          "input": [
            {"id": "arrival_time", "type": "datetime"},
            {"id": "weight_lbs", "type": "number"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/check-in"
          }
        },
        {
          "id": "start_exam",
          "from_states": ["checked_in"],
          "to_state": "in_progress",
          "event": "ExamStarted",
          "input": [
            {"id": "provider_name", "type": "string"},
            {"id": "room", "type": "string"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/start-exam"
          }
        },
        {
          "id": "complete",
          "from_states": ["in_progress"],
          "to_state": "completed",
          "event": "VisitCompleted",
          "input": [
            {"id": "diagnosis", "type": "text"},
            {"id": "treatment", "type": "text"},
            {"id": "follow_up_needed", "type": "boolean"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/complete"
          }
        },
        {
          "id": "checkout",
          "from_states": ["completed"],
          "to_state": "checked_out",
          "event": "PatientCheckedOut",
          "input": [
            {"id": "services_pct", "type": "number"},
            {"id": "products_pct", "type": "number"},
            {"id": "next_appointment", "type": "datetime"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/checkout"
          }
        },
        {
          "id": "cancel_requested",
          "from_states": ["requested"],
          "to_state": "cancelled",
          "event": "AppointmentCancelled",
          "input": [
            {"id": "reason", "type": "string"},
            {"id": "rescheduled", "type": "boolean"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/cancel"
          }
        },
        {
          "id": "cancel_scheduled",
          "from_states": ["scheduled"],
          "to_state": "cancelled",
          "event": "AppointmentCancelled",
          "input": [
            {"id": "reason", "type": "string"},
            {"id": "rescheduled", "type": "boolean"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/cancel"
          }
        },
        {
          "id": "mark_no_show",
          "from_states": ["scheduled"],
          "to_state": "no_show",
          "event": "MarkedNoShow",
          "input": [
            {"id": "attempted_contact", "type": "boolean"},
            {"id": "notes", "type": "text"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/no-show"
          }
        },
        {
          "id": "send_to_lab",
          "from_states": ["in_progress"],
          "to_state": "awaiting_lab",
          "event": "LabRequested",
          "input": [
            {"id": "test_type", "type": "string"},
            {"id": "lab_name", "type": "string"},
            {"id": "urgency", "type": "string"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/send-to-lab"
          }
        },
        {
          "id": "receive_results",
          "from_states": ["awaiting_lab"],
          "to_state": "in_progress",
          "event": "LabResultsReceived",
          "input": [
            {"id": "results_summary", "type": "text"},
            {"id": "abnormal_findings", "type": "boolean"},
            {"id": "recommendations", "type": "text"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/receive-results"
          }
        },
        {
          "id": "request_auth",
          "from_states": ["in_progress"],
          "to_state": "awaiting_authorization",
          "event": "AuthorizationRequested",
          "input": [
            {"id": "procedure", "type": "string"},
            {"id": "estimated_cost", "type": "number"},
            {"id": "medical_necessity", "type": "text"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/request-auth"
          }
        },
        {
          "id": "authorize",
          "from_states": ["awaiting_authorization"],
          "to_state": "in_progress",
          "event": "AuthorizationReceived",
          "input": [
            {"id": "authorized", "type": "boolean"},
            {"id": "authorized_amount", "type": "number"},
            {"id": "authorization_notes", "type": "text"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/authorize"
          }
        },
        {
          "id": "refer_out",
          "from_states": ["in_progress"],
          "to_state": "referred",
          "event": "PatientReferred",
          "input": [
            {"id": "referral_clinic", "type": "string"},
            {"id": "specialist_type", "type": "string"},
            {"id": "referral_reason", "type": "text"},
            {"id": "urgency", "type": "string"}
          ],
          "http": {
            "method": "POST",
            "path": "/visits/{id}/refer"
          }
        }
      ],
      "access": [
        {
          "action": "schedule",
          "roles": ["front_desk", "office_manager"]
        },
        {
          "action": "check_in",
          "roles": ["front_desk", "vet_assistant", "office_manager"]
        },
        {
          "action": "start_exam",
          "roles": ["dvm", "rvt", "office_manager"]
        },
        {
          "action": "complete",
          "roles": ["dvm", "office_manager"]
        },
        {
          "action": "checkout",
          "roles": ["front_desk", "office_manager"]
        },
        {
          "action": "cancel_requested",
          "roles": ["front_desk", "office_manager"]
        },
        {
          "action": "cancel_scheduled",
          "roles": ["front_desk", "office_manager"]
        },
        {
          "action": "mark_no_show",
          "roles": ["front_desk", "office_manager"]
        },
        {
          "action": "send_to_lab",
          "roles": ["dvm", "rvt", "office_manager"]
        },
        {
          "action": "receive_results",
          "roles": ["dvm", "rvt", "vet_assistant", "office_manager"]
        },
        {
          "action": "request_auth",
          "roles": ["dvm", "office_manager"]
        },
        {
          "action": "authorize",
          "roles": ["office_manager"]
        },
        {
          "action": "refer_out",
          "roles": ["dvm", "office_manager"]
        }
      ]
    }
  ],
  "roles": [
    {
      "id": "office_manager",
      "name": "Office Manager",
      "description": "Full access to all clinic operations, scheduling, and administration"
    },
    {
      "id": "dvm",
      "name": "Doctor of Veterinary Medicine",
      "description": "Licensed veterinarian who can examine patients, diagnose, and prescribe treatment"
    },
    {
      "id": "rvt",
      "name": "Registered Veterinary Technician",
      "description": "Licensed technician who assists with exams, performs lab work, and administers treatments"
    },
    {
      "id": "vet_assistant",
      "name": "Veterinary Assistant",
      "description": "Assists with patient handling, basic care, and clinic operations"
    },
    {
      "id": "front_desk",
      "name": "Front Desk",
      "description": "Handles scheduling, check-in, check-out, and client communications"
    }
  ],
  "pages": [
    {
      "id": "dashboard",
      "name": "Dashboard",
      "path": "/",
      "layout": {
        "type": "dashboard",
        "widgets": [
          {"type": "count", "entity": "visit", "filter": "state=scheduled", "label": "Scheduled Today"},
          {"type": "count", "entity": "visit", "filter": "state=checked_in", "label": "Waiting"},
          {"type": "count", "entity": "visit", "filter": "state=in_progress", "label": "In Exam"},
          {"type": "count", "entity": "visit", "filter": "state=awaiting_lab", "label": "Awaiting Lab"}
        ]
      }
    },
    {
      "id": "schedule",
      "name": "Schedule",
      "path": "/schedule",
      "layout": {
        "type": "calendar",
        "entity": "visit"
      }
    },
    {
      "id": "visits",
      "name": "Visits",
      "path": "/visits",
      "layout": {
        "type": "list",
        "entity": "visit"
      }
    },
    {
      "id": "visit-detail",
      "name": "Visit Detail",
      "path": "/visits/:id",
      "layout": {
        "type": "detail",
        "entity": "visit"
      }
    },
    {
      "id": "new-visit",
      "name": "New Visit Request",
      "path": "/visits/new",
      "layout": {
        "type": "form",
        "entity": "visit"
      }
    }
  ],
  "workflows": [
    {
      "id": "appointment-reminder",
      "name": "Appointment Reminder",
      "description": "Send reminder 24 hours before scheduled appointment",
      "trigger": {
        "type": "schedule",
        "cron": "0 9 * * *"
      },
      "steps": [
        {
          "id": "find-appointments",
          "type": "query",
          "entity": "visit",
          "filter": "state=scheduled AND scheduled_time BETWEEN NOW() AND NOW() + 24h"
        },
        {
          "id": "send-reminder",
          "type": "action",
          "entity": "notification",
          "action": "send",
          "input": {
            "recipient": "phone",
            "message": "Reminder: {{patient_name}} has an appointment tomorrow at {{scheduled_time}}"
          }
        }
      ]
    },
    {
      "id": "no-show-followup",
      "name": "No-Show Follow-up",
      "description": "Contact client after no-show to reschedule",
      "trigger": {
        "type": "event",
        "entity": "visit",
        "action": "mark_no_show"
      },
      "steps": [
        {
          "id": "send-followup",
          "type": "action",
          "entity": "notification",
          "action": "send",
          "input": {
            "recipient": "phone",
            "message": "We missed you today! Please call to reschedule {{patient_name}}'s appointment."
          }
        }
      ]
    }
  ]
}
