// Code generated by petri-pilot. DO NOT EDIT.

package tictactoe

import (
	"context"
	"encoding/base64"
	"encoding/json"
	"io/fs"
	"net/http"
	"os"
	"path/filepath"
	"strconv"
	"strings"

	"github.com/pflow-xyz/petri-pilot/pkg/runtime/api"
	"github.com/pflow-xyz/go-pflow/eventsource"
)

// BuildRouter creates an HTTP router for the tic-tac-toe workflow.
func BuildRouter(app *Application, debugBroker *DebugBroker) http.Handler {
	r := api.NewRouter()

	// Health check - always returns ok if server is running
	r.GET("/health", "Health check", func(w http.ResponseWriter, r *http.Request) {
		api.JSON(w, http.StatusOK, map[string]string{"status": "ok"})
	})

	// Readiness check - verifies dependencies (database, etc.)
	r.GET("/ready", "Readiness check", HandleReady(app))

	// Create new aggregate
	r.POST("/api/tictactoe", "Create new tic-tac-toe", HandleCreate(app))

	// Get aggregate state
	r.GET("/api/tictactoe/{id}", "Get tic-tac-toe state", HandleGetState(app))


	// Schema viewer endpoint
	r.GET("/api/schema", "Get model schema", HandleGetSchema())


	// Admin endpoints
	r.GET("/admin/stats", "Admin statistics", HandleAdminStats(app))
	r.GET("/admin/instances", "List instances", HandleAdminListInstances(app))
	r.GET("/admin/instances/{id}", "Get instance detail", HandleAdminGetInstance(app))
	r.GET("/admin/instances/{id}/events", "Get instance events", HandleAdminGetEvents(app))
	r.DELETE("/admin/instances/{id}", "Delete instance permanently", HandleAdminDeleteInstance(app))


	// Event replay endpoints
	r.GET("/api/tictactoe/{id}/events", "Get event history", HandleGetEvents(app))
	r.GET("/api/tictactoe/{id}/at/{version}", "Get state at version", HandleGetStateAtVersion(app))
	r.POST("/api/tictactoe/{id}/truncate", "Truncate event history to version", HandleTruncate(app))





	// GraphQL API
	r.Handle("POST", "/graphql", "GraphQL API endpoint", GraphQLHandler(app))
	r.GET("/playground", "GraphQL Playground", PlaygroundHandler())


	// Debug WebSocket and eval endpoints
	r.GET("/ws/debug", "Debug WebSocket connection", HandleDebugWebSocket(debugBroker))
	r.GET("/api/debug/sessions", "List debug sessions", HandleListSessions(debugBroker))
	r.POST("/api/debug/sessions/{id}/eval", "Evaluate code in browser session", HandleSessionEval(debugBroker))
	// Guest login endpoint (debug mode without access control)
	r.POST("/api/debug/login", "Create debug guest session", HandleDebugGuestLogin())

















	// Transition endpoints
	r.Transition("x_play_00", "/api/x_play_00", "X plays at (0,0)", HandleXPlay00(app))
	r.Transition("x_play_01", "/api/x_play_01", "X plays at (0,1)", HandleXPlay01(app))
	r.Transition("x_play_02", "/api/x_play_02", "X plays at (0,2)", HandleXPlay02(app))
	r.Transition("x_play_10", "/api/x_play_10", "X plays at (1,0)", HandleXPlay10(app))
	r.Transition("x_play_11", "/api/x_play_11", "X plays at (1,1) - center", HandleXPlay11(app))
	r.Transition("x_play_12", "/api/x_play_12", "X plays at (1,2)", HandleXPlay12(app))
	r.Transition("x_play_20", "/api/x_play_20", "X plays at (2,0)", HandleXPlay20(app))
	r.Transition("x_play_21", "/api/x_play_21", "X plays at (2,1)", HandleXPlay21(app))
	r.Transition("x_play_22", "/api/x_play_22", "X plays at (2,2)", HandleXPlay22(app))
	r.Transition("o_play_00", "/api/o_play_00", "O plays at (0,0)", HandleOPlay00(app))
	r.Transition("o_play_01", "/api/o_play_01", "O plays at (0,1)", HandleOPlay01(app))
	r.Transition("o_play_02", "/api/o_play_02", "O plays at (0,2)", HandleOPlay02(app))
	r.Transition("o_play_10", "/api/o_play_10", "O plays at (1,0)", HandleOPlay10(app))
	r.Transition("o_play_11", "/api/o_play_11", "O plays at (1,1) - center", HandleOPlay11(app))
	r.Transition("o_play_12", "/api/o_play_12", "O plays at (1,2)", HandleOPlay12(app))
	r.Transition("o_play_20", "/api/o_play_20", "O plays at (2,0)", HandleOPlay20(app))
	r.Transition("o_play_21", "/api/o_play_21", "O plays at (2,1)", HandleOPlay21(app))
	r.Transition("o_play_22", "/api/o_play_22", "O plays at (2,2)", HandleOPlay22(app))
	r.Transition("reset", "/api/reset", "Reset game to initial state", HandleReset(app))
	r.Transition("x_win_row0", "/api/x_win_row0", "X wins top row (0,0)-(0,1)-(0,2)", HandleXWinRow0(app))
	r.Transition("x_win_row1", "/api/x_win_row1", "X wins middle row (1,0)-(1,1)-(1,2)", HandleXWinRow1(app))
	r.Transition("x_win_row2", "/api/x_win_row2", "X wins bottom row (2,0)-(2,1)-(2,2)", HandleXWinRow2(app))
	r.Transition("x_win_col0", "/api/x_win_col0", "X wins left column (0,0)-(1,0)-(2,0)", HandleXWinCol0(app))
	r.Transition("x_win_col1", "/api/x_win_col1", "X wins center column (0,1)-(1,1)-(2,1)", HandleXWinCol1(app))
	r.Transition("x_win_col2", "/api/x_win_col2", "X wins right column (0,2)-(1,2)-(2,2)", HandleXWinCol2(app))
	r.Transition("x_win_diag", "/api/x_win_diag", "X wins main diagonal (0,0)-(1,1)-(2,2)", HandleXWinDiag(app))
	r.Transition("x_win_anti", "/api/x_win_anti", "X wins anti-diagonal (0,2)-(1,1)-(2,0)", HandleXWinAnti(app))
	r.Transition("o_win_row0", "/api/o_win_row0", "O wins top row (0,0)-(0,1)-(0,2)", HandleOWinRow0(app))
	r.Transition("o_win_row1", "/api/o_win_row1", "O wins middle row (1,0)-(1,1)-(1,2)", HandleOWinRow1(app))
	r.Transition("o_win_row2", "/api/o_win_row2", "O wins bottom row (2,0)-(2,1)-(2,2)", HandleOWinRow2(app))
	r.Transition("o_win_col0", "/api/o_win_col0", "O wins left column (0,0)-(1,0)-(2,0)", HandleOWinCol0(app))
	r.Transition("o_win_col1", "/api/o_win_col1", "O wins center column (0,1)-(1,1)-(2,1)", HandleOWinCol1(app))
	r.Transition("o_win_col2", "/api/o_win_col2", "O wins right column (0,2)-(1,2)-(2,2)", HandleOWinCol2(app))
	r.Transition("o_win_diag", "/api/o_win_diag", "O wins main diagonal (0,0)-(1,1)-(2,2)", HandleOWinDiag(app))
	r.Transition("o_win_anti", "/api/o_win_anti", "O wins anti-diagonal (0,2)-(1,1)-(2,0)", HandleOWinAnti(app))
	r.Transition("draw", "/api/draw", "Game ends in draw (all 9 moves played, no winner)", HandleDraw(app))

	// Serve frontend static files
	r.StaticFiles("/", StaticFileHandler())

	return r.Build()
}

// StaticFileHandler returns an http.Handler that serves static files from frontend/.
// It supports SPA routing by returning index.html for paths that don't match static files.
func StaticFileHandler() http.HandlerFunc {
	// Find frontend directory - try custom frontends first, then generated
	frontendPath := ""
	candidates := []string{
		"frontends/tic-tac-toe",                    // Custom frontend (top priority)
		"frontend",                                    // Running from service directory
		"generated/tictactoe/frontend",         // Generated frontend from repo root
		filepath.Join("generated", "tictactoe", "frontend"), // Platform-safe
	}

	// Also try relative to executable
	if exe, err := os.Executable(); err == nil {
		exeDir := filepath.Dir(exe)
		candidates = append(candidates,
			filepath.Join(exeDir, "frontends", "tic-tac-toe"),
			filepath.Join(exeDir, "frontend"),
			filepath.Join(exeDir, "generated", "tictactoe", "frontend"),
		)
	}

	for _, candidate := range candidates {
		if _, err := os.Stat(candidate); err == nil {
			frontendPath = candidate
			break
		}
	}

	return func(w http.ResponseWriter, r *http.Request) {
		// No frontend found
		if frontendPath == "" {
			http.Error(w, "Frontend not found", http.StatusNotFound)
			return
		}

		// Clean the path
		path := strings.TrimPrefix(r.URL.Path, "/")
		if path == "" {
			path = "index.html"
		}

		// Try to serve the file
		fullPath := filepath.Join(frontendPath, path)

		// Check if file exists
		info, err := os.Stat(fullPath)
		if err != nil || info.IsDir() {
			// File doesn't exist, serve index.html for SPA routing
			http.ServeFile(w, r, filepath.Join(frontendPath, "index.html"))
			return
		}

		http.ServeFile(w, r, fullPath)
	}
}

// StaticFS is a helper interface for embedding static files (optional).
type StaticFS interface {
	fs.FS
}

// HandleCreate creates a new aggregate instance.
func HandleCreate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		id, err := app.Create(ctx)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "CREATE_FAILED", err.Error())
			return
		}

		// Load the new aggregate to get initial state
		agg, err := app.Load(ctx, id)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "LOAD_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusCreated, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleGetState returns the current state of an aggregate.
func HandleGetState(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		if id == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate ID is required")
			return
		}

		agg, err := app.GetState(ctx, id)
		if err != nil {
			api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleReady checks if the application is ready to serve requests.
// Returns 200 if all dependencies are available, 503 otherwise.
func HandleReady(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		checks := make(map[string]string)
		ready := true

		// Check event store connectivity
		if err := app.HealthCheck(r.Context()); err != nil {
			checks["eventstore"] = err.Error()
			ready = false
		} else {
			checks["eventstore"] = "ok"
		}

		status := http.StatusOK
		statusText := "ready"
		if !ready {
			status = http.StatusServiceUnavailable
			statusText = "not ready"
		}

		api.JSON(w, status, map[string]any{
			"status": statusText,
			"checks": checks,
		})
	}
}


// HandleXPlay00 handles the x_play_00 transition.
func HandleXPlay00(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay00, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay01 handles the x_play_01 transition.
func HandleXPlay01(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay01, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay02 handles the x_play_02 transition.
func HandleXPlay02(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay02, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay10 handles the x_play_10 transition.
func HandleXPlay10(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay10, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay11 handles the x_play_11 transition.
func HandleXPlay11(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay11, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay12 handles the x_play_12 transition.
func HandleXPlay12(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay12, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay20 handles the x_play_20 transition.
func HandleXPlay20(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay20, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay21 handles the x_play_21 transition.
func HandleXPlay21(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay21, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay22 handles the x_play_22 transition.
func HandleXPlay22(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay22, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay00 handles the o_play_00 transition.
func HandleOPlay00(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay00, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay01 handles the o_play_01 transition.
func HandleOPlay01(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay01, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay02 handles the o_play_02 transition.
func HandleOPlay02(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay02, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay10 handles the o_play_10 transition.
func HandleOPlay10(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay10, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay11 handles the o_play_11 transition.
func HandleOPlay11(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay11, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay12 handles the o_play_12 transition.
func HandleOPlay12(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay12, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay20 handles the o_play_20 transition.
func HandleOPlay20(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay20, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay21 handles the o_play_21 transition.
func HandleOPlay21(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay21, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay22 handles the o_play_22 transition.
func HandleOPlay22(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay22, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleReset handles the reset transition.
func HandleReset(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		// This transition clears event history, resetting to initial state
		agg, err := app.ResetStream(ctx, req.AggregateID)
		if err != nil {
			api.Error(w, http.StatusConflict, "RESET_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow0 handles the x_win_row0 transition.
func HandleXWinRow0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow1 handles the x_win_row1 transition.
func HandleXWinRow1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow2 handles the x_win_row2 transition.
func HandleXWinRow2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol0 handles the x_win_col0 transition.
func HandleXWinCol0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol1 handles the x_win_col1 transition.
func HandleXWinCol1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol2 handles the x_win_col2 transition.
func HandleXWinCol2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinDiag handles the x_win_diag transition.
func HandleXWinDiag(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinDiag, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinAnti handles the x_win_anti transition.
func HandleXWinAnti(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinAnti, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow0 handles the o_win_row0 transition.
func HandleOWinRow0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow1 handles the o_win_row1 transition.
func HandleOWinRow1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow2 handles the o_win_row2 transition.
func HandleOWinRow2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol0 handles the o_win_col0 transition.
func HandleOWinCol0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol1 handles the o_win_col1 transition.
func HandleOWinCol1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol2 handles the o_win_col2 transition.
func HandleOWinCol2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinDiag handles the o_win_diag transition.
func HandleOWinDiag(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinDiag, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinAnti handles the o_win_anti transition.
func HandleOWinAnti(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinAnti, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleDraw handles the draw transition.
func HandleDraw(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionDraw, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}






// HandleAdminStats wraps the admin stats handler.
func HandleAdminStats(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()

adminStore, ok := app.store.(interface {
GetStats(ctx context.Context) (*eventsource.Stats, error)
})
if !ok {
api.Error(w, http.StatusInternalServerError, "UNSUPPORTED", "Admin operations not supported")
return
}

stats, err := adminStore.GetStats(ctx)
if err != nil {
api.Error(w, http.StatusInternalServerError, "STATS_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, stats)
}
}

// HandleAdminListInstances wraps the admin list instances handler.
func HandleAdminListInstances(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()

place := r.URL.Query().Get("place")
from := r.URL.Query().Get("from")
to := r.URL.Query().Get("to")
page := getIntQueryParam(r, "page", 1)
perPage := getIntQueryParam(r, "per_page", 50)

adminStore, ok := app.store.(interface {
ListInstances(ctx context.Context, place, from, to string, page, perPage int) ([]eventsource.Instance, int, error)
})
if !ok {
api.Error(w, http.StatusInternalServerError, "UNSUPPORTED", "Admin operations not supported")
return
}

instances, total, err := adminStore.ListInstances(ctx, place, from, to, page, perPage)
if err != nil {
api.Error(w, http.StatusInternalServerError, "LIST_FAILED", err.Error())
return
}

// Load state for each instance by replaying events
// Note: This loads aggregates individually which may be slow for large lists.
// The perPage parameter limits the number of instances processed.
for i := range instances {
agg, err := app.Load(ctx, instances[i].ID)
if err != nil {
// Log error but continue processing other instances
// The state will remain as initialized by ListInstances
continue
}
// Get the Petri net places (token distribution)
instances[i].State = agg.Places()
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"instances": instances,
"total":     total,
"page":      page,
"per_page":  perPage,
})
}
}

// HandleAdminGetInstance wraps the admin get instance handler.
func HandleAdminGetInstance(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")

agg, err := app.Load(ctx, id)
if err != nil {
api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"id":      agg.ID(),
"version": agg.Version(),
"state":   agg.State(),
})
}
}

// HandleAdminGetEvents wraps the admin get events handler.
func HandleAdminGetEvents(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")
from := getIntQueryParam(r, "from", 0)

events, err := app.store.Read(ctx, id, from)
if err != nil {
api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"events": events,
})
}
}

// HandleAdminDeleteInstance deletes an instance and all its events.
func HandleAdminDeleteInstance(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")

if err := app.store.DeleteStream(ctx, id); err != nil {
api.Error(w, http.StatusInternalServerError, "DELETE_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"deleted": true,
"id":      id,
})
}
}



// HandleGetEvents returns the event history for an aggregate.
func HandleGetEvents(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		from := getIntQueryParam(r, "from", 0)

		events, err := app.store.Read(ctx, id, from)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"events": events,
		})
	}
}

// HandleGetStateAtVersion returns the aggregate state at a specific version.
func HandleGetStateAtVersion(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		versionStr := r.PathValue("version")

		version := getInt(versionStr, 0)
		if version <= 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be a positive integer")
			return
		}

		events, err := app.store.Read(ctx, id, 0)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		// Create temporary aggregate and replay up to version
		agg := NewAggregate(id)
		for _, evt := range events {
			if evt.Version > version {
				break
			}
			if err := agg.Apply(evt); err != nil {
				api.Error(w, http.StatusInternalServerError, "APPLY_FAILED", err.Error())
				return
			}
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":      agg.ID(),
			"version": version,
			"state":   agg.State(),
		})
	}
}

// HandleTruncate truncates the event stream to a specific version.
// This enables "undo and redo differently" workflows by discarding events after the target version.
func HandleTruncate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")

		var req struct {
			Version int `json:"version"`
		}
		if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", "request body must contain version field")
			return
		}

		if req.Version < 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be non-negative")
			return
		}

		agg, err := app.TruncateTo(ctx, id, req.Version)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "TRUNCATE_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":                    agg.ID(),
			"version":               agg.Version(),
			"state":                 agg.State(),
			"enabled_transitions":   agg.EnabledTransitions(),
		})
	}
}





// Helper functions

func getIntQueryParam(r *http.Request, name string, defaultVal int) int {
	val := r.URL.Query().Get(name)
	return getInt(val, defaultVal)
}

func getInt(s string, defaultVal int) int {
	if s == "" {
		return defaultVal
	}

	intVal, err := strconv.Atoi(s)
	if err != nil {
		return defaultVal
	}

	return intVal
}


// HandleGetSchema returns the model schema JSON for the schema viewer.
func HandleGetSchema() http.HandlerFunc {
	// Schema JSON is embedded at generation time (base64 encoded)
	schemaBase64 := "ewogICJuYW1lIjogInRpYy10YWMtdG9lIiwKICAidmVyc2lvbiI6ICIyLjAuMCIsCiAgImRlc2NyaXB0aW9uIjogIlRpYy10YWMtdG9lIGdhbWUgbW9kZWxlZCBhcyBhIFBldHJpIG5ldCB3aXRoIHdpbiBwYXR0ZXJucyBhcyB0cmFuc2l0aW9ucyBmb3IgT0RFLWJhc2VkIHN0cmF0ZWdpYyBhbmFseXNpcyIsCiAgInBsYWNlcyI6IFsKICAgIHsKICAgICAgImlkIjogInAwMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgwLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNzcwLAogICAgICAieSI6IDI1MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAwMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgwLDEpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODUwLAogICAgICAieSI6IDI1MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAwMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgwLDIpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogOTMwLAogICAgICAieSI6IDI1MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgxLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNzcwLAogICAgICAieSI6IDMzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgxLDEpIGVtcHR5IC0gY2VudGVyIiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODUwLAogICAgICAieSI6IDMzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgxLDIpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogOTMwLAogICAgICAieSI6IDMzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgyLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNzcwLAogICAgICAieSI6IDQxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgyLDEpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODUwLAogICAgICAieSI6IDQxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgyLDIpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogOTMwLAogICAgICAieSI6IDQxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIngwMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgwLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA1MzAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMCwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDExMTAsCiAgICAgICJ5IjogNTMwCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDAsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDUzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIngxMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgxLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA2MTAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MTEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMSwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDExMTAsCiAgICAgICJ5IjogNjEwCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDEsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDYxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIngyMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgyLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA2OTAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MjEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMiwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDExMTAsCiAgICAgICJ5IjogNjkwCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDIsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDY5MAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8wMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgwLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNTIwLAogICAgICAieSI6IDUyMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8wMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgwLDEpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjAwLAogICAgICAieSI6IDUyMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8wMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgwLDIpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDUyMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8xMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgxLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNTIwLAogICAgICAieSI6IDYwMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8xMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgxLDEpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjAwLAogICAgICAieSI6IDYwMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8xMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgxLDIpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDYwMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8yMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgyLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNTIwLAogICAgICAieSI6IDY4MAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8yMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgyLDEpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjAwLAogICAgICAieSI6IDY4MAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8yMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgyLDIpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDY4MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfdHVybiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYJ3MgdHVybiB0byBwbGF5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODYwLAogICAgICAieSI6IDQwCiAgICB9LAogICAgewogICAgICAiaWQiOiAib190dXJuIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8ncyB0dXJuIHRvIHBsYXkiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiA4NjAsCiAgICAgICJ5IjogMTIwCiAgICB9LAogICAgewogICAgICAiaWQiOiAid2luX3giLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBoYXMgd29uIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTExMCwKICAgICAgInkiOiAxMjAwCiAgICB9LAogICAgewogICAgICAiaWQiOiAid2luX28iLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBoYXMgd29uIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjEwLAogICAgICAieSI6IDExODAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJjYW5fcmVzZXQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiVG9rZW4gZW5hYmxpbmcgcmVzZXQgYWN0aW9uIiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNDAwLAogICAgICAieSI6IDQwCiAgICB9LAogICAgewogICAgICAiaWQiOiAiZ2FtZV9hY3RpdmUiLAogICAgICAiZGVzY3JpcHRpb24iOiAiR2FtZSBpcyBhY3RpdmUgKGNvbnN1bWVkIG9uIHdpbi9kcmF3IHRvIGVuZCBnYW1lKSIsCiAgICAgICJpbml0aWFsIjogMSwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDg1MCwKICAgICAgInkiOiA4MDAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJtb3ZlX3Rva2VucyIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJBY2N1bXVsYXRlcyB0b2tlbnMgYXMgbW92ZXMgYXJlIHBsYXllZCAoZm9yIGRyYXcgZGV0ZWN0aW9uKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDg1MCwKICAgICAgInkiOiA5MDAKICAgIH0KICBdLAogICJ0cmFuc2l0aW9ucyI6IFsKICAgIHsKICAgICAgImlkIjogInhfcGxheV8wMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgwLDApIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMDAiLAogICAgICAieCI6IDEwMzAsCiAgICAgICJ5IjogMjUwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMDAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzAxIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDAsMSkiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8wMSIsCiAgICAgICJ4IjogMTExMCwKICAgICAgInkiOiAyNTAsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQwMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMDIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMCwyKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzAyIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDI1MCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDAyIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8xMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgxLDApIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMTAiLAogICAgICAieCI6IDEwMzAsCiAgICAgICJ5IjogMzMwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMTAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzExIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDEsMSkgLSBjZW50ZXIiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8xMSIsCiAgICAgICJ4IjogMTExMCwKICAgICAgInkiOiAzMzAsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQxMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMTIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMSwyKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzEyIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDMzMCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDEyIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8yMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgyLDApIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMjAiLAogICAgICAieCI6IDEwMzAsCiAgICAgICJ5IjogNDEwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMjAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzIxIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDIsMSkiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8yMSIsCiAgICAgICJ4IjogMTExMCwKICAgICAgInkiOiA0MTAsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQyMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMjIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMiwyKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzIyIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDQxMCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDIyIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8wMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgwLDApIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMDAiLAogICAgICAieCI6IDUxMCwKICAgICAgInkiOiAyNTAsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQwMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMCwxKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzAxIiwKICAgICAgIngiOiA1OTAsCiAgICAgICJ5IjogMjUwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMDEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDAsMikiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8wMiIsCiAgICAgICJ4IjogNjcwLAogICAgICAieSI6IDI1MCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDAyIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8xMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgxLDApIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMTAiLAogICAgICAieCI6IDUxMCwKICAgICAgInkiOiAzMzAsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQxMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMTEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMSwxKSAtIGNlbnRlciIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzExIiwKICAgICAgIngiOiA1OTAsCiAgICAgICJ5IjogMzMwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMTEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDEsMikiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8xMiIsCiAgICAgICJ4IjogNjcwLAogICAgICAieSI6IDMzMCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDEyIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8yMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgyLDApIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMjAiLAogICAgICAieCI6IDUxMCwKICAgICAgInkiOiA0MTAsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQyMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMjEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMiwxKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzIxIiwKICAgICAgIngiOiA1OTAsCiAgICAgICJ5IjogNDEwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMjEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDIsMikiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8yMiIsCiAgICAgICJ4IjogNjcwLAogICAgICAieSI6IDQxMCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDIyIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInJlc2V0IiwKICAgICAgImRlc2NyaXB0aW9uIjogIlJlc2V0IGdhbWUgdG8gaW5pdGlhbCBzdGF0ZSIsCiAgICAgICJldmVudCI6ICJHYW1lUmVzZXQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9yZXNldCIsCiAgICAgICJjbGVhcnNIaXN0b3J5IjogdHJ1ZSwKICAgICAgIngiOiA0MDAsCiAgICAgICJ5IjogMTIwLAogICAgICAiZXZlbnRfdHlwZSI6ICJHYW1lUmVzZXQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF93aW5fcm93MCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHdpbnMgdG9wIHJvdyAoMCwwKS0oMCwxKS0oMCwyKSIsCiAgICAgICJldmVudCI6ICJYV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF93aW5fcm93MCIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA5MTAsCiAgICAgICJldmVudF90eXBlIjogIlhXb24wIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX3JvdzEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIG1pZGRsZSByb3cgKDEsMCktKDEsMSktKDEsMikiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX3JvdzEiLAogICAgICAieCI6IDEwMzAsCiAgICAgICJ5IjogOTkwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYV29uMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9yb3cyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyBib3R0b20gcm93ICgyLDApLSgyLDEpLSgyLDIpIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9yb3cyIiwKICAgICAgIngiOiAxMDMwLAogICAgICAieSI6IDEwNzAsCiAgICAgICJldmVudF90eXBlIjogIlhXb24yIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX2NvbDAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIGxlZnQgY29sdW1uICgwLDApLSgxLDApLSgyLDApIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9jb2wwIiwKICAgICAgIngiOiAxMTEwLAogICAgICAieSI6IDkxMCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbjAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF93aW5fY29sMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHdpbnMgY2VudGVyIGNvbHVtbiAoMCwxKS0oMSwxKS0oMiwxKSIsCiAgICAgICJldmVudCI6ICJYV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF93aW5fY29sMSIsCiAgICAgICJ4IjogMTExMCwKICAgICAgInkiOiA5OTAsCiAgICAgICJldmVudF90eXBlIjogIlhXb24xIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX2NvbDIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIHJpZ2h0IGNvbHVtbiAoMCwyKS0oMSwyKS0oMiwyKSIsCiAgICAgICJldmVudCI6ICJYV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF93aW5fY29sMiIsCiAgICAgICJ4IjogMTExMCwKICAgICAgInkiOiAxMDcwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYV29uMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9kaWFnIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyBtYWluIGRpYWdvbmFsICgwLDApLSgxLDEpLSgyLDIpIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9kaWFnIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDkxMCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9hbnRpIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyBhbnRpLWRpYWdvbmFsICgwLDIpLSgxLDEpLSgyLDApIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9hbnRpIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDEwNzAsCiAgICAgICJldmVudF90eXBlIjogIlhXb24iCiAgICB9LAogICAgewogICAgICAiaWQiOiAib193aW5fcm93MCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHdpbnMgdG9wIHJvdyAoMCwwKS0oMCwxKS0oMCwyKSIsCiAgICAgICJldmVudCI6ICJPV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb193aW5fcm93MCIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDg5MCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1dvbjAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib193aW5fcm93MSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHdpbnMgbWlkZGxlIHJvdyAoMSwwKS0oMSwxKS0oMSwyKSIsCiAgICAgICJldmVudCI6ICJPV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb193aW5fcm93MSIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDk3MCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1dvbjEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib193aW5fcm93MiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHdpbnMgYm90dG9tIHJvdyAoMiwwKS0oMiwxKS0oMiwyKSIsCiAgICAgICJldmVudCI6ICJPV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb193aW5fcm93MiIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDEwNTAsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24yIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fd2luX2NvbDAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyB3aW5zIGxlZnQgY29sdW1uICgwLDApLSgxLDApLSgyLDApIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9jb2wwIiwKICAgICAgIngiOiA2MDAsCiAgICAgICJ5IjogODkwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9jb2wxIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyBjZW50ZXIgY29sdW1uICgwLDEpLSgxLDEpLSgyLDEpIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9jb2wxIiwKICAgICAgIngiOiA2MDAsCiAgICAgICJ5IjogOTcwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9jb2wyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyByaWdodCBjb2x1bW4gKDAsMiktKDEsMiktKDIsMikiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX2NvbDIiLAogICAgICAieCI6IDYwMCwKICAgICAgInkiOiAxMDUwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9kaWFnIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyBtYWluIGRpYWdvbmFsICgwLDApLSgxLDEpLSgyLDIpIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9kaWFnIiwKICAgICAgIngiOiA1MjAsCiAgICAgICJ5IjogODkwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fd2luX2FudGkiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyB3aW5zIGFudGktZGlhZ29uYWwgKDAsMiktKDEsMSktKDIsMCkiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX2FudGkiLAogICAgICAieCI6IDUyMCwKICAgICAgInkiOiAxMDUwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uIgogICAgfSwKICAgIHsKICAgICAgImlkIjogImRyYXciLAogICAgICAiZGVzY3JpcHRpb24iOiAiR2FtZSBlbmRzIGluIGRyYXcgKGFsbCA5IG1vdmVzIHBsYXllZCwgbm8gd2lubmVyKSIsCiAgICAgICJldmVudCI6ICJHYW1lRHJhdyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL2RyYXciLAogICAgICAieCI6IDg1MCwKICAgICAgInkiOiAxMDAwLAogICAgICAiZXZlbnRfdHlwZSI6ICJHYW1lRHJhdyIKICAgIH0KICBdLAogICJhcmNzIjogWwogICAgewogICAgICAiZnJvbSI6ICJwMDAiLAogICAgICAidG8iOiAieF9wbGF5XzAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8wMCIsCiAgICAgICJ0byI6ICJ4MDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMDAiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzAwIiwKICAgICAgInRvIjogIm1vdmVfdG9rZW5zIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDAxIiwKICAgICAgInRvIjogInhfcGxheV8wMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMDEiLAogICAgICAidG8iOiAieDAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzAxIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8wMSIsCiAgICAgICJ0byI6ICJtb3ZlX3Rva2VucyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwMiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzAyIiwKICAgICAgInRvIjogIngwMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8wMiIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMDIiLAogICAgICAidG8iOiAibW92ZV90b2tlbnMiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMTAiLAogICAgICAidG8iOiAieF9wbGF5XzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8xMCIsCiAgICAgICJ0byI6ICJ4MTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMTAiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzEwIiwKICAgICAgInRvIjogIm1vdmVfdG9rZW5zIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDExIiwKICAgICAgInRvIjogInhfcGxheV8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMTEiLAogICAgICAidG8iOiAieDExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzExIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8xMSIsCiAgICAgICJ0byI6ICJtb3ZlX3Rva2VucyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxMiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzEyIiwKICAgICAgInRvIjogIngxMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8xMiIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMTIiLAogICAgICAidG8iOiAibW92ZV90b2tlbnMiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMjAiLAogICAgICAidG8iOiAieF9wbGF5XzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8yMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8yMCIsCiAgICAgICJ0byI6ICJ4MjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMjAiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzIwIiwKICAgICAgInRvIjogIm1vdmVfdG9rZW5zIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDIxIiwKICAgICAgInRvIjogInhfcGxheV8yMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMjEiLAogICAgICAidG8iOiAieDIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzIxIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8yMSIsCiAgICAgICJ0byI6ICJtb3ZlX3Rva2VucyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyMiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzIyIiwKICAgICAgInRvIjogIngyMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8yMiIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMjIiLAogICAgICAidG8iOiAibW92ZV90b2tlbnMiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMDAiLAogICAgICAidG8iOiAib19wbGF5XzAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8wMCIsCiAgICAgICJ0byI6ICJvMDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMDAiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzAwIiwKICAgICAgInRvIjogIm1vdmVfdG9rZW5zIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDAxIiwKICAgICAgInRvIjogIm9fcGxheV8wMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMDEiLAogICAgICAidG8iOiAibzAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzAxIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8wMSIsCiAgICAgICJ0byI6ICJtb3ZlX3Rva2VucyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwMiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzAyIiwKICAgICAgInRvIjogIm8wMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8wMiIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMDIiLAogICAgICAidG8iOiAibW92ZV90b2tlbnMiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMTAiLAogICAgICAidG8iOiAib19wbGF5XzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8xMCIsCiAgICAgICJ0byI6ICJvMTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMTAiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzEwIiwKICAgICAgInRvIjogIm1vdmVfdG9rZW5zIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDExIiwKICAgICAgInRvIjogIm9fcGxheV8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMTEiLAogICAgICAidG8iOiAibzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzExIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8xMSIsCiAgICAgICJ0byI6ICJtb3ZlX3Rva2VucyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxMiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzEyIiwKICAgICAgInRvIjogIm8xMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8xMiIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMTIiLAogICAgICAidG8iOiAibW92ZV90b2tlbnMiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMjAiLAogICAgICAidG8iOiAib19wbGF5XzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8yMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8yMCIsCiAgICAgICJ0byI6ICJvMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMjAiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzIwIiwKICAgICAgInRvIjogIm1vdmVfdG9rZW5zIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDIxIiwKICAgICAgInRvIjogIm9fcGxheV8yMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMjEiLAogICAgICAidG8iOiAibzIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzIxIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8yMSIsCiAgICAgICJ0byI6ICJtb3ZlX3Rva2VucyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyMiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzIyIiwKICAgICAgInRvIjogIm8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8yMiIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMjIiLAogICAgICAidG8iOiAibW92ZV90b2tlbnMiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDAiLAogICAgICAidG8iOiAieF93aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngwMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAyIiwKICAgICAgInRvIjogInhfd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogInhfd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cwIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MCIsCiAgICAgICJ0byI6ICJ4MDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cwIiwKICAgICAgInRvIjogIngwMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzAiLAogICAgICAidG8iOiAieDAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDEwIiwKICAgICAgInRvIjogInhfd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTEiLAogICAgICAidG8iOiAieF93aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MSIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzEiLAogICAgICAidG8iOiAieDEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MSIsCiAgICAgICJ0byI6ICJ4MTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cxIiwKICAgICAgInRvIjogIngxMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMCIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIxIiwKICAgICAgInRvIjogInhfd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MjIiLAogICAgICAidG8iOiAieF93aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogInhfd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAieF93aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzIiLAogICAgICAidG8iOiAid2luX3giCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cyIiwKICAgICAgInRvIjogIngyMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzIiLAogICAgICAidG8iOiAieDIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MiIsCiAgICAgICJ0byI6ICJ4MjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDAiLAogICAgICAidG8iOiAieF93aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMCIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIwIiwKICAgICAgInRvIjogInhfd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogInhfd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wwIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMCIsCiAgICAgICJ0byI6ICJ4MDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wwIiwKICAgICAgInRvIjogIngxMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDAiLAogICAgICAidG8iOiAieDIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAxIiwKICAgICAgInRvIjogInhfd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTEiLAogICAgICAidG8iOiAieF93aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMSIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDEiLAogICAgICAidG8iOiAieDAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMSIsCiAgICAgICJ0byI6ICJ4MTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wxIiwKICAgICAgInRvIjogIngyMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngwMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDEyIiwKICAgICAgInRvIjogInhfd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MjIiLAogICAgICAidG8iOiAieF93aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogInhfd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAieF93aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDIiLAogICAgICAidG8iOiAid2luX3giCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wyIiwKICAgICAgInRvIjogIngwMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDIiLAogICAgICAidG8iOiAieDEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMiIsCiAgICAgICJ0byI6ICJ4MjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDAiLAogICAgICAidG8iOiAieF93aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIyIiwKICAgICAgInRvIjogInhfd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogInhfd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9kaWFnIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fZGlhZyIsCiAgICAgICJ0byI6ICJ4MDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9kaWFnIiwKICAgICAgInRvIjogIngxMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2RpYWciLAogICAgICAidG8iOiAieDIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAyIiwKICAgICAgInRvIjogInhfd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTEiLAogICAgICAidG8iOiAieF93aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMCIsCiAgICAgICJ0byI6ICJ4X3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJ4X3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fYW50aSIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2FudGkiLAogICAgICAidG8iOiAieDAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fYW50aSIsCiAgICAgICJ0byI6ICJ4MTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9hbnRpIiwKICAgICAgInRvIjogIngyMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMCIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAxIiwKICAgICAgInRvIjogIm9fd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDIiLAogICAgICAidG8iOiAib193aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAib193aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzAiLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cwIiwKICAgICAgInRvIjogIm8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzAiLAogICAgICAidG8iOiAibzAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MCIsCiAgICAgICJ0byI6ICJvMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTAiLAogICAgICAidG8iOiAib193aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMSIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzEyIiwKICAgICAgInRvIjogIm9fd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogIm9fd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cxIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MSIsCiAgICAgICJ0byI6ICJvMTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cxIiwKICAgICAgInRvIjogIm8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzEiLAogICAgICAidG8iOiAibzEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIwIiwKICAgICAgInRvIjogIm9fd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjEiLAogICAgICAidG8iOiAib193aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMiIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MiIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzIiLAogICAgICAidG8iOiAibzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MiIsCiAgICAgICJ0byI6ICJvMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cyIiwKICAgICAgInRvIjogIm8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMCIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzEwIiwKICAgICAgInRvIjogIm9fd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjAiLAogICAgICAidG8iOiAib193aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAib193aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDAiLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wwIiwKICAgICAgInRvIjogIm8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDAiLAogICAgICAidG8iOiAibzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMCIsCiAgICAgICJ0byI6ICJvMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDEiLAogICAgICAidG8iOiAib193aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMSIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIxIiwKICAgICAgInRvIjogIm9fd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogIm9fd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wxIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMSIsCiAgICAgICJ0byI6ICJvMDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wxIiwKICAgICAgInRvIjogIm8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDEiLAogICAgICAidG8iOiAibzIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAyIiwKICAgICAgInRvIjogIm9fd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTIiLAogICAgICAidG8iOiAib193aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMiIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMiIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDIiLAogICAgICAidG8iOiAibzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMiIsCiAgICAgICJ0byI6ICJvMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wyIiwKICAgICAgInRvIjogIm8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMCIsCiAgICAgICJ0byI6ICJvX3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzExIiwKICAgICAgInRvIjogIm9fd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjIiLAogICAgICAidG8iOiAib193aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAib193aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2RpYWciLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9kaWFnIiwKICAgICAgInRvIjogIm8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2RpYWciLAogICAgICAidG8iOiAibzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fZGlhZyIsCiAgICAgICJ0byI6ICJvMjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDIiLAogICAgICAidG8iOiAib193aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMSIsCiAgICAgICJ0byI6ICJvX3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIwIiwKICAgICAgInRvIjogIm9fd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogIm9fd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9hbnRpIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fYW50aSIsCiAgICAgICJ0byI6ICJvMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9hbnRpIiwKICAgICAgInRvIjogIm8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2FudGkiLAogICAgICAidG8iOiAibzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibW92ZV90b2tlbnMiLAogICAgICAidG8iOiAiZHJhdyIsCiAgICAgICJ3ZWlnaHQiOiA5CiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJkcmF3IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZHJhdyIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImNhbl9yZXNldCIsCiAgICAgICJ0byI6ICJyZXNldCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInJlc2V0IiwKICAgICAgInRvIjogImNhbl9yZXNldCIKICAgIH0KICBdLAogICJldmVudHMiOiBbCiAgICB7CiAgICAgICJpZCI6ICJYUGxheWVkIiwKICAgICAgIm5hbWUiOiAiWFBsYXllZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYWNlZCBhIHBpZWNlIG9uIHRoZSBib2FyZCIsCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicm93IiwKICAgICAgICAgICJ0eXBlIjogImludGVnZXIiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29sIiwKICAgICAgICAgICJ0eXBlIjogImludGVnZXIiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgImlkIjogIk9QbGF5ZWQiLAogICAgICAibmFtZSI6ICJPUGxheWVkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxhY2VkIGEgcGllY2Ugb24gdGhlIGJvYXJkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJyb3ciLAogICAgICAgICAgInR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb2wiLAogICAgICAgICAgInR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAiR2FtZVJlc2V0IiwKICAgICAgIm5hbWUiOiAiR2FtZVJlc2V0IiwKICAgICAgImRlc2NyaXB0aW9uIjogIkdhbWUgd2FzIHJlc2V0IHRvIGluaXRpYWwgc3RhdGUiLAogICAgICAiZmllbGRzIjogbnVsbAogICAgfSwKICAgIHsKICAgICAgImlkIjogIkdhbWVEcmF3IiwKICAgICAgIm5hbWUiOiAiR2FtZURyYXciLAogICAgICAiZGVzY3JpcHRpb24iOiAiR2FtZSBlbmRlZCBpbiBhIGRyYXcgKGFsbCA5IG1vdmVzIHBsYXllZCwgbm8gd2lubmVyKSIsCiAgICAgICJmaWVsZHMiOiBudWxsCiAgICB9CiAgXSwKICAic2ltdWxhdGlvbiI6IHsKICAgICJvYmplY3RpdmUiOiAid2luX3ggLSB3aW5fbyIsCiAgICAicGxheWVycyI6IHsKICAgICAgIm8iOiB7CiAgICAgICAgIm1heGltaXplcyI6IGZhbHNlLAogICAgICAgICJ0dXJuUGxhY2UiOiAib190dXJuIiwKICAgICAgICAidHJhbnNpdGlvbnMiOiBbCiAgICAgICAgICAib19wbGF5XzAwIiwKICAgICAgICAgICJvX3BsYXlfMDEiLAogICAgICAgICAgIm9fcGxheV8wMiIsCiAgICAgICAgICAib19wbGF5XzEwIiwKICAgICAgICAgICJvX3BsYXlfMTEiLAogICAgICAgICAgIm9fcGxheV8xMiIsCiAgICAgICAgICAib19wbGF5XzIwIiwKICAgICAgICAgICJvX3BsYXlfMjEiLAogICAgICAgICAgIm9fcGxheV8yMiIKICAgICAgICBdCiAgICAgIH0sCiAgICAgICJ4IjogewogICAgICAgICJtYXhpbWl6ZXMiOiB0cnVlLAogICAgICAgICJ0dXJuUGxhY2UiOiAieF90dXJuIiwKICAgICAgICAidHJhbnNpdGlvbnMiOiBbCiAgICAgICAgICAieF9wbGF5XzAwIiwKICAgICAgICAgICJ4X3BsYXlfMDEiLAogICAgICAgICAgInhfcGxheV8wMiIsCiAgICAgICAgICAieF9wbGF5XzEwIiwKICAgICAgICAgICJ4X3BsYXlfMTEiLAogICAgICAgICAgInhfcGxheV8xMiIsCiAgICAgICAgICAieF9wbGF5XzIwIiwKICAgICAgICAgICJ4X3BsYXlfMjEiLAogICAgICAgICAgInhfcGxheV8yMiIKICAgICAgICBdCiAgICAgIH0KICAgIH0sCiAgICAic29sdmVyIjogewogICAgICAidHNwYW4iOiBbCiAgICAgICAgMCwKICAgICAgICAxMAogICAgICBdLAogICAgICAiZHQiOiAwLjAxCiAgICB9CiAgfQp9"

	return func(w http.ResponseWriter, r *http.Request) {
		schemaJSON, err := base64.StdEncoding.DecodeString(schemaBase64)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "schema_decode_error", "Failed to decode schema")
			return
		}
		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusOK)
		w.Write(schemaJSON)
	}
}

