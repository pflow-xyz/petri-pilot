// Code generated by petri-pilot. DO NOT EDIT.

package tictactoe

import (
	"context"
	"encoding/base64"
	"encoding/json"
	"io/fs"
	"net/http"
	"os"
	"path/filepath"
	"strconv"
	"strings"

	"github.com/pflow-xyz/petri-pilot/pkg/runtime/api"
	"github.com/pflow-xyz/go-pflow/eventsource"
)

// BuildRouter creates an HTTP router for the tic-tac-toe workflow.
func BuildRouter(app *Application, debugBroker *DebugBroker, softDeleteStore *SoftDeleteStore) http.Handler {
	r := api.NewRouter()

	// Health check - always returns ok if server is running
	r.GET("/health", "Health check", func(w http.ResponseWriter, r *http.Request) {
		api.JSON(w, http.StatusOK, map[string]string{"status": "ok"})
	})

	// Readiness check - verifies dependencies (database, etc.)
	r.GET("/ready", "Readiness check", HandleReady(app))

	// Create new aggregate
	r.POST("/api/tictactoe", "Create new tic-tac-toe", HandleCreate(app))

	// Get aggregate state
	r.GET("/api/tictactoe/{id}", "Get tic-tac-toe state", HandleGetState(app))


	// Schema viewer endpoint
	r.GET("/api/schema", "Get model schema", HandleGetSchema())


	// Admin endpoints
	r.GET("/admin/stats", "Admin statistics", HandleAdminStats(app))
	r.GET("/admin/instances", "List instances", HandleAdminListInstances(app, softDeleteStore))
	r.GET("/admin/instances/{id}", "Get instance detail", HandleAdminGetInstance(app))
	r.GET("/admin/instances/{id}/events", "Get instance events", HandleAdminGetEvents(app))
	r.DELETE("/admin/instances/{id}", "Delete instance permanently", HandleAdminDeleteInstance(app))
	r.POST("/admin/instances/{id}/archive", "Archive instance (soft delete)", HandleAdminArchiveInstance(softDeleteStore))
	r.POST("/admin/instances/{id}/restore", "Restore archived instance", HandleAdminRestoreInstance(softDeleteStore))


	// Event replay endpoints
	r.GET("/api/tictactoe/{id}/events", "Get event history", HandleGetEvents(app))
	r.GET("/api/tictactoe/{id}/at/{version}", "Get state at version", HandleGetStateAtVersion(app))
	r.POST("/api/tictactoe/{id}/truncate", "Truncate event history to version", HandleTruncate(app))






	// Debug WebSocket and eval endpoints
	r.GET("/ws", "Debug WebSocket connection", HandleDebugWebSocket(debugBroker))
	r.GET("/api/debug/sessions", "List debug sessions", HandleListSessions(debugBroker))
	r.POST("/api/debug/sessions/{id}/eval", "Evaluate code in browser session", HandleSessionEval(debugBroker))

















	// Soft delete endpoints
	r.Handle("DELETE", "/api/tictactoe/{id}", "Soft delete entity", softDeleteStore.HandleSoftDelete)
	r.POST("/api/tictactoe/{id}/restore", "Restore deleted entity", softDeleteStore.HandleRestore)

	// Transition endpoints
	r.Transition("x_play_00", "/api/x_play_00", "X plays at (0,0)", HandleXPlay00(app))
	r.Transition("x_play_01", "/api/x_play_01", "X plays at (0,1)", HandleXPlay01(app))
	r.Transition("x_play_02", "/api/x_play_02", "X plays at (0,2)", HandleXPlay02(app))
	r.Transition("x_play_10", "/api/x_play_10", "X plays at (1,0)", HandleXPlay10(app))
	r.Transition("x_play_11", "/api/x_play_11", "X plays at (1,1) - center", HandleXPlay11(app))
	r.Transition("x_play_12", "/api/x_play_12", "X plays at (1,2)", HandleXPlay12(app))
	r.Transition("x_play_20", "/api/x_play_20", "X plays at (2,0)", HandleXPlay20(app))
	r.Transition("x_play_21", "/api/x_play_21", "X plays at (2,1)", HandleXPlay21(app))
	r.Transition("x_play_22", "/api/x_play_22", "X plays at (2,2)", HandleXPlay22(app))
	r.Transition("o_play_00", "/api/o_play_00", "O plays at (0,0)", HandleOPlay00(app))
	r.Transition("o_play_01", "/api/o_play_01", "O plays at (0,1)", HandleOPlay01(app))
	r.Transition("o_play_02", "/api/o_play_02", "O plays at (0,2)", HandleOPlay02(app))
	r.Transition("o_play_10", "/api/o_play_10", "O plays at (1,0)", HandleOPlay10(app))
	r.Transition("o_play_11", "/api/o_play_11", "O plays at (1,1) - center", HandleOPlay11(app))
	r.Transition("o_play_12", "/api/o_play_12", "O plays at (1,2)", HandleOPlay12(app))
	r.Transition("o_play_20", "/api/o_play_20", "O plays at (2,0)", HandleOPlay20(app))
	r.Transition("o_play_21", "/api/o_play_21", "O plays at (2,1)", HandleOPlay21(app))
	r.Transition("o_play_22", "/api/o_play_22", "O plays at (2,2)", HandleOPlay22(app))
	r.Transition("reset", "/api/reset", "Reset game to initial state", HandleReset(app))
	r.Transition("x_win_row0", "/api/x_win_row0", "X wins top row (0,0)-(0,1)-(0,2)", HandleXWinRow0(app))
	r.Transition("x_win_row1", "/api/x_win_row1", "X wins middle row (1,0)-(1,1)-(1,2)", HandleXWinRow1(app))
	r.Transition("x_win_row2", "/api/x_win_row2", "X wins bottom row (2,0)-(2,1)-(2,2)", HandleXWinRow2(app))
	r.Transition("x_win_col0", "/api/x_win_col0", "X wins left column (0,0)-(1,0)-(2,0)", HandleXWinCol0(app))
	r.Transition("x_win_col1", "/api/x_win_col1", "X wins center column (0,1)-(1,1)-(2,1)", HandleXWinCol1(app))
	r.Transition("x_win_col2", "/api/x_win_col2", "X wins right column (0,2)-(1,2)-(2,2)", HandleXWinCol2(app))
	r.Transition("x_win_diag", "/api/x_win_diag", "X wins main diagonal (0,0)-(1,1)-(2,2)", HandleXWinDiag(app))
	r.Transition("x_win_anti", "/api/x_win_anti", "X wins anti-diagonal (0,2)-(1,1)-(2,0)", HandleXWinAnti(app))
	r.Transition("o_win_row0", "/api/o_win_row0", "O wins top row (0,0)-(0,1)-(0,2)", HandleOWinRow0(app))
	r.Transition("o_win_row1", "/api/o_win_row1", "O wins middle row (1,0)-(1,1)-(1,2)", HandleOWinRow1(app))
	r.Transition("o_win_row2", "/api/o_win_row2", "O wins bottom row (2,0)-(2,1)-(2,2)", HandleOWinRow2(app))
	r.Transition("o_win_col0", "/api/o_win_col0", "O wins left column (0,0)-(1,0)-(2,0)", HandleOWinCol0(app))
	r.Transition("o_win_col1", "/api/o_win_col1", "O wins center column (0,1)-(1,1)-(2,1)", HandleOWinCol1(app))
	r.Transition("o_win_col2", "/api/o_win_col2", "O wins right column (0,2)-(1,2)-(2,2)", HandleOWinCol2(app))
	r.Transition("o_win_diag", "/api/o_win_diag", "O wins main diagonal (0,0)-(1,1)-(2,2)", HandleOWinDiag(app))
	r.Transition("o_win_anti", "/api/o_win_anti", "O wins anti-diagonal (0,2)-(1,1)-(2,0)", HandleOWinAnti(app))

	// Serve frontend static files
	r.StaticFiles("/", StaticFileHandler())

	return r.Build()
}

// StaticFileHandler returns an http.Handler that serves static files from frontend/.
// It supports SPA routing by returning index.html for paths that don't match static files.
func StaticFileHandler() http.HandlerFunc {
	// Find frontend directory - try custom frontends first, then generated
	frontendPath := ""
	candidates := []string{
		"frontends/tic-tac-toe",                    // Custom frontend (top priority)
		"frontend",                                    // Running from service directory
		"generated/main/frontend",         // Generated frontend from repo root
		filepath.Join("generated", "main", "frontend"), // Platform-safe
	}

	// Also try relative to executable
	if exe, err := os.Executable(); err == nil {
		exeDir := filepath.Dir(exe)
		candidates = append(candidates,
			filepath.Join(exeDir, "frontends", "tic-tac-toe"),
			filepath.Join(exeDir, "frontend"),
			filepath.Join(exeDir, "generated", "main", "frontend"),
		)
	}

	for _, candidate := range candidates {
		if _, err := os.Stat(candidate); err == nil {
			frontendPath = candidate
			break
		}
	}

	return func(w http.ResponseWriter, r *http.Request) {
		// No frontend found
		if frontendPath == "" {
			http.Error(w, "Frontend not found", http.StatusNotFound)
			return
		}

		// Clean the path
		path := strings.TrimPrefix(r.URL.Path, "/")
		if path == "" {
			path = "index.html"
		}

		// Try to serve the file
		fullPath := filepath.Join(frontendPath, path)

		// Check if file exists
		info, err := os.Stat(fullPath)
		if err != nil || info.IsDir() {
			// File doesn't exist, serve index.html for SPA routing
			http.ServeFile(w, r, filepath.Join(frontendPath, "index.html"))
			return
		}

		http.ServeFile(w, r, fullPath)
	}
}

// StaticFS is a helper interface for embedding static files (optional).
type StaticFS interface {
	fs.FS
}

// HandleCreate creates a new aggregate instance.
func HandleCreate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		id, err := app.Create(ctx)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "CREATE_FAILED", err.Error())
			return
		}

		// Load the new aggregate to get initial state
		agg, err := app.Load(ctx, id)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "LOAD_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusCreated, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleGetState returns the current state of an aggregate.
func HandleGetState(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		if id == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate ID is required")
			return
		}

		agg, err := app.GetState(ctx, id)
		if err != nil {
			api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleReady checks if the application is ready to serve requests.
// Returns 200 if all dependencies are available, 503 otherwise.
func HandleReady(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		checks := make(map[string]string)
		ready := true

		// Check event store connectivity
		if err := app.HealthCheck(r.Context()); err != nil {
			checks["eventstore"] = err.Error()
			ready = false
		} else {
			checks["eventstore"] = "ok"
		}

		status := http.StatusOK
		statusText := "ready"
		if !ready {
			status = http.StatusServiceUnavailable
			statusText = "not ready"
		}

		api.JSON(w, status, map[string]any{
			"status": statusText,
			"checks": checks,
		})
	}
}


// HandleXPlay00 handles the x_play_00 transition.
func HandleXPlay00(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay00, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay01 handles the x_play_01 transition.
func HandleXPlay01(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay01, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay02 handles the x_play_02 transition.
func HandleXPlay02(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay02, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay10 handles the x_play_10 transition.
func HandleXPlay10(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay10, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay11 handles the x_play_11 transition.
func HandleXPlay11(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay11, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay12 handles the x_play_12 transition.
func HandleXPlay12(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay12, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay20 handles the x_play_20 transition.
func HandleXPlay20(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay20, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay21 handles the x_play_21 transition.
func HandleXPlay21(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay21, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay22 handles the x_play_22 transition.
func HandleXPlay22(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay22, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay00 handles the o_play_00 transition.
func HandleOPlay00(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay00, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay01 handles the o_play_01 transition.
func HandleOPlay01(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay01, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay02 handles the o_play_02 transition.
func HandleOPlay02(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay02, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay10 handles the o_play_10 transition.
func HandleOPlay10(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay10, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay11 handles the o_play_11 transition.
func HandleOPlay11(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay11, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay12 handles the o_play_12 transition.
func HandleOPlay12(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay12, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay20 handles the o_play_20 transition.
func HandleOPlay20(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay20, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay21 handles the o_play_21 transition.
func HandleOPlay21(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay21, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay22 handles the o_play_22 transition.
func HandleOPlay22(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay22, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleReset handles the reset transition.
func HandleReset(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		// This transition clears event history, resetting to initial state
		agg, err := app.ResetStream(ctx, req.AggregateID)
		if err != nil {
			api.Error(w, http.StatusConflict, "RESET_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow0 handles the x_win_row0 transition.
func HandleXWinRow0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow1 handles the x_win_row1 transition.
func HandleXWinRow1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow2 handles the x_win_row2 transition.
func HandleXWinRow2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol0 handles the x_win_col0 transition.
func HandleXWinCol0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol1 handles the x_win_col1 transition.
func HandleXWinCol1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol2 handles the x_win_col2 transition.
func HandleXWinCol2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinDiag handles the x_win_diag transition.
func HandleXWinDiag(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinDiag, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinAnti handles the x_win_anti transition.
func HandleXWinAnti(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinAnti, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow0 handles the o_win_row0 transition.
func HandleOWinRow0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow1 handles the o_win_row1 transition.
func HandleOWinRow1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow2 handles the o_win_row2 transition.
func HandleOWinRow2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol0 handles the o_win_col0 transition.
func HandleOWinCol0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol1 handles the o_win_col1 transition.
func HandleOWinCol1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol2 handles the o_win_col2 transition.
func HandleOWinCol2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinDiag handles the o_win_diag transition.
func HandleOWinDiag(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinDiag, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinAnti handles the o_win_anti transition.
func HandleOWinAnti(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinAnti, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}






// HandleAdminStats wraps the admin stats handler.
func HandleAdminStats(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()

adminStore, ok := app.store.(interface {
GetStats(ctx context.Context) (*eventsource.Stats, error)
})
if !ok {
api.Error(w, http.StatusInternalServerError, "UNSUPPORTED", "Admin operations not supported")
return
}

stats, err := adminStore.GetStats(ctx)
if err != nil {
api.Error(w, http.StatusInternalServerError, "STATS_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, stats)
}
}

// HandleAdminListInstances wraps the admin list instances handler.
func HandleAdminListInstances(app *Application, softDeleteStore *SoftDeleteStore) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()

place := r.URL.Query().Get("place")
from := r.URL.Query().Get("from")
to := r.URL.Query().Get("to")
page := getIntQueryParam(r, "page", 1)
perPage := getIntQueryParam(r, "per_page", 50)
showArchived := r.URL.Query().Get("archived") == "true"

adminStore, ok := app.store.(interface {
ListInstances(ctx context.Context, place, from, to string, page, perPage int) ([]eventsource.Instance, int, error)
})
if !ok {
api.Error(w, http.StatusInternalServerError, "UNSUPPORTED", "Admin operations not supported")
return
}

instances, total, err := adminStore.ListInstances(ctx, place, from, to, page, perPage)
if err != nil {
api.Error(w, http.StatusInternalServerError, "LIST_FAILED", err.Error())
return
}
// Filter out archived instances unless explicitly requested
var filteredInstances []eventsource.Instance
var archivedInstances []eventsource.Instance
for _, inst := range instances {
if softDeleteStore.IsDeleted(inst.ID) {
archivedInstances = append(archivedInstances, inst)
} else {
filteredInstances = append(filteredInstances, inst)
}
}
if showArchived {
instances = archivedInstances
} else {
instances = filteredInstances
}

// Load state for each instance by replaying events
// Note: This loads aggregates individually which may be slow for large lists.
// The perPage parameter limits the number of instances processed.
for i := range instances {
agg, err := app.Load(ctx, instances[i].ID)
if err != nil {
// Log error but continue processing other instances
// The state will remain as initialized by ListInstances
continue
}
// Get the Petri net places (token distribution)
instances[i].State = agg.Places()
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"instances": instances,
"total":     total,
"page":      page,
"per_page":  perPage,
"has_soft_delete": true,
})
}
}

// HandleAdminGetInstance wraps the admin get instance handler.
func HandleAdminGetInstance(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")

agg, err := app.Load(ctx, id)
if err != nil {
api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"id":      agg.ID(),
"version": agg.Version(),
"state":   agg.State(),
})
}
}

// HandleAdminGetEvents wraps the admin get events handler.
func HandleAdminGetEvents(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")
from := getIntQueryParam(r, "from", 0)

events, err := app.store.Read(ctx, id, from)
if err != nil {
api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"events": events,
})
}
}

// HandleAdminDeleteInstance deletes an instance and all its events.
func HandleAdminDeleteInstance(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")

if err := app.store.DeleteStream(ctx, id); err != nil {
api.Error(w, http.StatusInternalServerError, "DELETE_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"deleted": true,
"id":      id,
})
}
}
// HandleAdminArchiveInstance soft-deletes an instance (marks as archived).
func HandleAdminArchiveInstance(softDeleteStore *SoftDeleteStore) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
id := r.PathValue("id")
userID := getSoftDeleteUserID(r)

if err := softDeleteStore.SoftDelete(id, userID); err != nil {
api.Error(w, http.StatusInternalServerError, "ARCHIVE_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"archived": true,
"id":       id,
})
}
}

// HandleAdminRestoreInstance restores a soft-deleted instance.
func HandleAdminRestoreInstance(softDeleteStore *SoftDeleteStore) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
id := r.PathValue("id")

if err := softDeleteStore.Restore(id); err != nil {
api.Error(w, http.StatusInternalServerError, "RESTORE_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"restored": true,
"id":       id,
})
}
}



// HandleGetEvents returns the event history for an aggregate.
func HandleGetEvents(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		from := getIntQueryParam(r, "from", 0)

		events, err := app.store.Read(ctx, id, from)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"events": events,
		})
	}
}

// HandleGetStateAtVersion returns the aggregate state at a specific version.
func HandleGetStateAtVersion(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		versionStr := r.PathValue("version")

		version := getInt(versionStr, 0)
		if version <= 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be a positive integer")
			return
		}

		events, err := app.store.Read(ctx, id, 0)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		// Create temporary aggregate and replay up to version
		agg := NewAggregate(id)
		for _, evt := range events {
			if evt.Version > version {
				break
			}
			if err := agg.Apply(evt); err != nil {
				api.Error(w, http.StatusInternalServerError, "APPLY_FAILED", err.Error())
				return
			}
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":      agg.ID(),
			"version": version,
			"state":   agg.State(),
		})
	}
}

// HandleTruncate truncates the event stream to a specific version.
// This enables "undo and redo differently" workflows by discarding events after the target version.
func HandleTruncate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")

		var req struct {
			Version int `json:"version"`
		}
		if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", "request body must contain version field")
			return
		}

		if req.Version < 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be non-negative")
			return
		}

		agg, err := app.TruncateTo(ctx, id, req.Version)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "TRUNCATE_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":                    agg.ID(),
			"version":               agg.Version(),
			"state":                 agg.State(),
			"enabled_transitions":   agg.EnabledTransitions(),
		})
	}
}





// Helper functions

func getIntQueryParam(r *http.Request, name string, defaultVal int) int {
	val := r.URL.Query().Get(name)
	return getInt(val, defaultVal)
}

func getInt(s string, defaultVal int) int {
	if s == "" {
		return defaultVal
	}

	intVal, err := strconv.Atoi(s)
	if err != nil {
		return defaultVal
	}

	return intVal
}


// HandleGetSchema returns the model schema JSON for the schema viewer.
func HandleGetSchema() http.HandlerFunc {
	// Schema JSON is embedded at generation time (base64 encoded)
	schemaBase64 := "ewogICJuYW1lIjogInRpYy10YWMtdG9lIiwKICAidmVyc2lvbiI6ICIyLjAuMCIsCiAgImRlc2NyaXB0aW9uIjogIlRpYy10YWMtdG9lIGdhbWUgbW9kZWxlZCBhcyBhIFBldHJpIG5ldCB3aXRoIHdpbiBwYXR0ZXJucyBhcyB0cmFuc2l0aW9ucyBmb3IgT0RFLWJhc2VkIHN0cmF0ZWdpYyBhbmFseXNpcyIsCiAgInBsYWNlcyI6IFsKICAgIHsKICAgICAgImlkIjogInAwMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgwLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNzcwLAogICAgICAieSI6IDI1MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAwMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgwLDEpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODUwLAogICAgICAieSI6IDI1MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAwMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgwLDIpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogOTMwLAogICAgICAieSI6IDI1MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgxLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNzcwLAogICAgICAieSI6IDMzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgxLDEpIGVtcHR5IC0gY2VudGVyIiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODUwLAogICAgICAieSI6IDMzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgxLDIpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogOTMwLAogICAgICAieSI6IDMzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgyLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNzcwLAogICAgICAieSI6IDQxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgyLDEpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODUwLAogICAgICAieSI6IDQxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgyLDIpIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogOTMwLAogICAgICAieSI6IDQxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIngwMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgwLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA1MzAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMCwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDExMTAsCiAgICAgICJ5IjogNTMwCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDAsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDUzMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIngxMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgxLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA2MTAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MTEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMSwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDExMTAsCiAgICAgICJ5IjogNjEwCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDEsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDYxMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIngyMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgyLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA2OTAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MjEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMiwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iLAogICAgICAieCI6IDExMTAsCiAgICAgICJ5IjogNjkwCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDIsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiAxMTkwLAogICAgICAieSI6IDY5MAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8wMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgwLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNTIwLAogICAgICAieSI6IDUyMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8wMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgwLDEpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjAwLAogICAgICAieSI6IDUyMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8wMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgwLDIpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDUyMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8xMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgxLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNTIwLAogICAgICAieSI6IDYwMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8xMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgxLDEpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjAwLAogICAgICAieSI6IDYwMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8xMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgxLDIpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDYwMAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8yMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgyLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNTIwLAogICAgICAieSI6IDY4MAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8yMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgyLDEpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjAwLAogICAgICAieSI6IDY4MAogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8yMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgyLDIpIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjgwLAogICAgICAieSI6IDY4MAogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfdHVybiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYJ3MgdHVybiB0byBwbGF5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODYwLAogICAgICAieSI6IDQwCiAgICB9LAogICAgewogICAgICAiaWQiOiAib190dXJuIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8ncyB0dXJuIHRvIHBsYXkiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIiwKICAgICAgIngiOiA4NjAsCiAgICAgICJ5IjogMTIwCiAgICB9LAogICAgewogICAgICAiaWQiOiAid2luX3giLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBoYXMgd29uIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogMTExMCwKICAgICAgInkiOiAxMjAwCiAgICB9LAogICAgewogICAgICAiaWQiOiAid2luX28iLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBoYXMgd29uIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNjEwLAogICAgICAieSI6IDExODAKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJjYW5fcmVzZXQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiVG9rZW4gZW5hYmxpbmcgcmVzZXQgYWN0aW9uIiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogNDAwLAogICAgICAieSI6IDQwCiAgICB9LAogICAgewogICAgICAiaWQiOiAiZ2FtZV9hY3RpdmUiLAogICAgICAiZGVzY3JpcHRpb24iOiAiR2FtZSBpcyBhY3RpdmUgKGNvbnN1bWVkIG9uIHdpbiB0byBwcmV2ZW50IHJlcGVhdGVkIHdpbiBkZXRlY3Rpb24pIiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIsCiAgICAgICJ4IjogODUwLAogICAgICAieSI6IDgwMAogICAgfQogIF0sCiAgInRyYW5zaXRpb25zIjogWwogICAgewogICAgICAiaWQiOiAieF9wbGF5XzAwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDAsMCkiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8wMCIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiAyNTAsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQwMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMCwxKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzAxIiwKICAgICAgIngiOiAxMTEwLAogICAgICAieSI6IDI1MCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDAxIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8wMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgwLDIpIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMDIiLAogICAgICAieCI6IDExOTAsCiAgICAgICJ5IjogMjUwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMDIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzEwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDEsMCkiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8xMCIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiAzMzAsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQxMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMTEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMSwxKSAtIGNlbnRlciIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzExIiwKICAgICAgIngiOiAxMTEwLAogICAgICAieSI6IDMzMCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDExIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8xMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgxLDIpIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMTIiLAogICAgICAieCI6IDExOTAsCiAgICAgICJ5IjogMzMwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMTIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzIwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDIsMCkiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8yMCIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA0MTAsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQyMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMjEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMiwxKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzIxIiwKICAgICAgIngiOiAxMTEwLAogICAgICAieSI6IDQxMCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDIxIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8yMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgyLDIpIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMjIiLAogICAgICAieCI6IDExOTAsCiAgICAgICJ5IjogNDEwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMjIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzAwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDAsMCkiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8wMCIsCiAgICAgICJ4IjogNTEwLAogICAgICAieSI6IDI1MCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDAwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8wMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgwLDEpIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMDEiLAogICAgICAieCI6IDU5MCwKICAgICAgInkiOiAyNTAsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQwMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMDIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMCwyKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzAyIiwKICAgICAgIngiOiA2NzAsCiAgICAgICJ5IjogMjUwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMDIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzEwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDEsMCkiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8xMCIsCiAgICAgICJ4IjogNTEwLAogICAgICAieSI6IDMzMCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDEwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8xMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgxLDEpIC0gY2VudGVyIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMTEiLAogICAgICAieCI6IDU5MCwKICAgICAgInkiOiAzMzAsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQxMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMTIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMSwyKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzEyIiwKICAgICAgIngiOiA2NzAsCiAgICAgICJ5IjogMzMwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMTIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzIwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDIsMCkiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8yMCIsCiAgICAgICJ4IjogNTEwLAogICAgICAieSI6IDQxMCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDIwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8yMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgyLDEpIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMjEiLAogICAgICAieCI6IDU5MCwKICAgICAgInkiOiA0MTAsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQyMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMjIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMiwyKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzIyIiwKICAgICAgIngiOiA2NzAsCiAgICAgICJ5IjogNDEwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMjIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicmVzZXQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUmVzZXQgZ2FtZSB0byBpbml0aWFsIHN0YXRlIiwKICAgICAgImV2ZW50IjogIkdhbWVSZXNldCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3Jlc2V0IiwKICAgICAgImNsZWFyc0hpc3RvcnkiOiB0cnVlLAogICAgICAieCI6IDQwMCwKICAgICAgInkiOiAxMjAsCiAgICAgICJldmVudF90eXBlIjogIkdhbWVSZXNldCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9yb3cwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyB0b3Agcm93ICgwLDApLSgwLDEpLSgwLDIpIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9yb3cwIiwKICAgICAgIngiOiAxMDMwLAogICAgICAieSI6IDkxMCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbjAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF93aW5fcm93MSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHdpbnMgbWlkZGxlIHJvdyAoMSwwKS0oMSwxKS0oMSwyKSIsCiAgICAgICJldmVudCI6ICJYV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF93aW5fcm93MSIsCiAgICAgICJ4IjogMTAzMCwKICAgICAgInkiOiA5OTAsCiAgICAgICJldmVudF90eXBlIjogIlhXb24xIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX3JvdzIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIGJvdHRvbSByb3cgKDIsMCktKDIsMSktKDIsMikiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX3JvdzIiLAogICAgICAieCI6IDEwMzAsCiAgICAgICJ5IjogMTA3MCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbjIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF93aW5fY29sMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHdpbnMgbGVmdCBjb2x1bW4gKDAsMCktKDEsMCktKDIsMCkiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX2NvbDAiLAogICAgICAieCI6IDExMTAsCiAgICAgICJ5IjogOTEwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYV29uMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9jb2wxIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyBjZW50ZXIgY29sdW1uICgwLDEpLSgxLDEpLSgyLDEpIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9jb2wxIiwKICAgICAgIngiOiAxMTEwLAogICAgICAieSI6IDk5MCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbjEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF93aW5fY29sMiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHdpbnMgcmlnaHQgY29sdW1uICgwLDIpLSgxLDIpLSgyLDIpIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9jb2wyIiwKICAgICAgIngiOiAxMTEwLAogICAgICAieSI6IDEwNzAsCiAgICAgICJldmVudF90eXBlIjogIlhXb24yIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX2RpYWciLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIG1haW4gZGlhZ29uYWwgKDAsMCktKDEsMSktKDIsMikiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX2RpYWciLAogICAgICAieCI6IDExOTAsCiAgICAgICJ5IjogOTEwLAogICAgICAiZXZlbnRfdHlwZSI6ICJYV29uIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX2FudGkiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIGFudGktZGlhZ29uYWwgKDAsMiktKDEsMSktKDIsMCkiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX2FudGkiLAogICAgICAieCI6IDExOTAsCiAgICAgICJ5IjogMTA3MCwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9yb3cwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyB0b3Agcm93ICgwLDApLSgwLDEpLSgwLDIpIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9yb3cwIiwKICAgICAgIngiOiA2ODAsCiAgICAgICJ5IjogODkwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9yb3cxIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyBtaWRkbGUgcm93ICgxLDApLSgxLDEpLSgxLDIpIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9yb3cxIiwKICAgICAgIngiOiA2ODAsCiAgICAgICJ5IjogOTcwLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9yb3cyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyBib3R0b20gcm93ICgyLDApLSgyLDEpLSgyLDIpIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9yb3cyIiwKICAgICAgIngiOiA2ODAsCiAgICAgICJ5IjogMTA1MCwKICAgICAgImV2ZW50X3R5cGUiOiAiT1dvbjIiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib193aW5fY29sMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHdpbnMgbGVmdCBjb2x1bW4gKDAsMCktKDEsMCktKDIsMCkiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX2NvbDAiLAogICAgICAieCI6IDYwMCwKICAgICAgInkiOiA4OTAsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24wIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fd2luX2NvbDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyB3aW5zIGNlbnRlciBjb2x1bW4gKDAsMSktKDEsMSktKDIsMSkiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX2NvbDEiLAogICAgICAieCI6IDYwMCwKICAgICAgInkiOiA5NzAsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24xIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fd2luX2NvbDIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyB3aW5zIHJpZ2h0IGNvbHVtbiAoMCwyKS0oMSwyKS0oMiwyKSIsCiAgICAgICJldmVudCI6ICJPV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb193aW5fY29sMiIsCiAgICAgICJ4IjogNjAwLAogICAgICAieSI6IDEwNTAsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24yIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fd2luX2RpYWciLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyB3aW5zIG1haW4gZGlhZ29uYWwgKDAsMCktKDEsMSktKDIsMikiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX2RpYWciLAogICAgICAieCI6IDUyMCwKICAgICAgInkiOiA4OTAsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24iCiAgICB9LAogICAgewogICAgICAiaWQiOiAib193aW5fYW50aSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHdpbnMgYW50aS1kaWFnb25hbCAoMCwyKS0oMSwxKS0oMiwwKSIsCiAgICAgICJldmVudCI6ICJPV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb193aW5fYW50aSIsCiAgICAgICJ4IjogNTIwLAogICAgICAieSI6IDEwNTAsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24iCiAgICB9CiAgXSwKICAiYXJjcyI6IFsKICAgIHsKICAgICAgImZyb20iOiAicDAwIiwKICAgICAgInRvIjogInhfcGxheV8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMDAiLAogICAgICAidG8iOiAieDAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzAwIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwMSIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzAxIiwKICAgICAgInRvIjogIngwMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8wMSIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMDIiLAogICAgICAidG8iOiAieF9wbGF5XzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8wMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8wMiIsCiAgICAgICJ0byI6ICJ4MDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMDIiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDEwIiwKICAgICAgInRvIjogInhfcGxheV8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMTAiLAogICAgICAidG8iOiAieDEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzEwIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxMSIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzExIiwKICAgICAgInRvIjogIngxMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8xMSIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMTIiLAogICAgICAidG8iOiAieF9wbGF5XzEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8xMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8xMiIsCiAgICAgICJ0byI6ICJ4MTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMTIiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDIwIiwKICAgICAgInRvIjogInhfcGxheV8yMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMjAiLAogICAgICAidG8iOiAieDIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzIwIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyMSIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzIxIiwKICAgICAgInRvIjogIngyMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8yMSIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMjIiLAogICAgICAidG8iOiAieF9wbGF5XzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8yMiIsCiAgICAgICJ0byI6ICJ4MjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMjIiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDAwIiwKICAgICAgInRvIjogIm9fcGxheV8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMDAiLAogICAgICAidG8iOiAibzAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzAwIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwMSIsCiAgICAgICJ0byI6ICJvX3BsYXlfMDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzAxIiwKICAgICAgInRvIjogIm8wMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8wMSIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMDIiLAogICAgICAidG8iOiAib19wbGF5XzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8wMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8wMiIsCiAgICAgICJ0byI6ICJvMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMDIiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDEwIiwKICAgICAgInRvIjogIm9fcGxheV8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMTAiLAogICAgICAidG8iOiAibzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzEwIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxMSIsCiAgICAgICJ0byI6ICJvX3BsYXlfMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzExIiwKICAgICAgInRvIjogIm8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8xMSIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMTIiLAogICAgICAidG8iOiAib19wbGF5XzEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8xMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8xMiIsCiAgICAgICJ0byI6ICJvMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMTIiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDIwIiwKICAgICAgInRvIjogIm9fcGxheV8yMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMjAiLAogICAgICAidG8iOiAibzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzIwIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyMSIsCiAgICAgICJ0byI6ICJvX3BsYXlfMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzIxIiwKICAgICAgInRvIjogIm8yMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8yMSIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMjIiLAogICAgICAidG8iOiAib19wbGF5XzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8yMiIsCiAgICAgICJ0byI6ICJvMjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMjIiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAwIiwKICAgICAgInRvIjogInhfd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDEiLAogICAgICAidG8iOiAieF93aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngwMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzAiLAogICAgICAidG8iOiAid2luX3giCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cwIiwKICAgICAgInRvIjogIngwMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzAiLAogICAgICAidG8iOiAieDAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MCIsCiAgICAgICJ0byI6ICJ4MDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTAiLAogICAgICAidG8iOiAieF93aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDEyIiwKICAgICAgInRvIjogInhfd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MSIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzEiLAogICAgICAidG8iOiAieDEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MSIsCiAgICAgICJ0byI6ICJ4MTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cxIiwKICAgICAgInRvIjogIngxMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMCIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIxIiwKICAgICAgInRvIjogInhfd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MjIiLAogICAgICAidG8iOiAieF93aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogInhfd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cyIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MiIsCiAgICAgICJ0byI6ICJ4MjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cyIiwKICAgICAgInRvIjogIngyMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzIiLAogICAgICAidG8iOiAieDIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAwIiwKICAgICAgInRvIjogInhfd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTAiLAogICAgICAidG8iOiAieF93aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMCIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDAiLAogICAgICAidG8iOiAid2luX3giCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wwIiwKICAgICAgInRvIjogIngwMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDAiLAogICAgICAidG8iOiAieDEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMCIsCiAgICAgICJ0byI6ICJ4MjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDEiLAogICAgICAidG8iOiAieF93aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIxIiwKICAgICAgInRvIjogInhfd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMSIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDEiLAogICAgICAidG8iOiAieDAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMSIsCiAgICAgICJ0byI6ICJ4MTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wxIiwKICAgICAgInRvIjogIngyMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngwMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDEyIiwKICAgICAgInRvIjogInhfd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MjIiLAogICAgICAidG8iOiAieF93aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogInhfd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wyIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMiIsCiAgICAgICJ0byI6ICJ4MDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wyIiwKICAgICAgInRvIjogIngxMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDIiLAogICAgICAidG8iOiAieDIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAwIiwKICAgICAgInRvIjogInhfd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTEiLAogICAgICAidG8iOiAieF93aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2RpYWciLAogICAgICAidG8iOiAid2luX3giCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9kaWFnIiwKICAgICAgInRvIjogIngwMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2RpYWciLAogICAgICAidG8iOiAieDExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fZGlhZyIsCiAgICAgICJ0byI6ICJ4MjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDIiLAogICAgICAidG8iOiAieF93aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIwIiwKICAgICAgInRvIjogInhfd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fYW50aSIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2FudGkiLAogICAgICAidG8iOiAieDAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fYW50aSIsCiAgICAgICJ0byI6ICJ4MTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9hbnRpIiwKICAgICAgInRvIjogIngyMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMCIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAxIiwKICAgICAgInRvIjogIm9fd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDIiLAogICAgICAidG8iOiAib193aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cwIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MCIsCiAgICAgICJ0byI6ICJvMDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cwIiwKICAgICAgInRvIjogIm8wMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzAiLAogICAgICAidG8iOiAibzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzEwIiwKICAgICAgInRvIjogIm9fd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTEiLAogICAgICAidG8iOiAib193aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMiIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzEiLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cxIiwKICAgICAgInRvIjogIm8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzEiLAogICAgICAidG8iOiAibzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MSIsCiAgICAgICJ0byI6ICJvMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjAiLAogICAgICAidG8iOiAib193aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMSIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIyIiwKICAgICAgInRvIjogIm9fd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MiIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzIiLAogICAgICAidG8iOiAibzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MiIsCiAgICAgICJ0byI6ICJvMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cyIiwKICAgICAgInRvIjogIm8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMCIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzEwIiwKICAgICAgInRvIjogIm9fd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjAiLAogICAgICAidG8iOiAib193aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wwIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMCIsCiAgICAgICJ0byI6ICJvMDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wwIiwKICAgICAgInRvIjogIm8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDAiLAogICAgICAidG8iOiAibzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAxIiwKICAgICAgInRvIjogIm9fd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTEiLAogICAgICAidG8iOiAib193aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMSIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDEiLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wxIiwKICAgICAgInRvIjogIm8wMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDEiLAogICAgICAidG8iOiAibzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMSIsCiAgICAgICJ0byI6ICJvMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDIiLAogICAgICAidG8iOiAib193aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMiIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIyIiwKICAgICAgInRvIjogIm9fd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMiIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDIiLAogICAgICAidG8iOiAibzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMiIsCiAgICAgICJ0byI6ICJvMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wyIiwKICAgICAgInRvIjogIm8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMCIsCiAgICAgICJ0byI6ICJvX3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzExIiwKICAgICAgInRvIjogIm9fd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjIiLAogICAgICAidG8iOiAib193aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9kaWFnIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fZGlhZyIsCiAgICAgICJ0byI6ICJvMDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9kaWFnIiwKICAgICAgInRvIjogIm8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2RpYWciLAogICAgICAidG8iOiAibzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAyIiwKICAgICAgInRvIjogIm9fd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTEiLAogICAgICAidG8iOiAib193aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMCIsCiAgICAgICJ0byI6ICJvX3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2FudGkiLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9hbnRpIiwKICAgICAgInRvIjogIm8wMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2FudGkiLAogICAgICAidG8iOiAibzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fYW50aSIsCiAgICAgICJ0byI6ICJvMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJjYW5fcmVzZXQiLAogICAgICAidG8iOiAicmVzZXQiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJyZXNldCIsCiAgICAgICJ0byI6ICJjYW5fcmVzZXQiCiAgICB9CiAgXSwKICAiZXZlbnRzIjogWwogICAgewogICAgICAiaWQiOiAiWFBsYXllZCIsCiAgICAgICJuYW1lIjogIlhQbGF5ZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGFjZWQgYSBwaWVjZSBvbiB0aGUgYm9hcmQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInJvdyIsCiAgICAgICAgICAidHlwZSI6ICJpbnRlZ2VyIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImNvbCIsCiAgICAgICAgICAidHlwZSI6ICJpbnRlZ2VyIiwKICAgICAgICAgICJyZXF1aXJlZCI6IHRydWUKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJPUGxheWVkIiwKICAgICAgIm5hbWUiOiAiT1BsYXllZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYWNlZCBhIHBpZWNlIG9uIHRoZSBib2FyZCIsCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicm93IiwKICAgICAgICAgICJ0eXBlIjogImludGVnZXIiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29sIiwKICAgICAgICAgICJ0eXBlIjogImludGVnZXIiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgImlkIjogIkdhbWVSZXNldCIsCiAgICAgICJuYW1lIjogIkdhbWVSZXNldCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJHYW1lIHdhcyByZXNldCB0byBpbml0aWFsIHN0YXRlIiwKICAgICAgImZpZWxkcyI6IG51bGwKICAgIH0KICBdLAogICJhZG1pbiI6IHsKICAgICJlbmFibGVkIjogdHJ1ZSwKICAgICJwYXRoIjogIiIsCiAgICAicm9sZXMiOiBudWxsLAogICAgImZlYXR1cmVzIjogbnVsbAogIH0sCiAgImRlYnVnIjogewogICAgImVuYWJsZWQiOiB0cnVlLAogICAgImV2YWwiOiB0cnVlCiAgfSwKICAic29mdERlbGV0ZSI6IHsKICAgICJlbmFibGVkIjogdHJ1ZSwKICAgICJyZXRlbnRpb25EYXlzIjogMzAKICB9LAogICJzdGF0dXMiOiB7CiAgICAicGxhY2VzIjogewogICAgICAid2luX28iOiAiTyBXaW5zIiwKICAgICAgIndpbl94IjogIlggV2lucyIKICAgIH0sCiAgICAiZGVmYXVsdCI6ICJJbiBQcm9ncmVzcyIKICB9LAogICJzaW11bGF0aW9uIjogewogICAgIm9iamVjdGl2ZSI6ICJ3aW5feCAtIHdpbl9vIiwKICAgICJwbGF5ZXJzIjogewogICAgICAibyI6IHsKICAgICAgICAibWF4aW1pemVzIjogZmFsc2UsCiAgICAgICAgInR1cm5QbGFjZSI6ICJvX3R1cm4iLAogICAgICAgICJ0cmFuc2l0aW9ucyI6IFsKICAgICAgICAgICJvX3BsYXlfMDAiLAogICAgICAgICAgIm9fcGxheV8wMSIsCiAgICAgICAgICAib19wbGF5XzAyIiwKICAgICAgICAgICJvX3BsYXlfMTAiLAogICAgICAgICAgIm9fcGxheV8xMSIsCiAgICAgICAgICAib19wbGF5XzEyIiwKICAgICAgICAgICJvX3BsYXlfMjAiLAogICAgICAgICAgIm9fcGxheV8yMSIsCiAgICAgICAgICAib19wbGF5XzIyIgogICAgICAgIF0KICAgICAgfSwKICAgICAgIngiOiB7CiAgICAgICAgIm1heGltaXplcyI6IHRydWUsCiAgICAgICAgInR1cm5QbGFjZSI6ICJ4X3R1cm4iLAogICAgICAgICJ0cmFuc2l0aW9ucyI6IFsKICAgICAgICAgICJ4X3BsYXlfMDAiLAogICAgICAgICAgInhfcGxheV8wMSIsCiAgICAgICAgICAieF9wbGF5XzAyIiwKICAgICAgICAgICJ4X3BsYXlfMTAiLAogICAgICAgICAgInhfcGxheV8xMSIsCiAgICAgICAgICAieF9wbGF5XzEyIiwKICAgICAgICAgICJ4X3BsYXlfMjAiLAogICAgICAgICAgInhfcGxheV8yMSIsCiAgICAgICAgICAieF9wbGF5XzIyIgogICAgICAgIF0KICAgICAgfQogICAgfSwKICAgICJzb2x2ZXIiOiB7CiAgICAgICJ0c3BhbiI6IFsKICAgICAgICAwLAogICAgICAgIDEwCiAgICAgIF0sCiAgICAgICJkdCI6IDAuMDEKICAgIH0KICB9Cn0="

	return func(w http.ResponseWriter, r *http.Request) {
		schemaJSON, err := base64.StdEncoding.DecodeString(schemaBase64)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "schema_decode_error", "Failed to decode schema")
			return
		}
		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusOK)
		w.Write(schemaJSON)
	}
}

