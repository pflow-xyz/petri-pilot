// Code generated by petri-pilot. DO NOT EDIT.

package tictactoe

import (
	"context"
	"encoding/base64"
	"io/fs"
	"net/http"
	"os"
	"path/filepath"
	"strconv"
	"strings"

	"github.com/pflow-xyz/petri-pilot/pkg/runtime/api"
	"github.com/pflow-xyz/go-pflow/eventsource"
)

// BuildRouter creates an HTTP router for the tic-tac-toe workflow.
func BuildRouter(app *Application, debugBroker *DebugBroker, softDeleteStore *SoftDeleteStore) http.Handler {
	r := api.NewRouter()

	// Health check - always returns ok if server is running
	r.GET("/health", "Health check", func(w http.ResponseWriter, r *http.Request) {
		api.JSON(w, http.StatusOK, map[string]string{"status": "ok"})
	})

	// Readiness check - verifies dependencies (database, etc.)
	r.GET("/ready", "Readiness check", HandleReady(app))

	// Create new aggregate
	r.POST("/api/tictactoe", "Create new tic-tac-toe", HandleCreate(app))

	// Get aggregate state
	r.GET("/api/tictactoe/{id}", "Get tic-tac-toe state", HandleGetState(app))


	// Schema viewer endpoint
	r.GET("/api/schema", "Get model schema", HandleGetSchema())


	// Admin endpoints
	r.GET("/admin/stats", "Admin statistics", HandleAdminStats(app))
	r.GET("/admin/instances", "List instances", HandleAdminListInstances(app, softDeleteStore))
	r.GET("/admin/instances/{id}", "Get instance detail", HandleAdminGetInstance(app))
	r.GET("/admin/instances/{id}/events", "Get instance events", HandleAdminGetEvents(app))
	r.DELETE("/admin/instances/{id}", "Delete instance permanently", HandleAdminDeleteInstance(app))
	r.POST("/admin/instances/{id}/archive", "Archive instance (soft delete)", HandleAdminArchiveInstance(softDeleteStore))
	r.POST("/admin/instances/{id}/restore", "Restore archived instance", HandleAdminRestoreInstance(softDeleteStore))


	// Event replay endpoints
	r.GET("/api/tictactoe/{id}/events", "Get event history", HandleGetEvents(app))
	r.GET("/api/tictactoe/{id}/at/{version}", "Get state at version", HandleGetStateAtVersion(app))






	// Debug WebSocket and eval endpoints
	r.GET("/ws", "Debug WebSocket connection", HandleDebugWebSocket(debugBroker))
	r.GET("/api/debug/sessions", "List debug sessions", HandleListSessions(debugBroker))
	r.POST("/api/debug/sessions/{id}/eval", "Evaluate code in browser session", HandleSessionEval(debugBroker))

















	// Soft delete endpoints
	r.Handle("DELETE", "/api/tictactoe/{id}", "Soft delete entity", softDeleteStore.HandleSoftDelete)
	r.POST("/api/tictactoe/{id}/restore", "Restore deleted entity", softDeleteStore.HandleRestore)

	// Transition endpoints
	r.Transition("x_play_00", "/api/x_play_00", "X plays at (0,0)", HandleXPlay00(app))
	r.Transition("x_play_01", "/api/x_play_01", "X plays at (0,1)", HandleXPlay01(app))
	r.Transition("x_play_02", "/api/x_play_02", "X plays at (0,2)", HandleXPlay02(app))
	r.Transition("x_play_10", "/api/x_play_10", "X plays at (1,0)", HandleXPlay10(app))
	r.Transition("x_play_11", "/api/x_play_11", "X plays at (1,1) - center", HandleXPlay11(app))
	r.Transition("x_play_12", "/api/x_play_12", "X plays at (1,2)", HandleXPlay12(app))
	r.Transition("x_play_20", "/api/x_play_20", "X plays at (2,0)", HandleXPlay20(app))
	r.Transition("x_play_21", "/api/x_play_21", "X plays at (2,1)", HandleXPlay21(app))
	r.Transition("x_play_22", "/api/x_play_22", "X plays at (2,2)", HandleXPlay22(app))
	r.Transition("o_play_00", "/api/o_play_00", "O plays at (0,0)", HandleOPlay00(app))
	r.Transition("o_play_01", "/api/o_play_01", "O plays at (0,1)", HandleOPlay01(app))
	r.Transition("o_play_02", "/api/o_play_02", "O plays at (0,2)", HandleOPlay02(app))
	r.Transition("o_play_10", "/api/o_play_10", "O plays at (1,0)", HandleOPlay10(app))
	r.Transition("o_play_11", "/api/o_play_11", "O plays at (1,1) - center", HandleOPlay11(app))
	r.Transition("o_play_12", "/api/o_play_12", "O plays at (1,2)", HandleOPlay12(app))
	r.Transition("o_play_20", "/api/o_play_20", "O plays at (2,0)", HandleOPlay20(app))
	r.Transition("o_play_21", "/api/o_play_21", "O plays at (2,1)", HandleOPlay21(app))
	r.Transition("o_play_22", "/api/o_play_22", "O plays at (2,2)", HandleOPlay22(app))
	r.Transition("reset", "/api/reset", "Reset game to initial state", HandleReset(app))
	r.Transition("x_win_row0", "/api/x_win_row0", "X wins top row (0,0)-(0,1)-(0,2)", HandleXWinRow0(app))
	r.Transition("x_win_row1", "/api/x_win_row1", "X wins middle row (1,0)-(1,1)-(1,2)", HandleXWinRow1(app))
	r.Transition("x_win_row2", "/api/x_win_row2", "X wins bottom row (2,0)-(2,1)-(2,2)", HandleXWinRow2(app))
	r.Transition("x_win_col0", "/api/x_win_col0", "X wins left column (0,0)-(1,0)-(2,0)", HandleXWinCol0(app))
	r.Transition("x_win_col1", "/api/x_win_col1", "X wins center column (0,1)-(1,1)-(2,1)", HandleXWinCol1(app))
	r.Transition("x_win_col2", "/api/x_win_col2", "X wins right column (0,2)-(1,2)-(2,2)", HandleXWinCol2(app))
	r.Transition("x_win_diag", "/api/x_win_diag", "X wins main diagonal (0,0)-(1,1)-(2,2)", HandleXWinDiag(app))
	r.Transition("x_win_anti", "/api/x_win_anti", "X wins anti-diagonal (0,2)-(1,1)-(2,0)", HandleXWinAnti(app))
	r.Transition("o_win_row0", "/api/o_win_row0", "O wins top row (0,0)-(0,1)-(0,2)", HandleOWinRow0(app))
	r.Transition("o_win_row1", "/api/o_win_row1", "O wins middle row (1,0)-(1,1)-(1,2)", HandleOWinRow1(app))
	r.Transition("o_win_row2", "/api/o_win_row2", "O wins bottom row (2,0)-(2,1)-(2,2)", HandleOWinRow2(app))
	r.Transition("o_win_col0", "/api/o_win_col0", "O wins left column (0,0)-(1,0)-(2,0)", HandleOWinCol0(app))
	r.Transition("o_win_col1", "/api/o_win_col1", "O wins center column (0,1)-(1,1)-(2,1)", HandleOWinCol1(app))
	r.Transition("o_win_col2", "/api/o_win_col2", "O wins right column (0,2)-(1,2)-(2,2)", HandleOWinCol2(app))
	r.Transition("o_win_diag", "/api/o_win_diag", "O wins main diagonal (0,0)-(1,1)-(2,2)", HandleOWinDiag(app))
	r.Transition("o_win_anti", "/api/o_win_anti", "O wins anti-diagonal (0,2)-(1,1)-(2,0)", HandleOWinAnti(app))

	// Serve frontend static files
	r.StaticFiles("/", StaticFileHandler())

	return r.Build()
}

// StaticFileHandler returns an http.Handler that serves static files from frontend/.
// It supports SPA routing by returning index.html for paths that don't match static files.
func StaticFileHandler() http.HandlerFunc {
	// Find frontend directory - try custom frontends first, then generated
	frontendPath := ""
	candidates := []string{
		"frontends/tic-tac-toe",                    // Custom frontend (top priority)
		"frontend",                                    // Running from service directory
		"generated/tictactoe/frontend",         // Generated frontend from repo root
		filepath.Join("generated", "tictactoe", "frontend"), // Platform-safe
	}

	// Also try relative to executable
	if exe, err := os.Executable(); err == nil {
		exeDir := filepath.Dir(exe)
		candidates = append(candidates,
			filepath.Join(exeDir, "frontends", "tic-tac-toe"),
			filepath.Join(exeDir, "frontend"),
			filepath.Join(exeDir, "generated", "tictactoe", "frontend"),
		)
	}

	for _, candidate := range candidates {
		if _, err := os.Stat(candidate); err == nil {
			frontendPath = candidate
			break
		}
	}

	return func(w http.ResponseWriter, r *http.Request) {
		// No frontend found
		if frontendPath == "" {
			http.Error(w, "Frontend not found", http.StatusNotFound)
			return
		}

		// Clean the path
		path := strings.TrimPrefix(r.URL.Path, "/")
		if path == "" {
			path = "index.html"
		}

		// Try to serve the file
		fullPath := filepath.Join(frontendPath, path)

		// Check if file exists
		info, err := os.Stat(fullPath)
		if err != nil || info.IsDir() {
			// File doesn't exist, serve index.html for SPA routing
			http.ServeFile(w, r, filepath.Join(frontendPath, "index.html"))
			return
		}

		http.ServeFile(w, r, fullPath)
	}
}

// StaticFS is a helper interface for embedding static files (optional).
type StaticFS interface {
	fs.FS
}

// HandleCreate creates a new aggregate instance.
func HandleCreate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		id, err := app.Create(ctx)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "CREATE_FAILED", err.Error())
			return
		}

		// Load the new aggregate to get initial state
		agg, err := app.Load(ctx, id)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "LOAD_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusCreated, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleGetState returns the current state of an aggregate.
func HandleGetState(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		if id == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate ID is required")
			return
		}

		agg, err := app.GetState(ctx, id)
		if err != nil {
			api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleReady checks if the application is ready to serve requests.
// Returns 200 if all dependencies are available, 503 otherwise.
func HandleReady(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		checks := make(map[string]string)
		ready := true

		// Check event store connectivity
		if err := app.HealthCheck(r.Context()); err != nil {
			checks["eventstore"] = err.Error()
			ready = false
		} else {
			checks["eventstore"] = "ok"
		}

		status := http.StatusOK
		statusText := "ready"
		if !ready {
			status = http.StatusServiceUnavailable
			statusText = "not ready"
		}

		api.JSON(w, status, map[string]any{
			"status": statusText,
			"checks": checks,
		})
	}
}


// HandleXPlay00 handles the x_play_00 transition.
func HandleXPlay00(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay00, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay01 handles the x_play_01 transition.
func HandleXPlay01(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay01, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay02 handles the x_play_02 transition.
func HandleXPlay02(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay02, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay10 handles the x_play_10 transition.
func HandleXPlay10(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay10, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay11 handles the x_play_11 transition.
func HandleXPlay11(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay11, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay12 handles the x_play_12 transition.
func HandleXPlay12(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay12, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay20 handles the x_play_20 transition.
func HandleXPlay20(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay20, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay21 handles the x_play_21 transition.
func HandleXPlay21(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay21, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXPlay22 handles the x_play_22 transition.
func HandleXPlay22(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXPlay22, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay00 handles the o_play_00 transition.
func HandleOPlay00(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay00, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay01 handles the o_play_01 transition.
func HandleOPlay01(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay01, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay02 handles the o_play_02 transition.
func HandleOPlay02(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay02, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay10 handles the o_play_10 transition.
func HandleOPlay10(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay10, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay11 handles the o_play_11 transition.
func HandleOPlay11(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay11, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay12 handles the o_play_12 transition.
func HandleOPlay12(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay12, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay20 handles the o_play_20 transition.
func HandleOPlay20(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay20, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay21 handles the o_play_21 transition.
func HandleOPlay21(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay21, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOPlay22 handles the o_play_22 transition.
func HandleOPlay22(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOPlay22, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleReset handles the reset transition.
func HandleReset(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		// This transition clears event history, resetting to initial state
		agg, err := app.ResetStream(ctx, req.AggregateID)
		if err != nil {
			api.Error(w, http.StatusConflict, "RESET_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow0 handles the x_win_row0 transition.
func HandleXWinRow0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow1 handles the x_win_row1 transition.
func HandleXWinRow1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinRow2 handles the x_win_row2 transition.
func HandleXWinRow2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinRow2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol0 handles the x_win_col0 transition.
func HandleXWinCol0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol1 handles the x_win_col1 transition.
func HandleXWinCol1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinCol2 handles the x_win_col2 transition.
func HandleXWinCol2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinCol2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinDiag handles the x_win_diag transition.
func HandleXWinDiag(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinDiag, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleXWinAnti handles the x_win_anti transition.
func HandleXWinAnti(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionXWinAnti, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow0 handles the o_win_row0 transition.
func HandleOWinRow0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow1 handles the o_win_row1 transition.
func HandleOWinRow1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinRow2 handles the o_win_row2 transition.
func HandleOWinRow2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinRow2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol0 handles the o_win_col0 transition.
func HandleOWinCol0(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol0, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol1 handles the o_win_col1 transition.
func HandleOWinCol1(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol1, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinCol2 handles the o_win_col2 transition.
func HandleOWinCol2(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinCol2, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinDiag handles the o_win_diag transition.
func HandleOWinDiag(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinDiag, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleOWinAnti handles the o_win_anti transition.
func HandleOWinAnti(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionOWinAnti, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}






// HandleAdminStats wraps the admin stats handler.
func HandleAdminStats(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()

adminStore, ok := app.store.(interface {
GetStats(ctx context.Context) (*eventsource.Stats, error)
})
if !ok {
api.Error(w, http.StatusInternalServerError, "UNSUPPORTED", "Admin operations not supported")
return
}

stats, err := adminStore.GetStats(ctx)
if err != nil {
api.Error(w, http.StatusInternalServerError, "STATS_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, stats)
}
}

// HandleAdminListInstances wraps the admin list instances handler.
func HandleAdminListInstances(app *Application, softDeleteStore *SoftDeleteStore) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()

place := r.URL.Query().Get("place")
from := r.URL.Query().Get("from")
to := r.URL.Query().Get("to")
page := getIntQueryParam(r, "page", 1)
perPage := getIntQueryParam(r, "per_page", 50)
showArchived := r.URL.Query().Get("archived") == "true"

adminStore, ok := app.store.(interface {
ListInstances(ctx context.Context, place, from, to string, page, perPage int) ([]eventsource.Instance, int, error)
})
if !ok {
api.Error(w, http.StatusInternalServerError, "UNSUPPORTED", "Admin operations not supported")
return
}

instances, total, err := adminStore.ListInstances(ctx, place, from, to, page, perPage)
if err != nil {
api.Error(w, http.StatusInternalServerError, "LIST_FAILED", err.Error())
return
}
// Filter out archived instances unless explicitly requested
var filteredInstances []eventsource.Instance
var archivedInstances []eventsource.Instance
for _, inst := range instances {
if softDeleteStore.IsDeleted(inst.ID) {
archivedInstances = append(archivedInstances, inst)
} else {
filteredInstances = append(filteredInstances, inst)
}
}
if showArchived {
instances = archivedInstances
} else {
instances = filteredInstances
}

// Load state for each instance by replaying events
// Note: This loads aggregates individually which may be slow for large lists.
// The perPage parameter limits the number of instances processed.
for i := range instances {
agg, err := app.Load(ctx, instances[i].ID)
if err != nil {
// Log error but continue processing other instances
// The state will remain as initialized by ListInstances
continue
}
// Get the Petri net places (token distribution)
instances[i].State = agg.Places()
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"instances": instances,
"total":     total,
"page":      page,
"per_page":  perPage,
"has_soft_delete": true,
})
}
}

// HandleAdminGetInstance wraps the admin get instance handler.
func HandleAdminGetInstance(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")

agg, err := app.Load(ctx, id)
if err != nil {
api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"id":      agg.ID(),
"version": agg.Version(),
"state":   agg.State(),
})
}
}

// HandleAdminGetEvents wraps the admin get events handler.
func HandleAdminGetEvents(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")
from := getIntQueryParam(r, "from", 0)

events, err := app.store.Read(ctx, id, from)
if err != nil {
api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"events": events,
})
}
}

// HandleAdminDeleteInstance deletes an instance and all its events.
func HandleAdminDeleteInstance(app *Application) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
ctx := r.Context()
id := r.PathValue("id")

if err := app.store.DeleteStream(ctx, id); err != nil {
api.Error(w, http.StatusInternalServerError, "DELETE_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"deleted": true,
"id":      id,
})
}
}
// HandleAdminArchiveInstance soft-deletes an instance (marks as archived).
func HandleAdminArchiveInstance(softDeleteStore *SoftDeleteStore) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
id := r.PathValue("id")
userID := getSoftDeleteUserID(r)

if err := softDeleteStore.SoftDelete(id, userID); err != nil {
api.Error(w, http.StatusInternalServerError, "ARCHIVE_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"archived": true,
"id":       id,
})
}
}

// HandleAdminRestoreInstance restores a soft-deleted instance.
func HandleAdminRestoreInstance(softDeleteStore *SoftDeleteStore) http.HandlerFunc {
return func(w http.ResponseWriter, r *http.Request) {
id := r.PathValue("id")

if err := softDeleteStore.Restore(id); err != nil {
api.Error(w, http.StatusInternalServerError, "RESTORE_FAILED", err.Error())
return
}

api.JSON(w, http.StatusOK, map[string]interface{}{
"restored": true,
"id":       id,
})
}
}



// HandleGetEvents returns the event history for an aggregate.
func HandleGetEvents(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		from := getIntQueryParam(r, "from", 0)

		events, err := app.store.Read(ctx, id, from)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"events": events,
		})
	}
}

// HandleGetStateAtVersion returns the aggregate state at a specific version.
func HandleGetStateAtVersion(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		versionStr := r.PathValue("version")

		version := getInt(versionStr, 0)
		if version <= 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be a positive integer")
			return
		}

		events, err := app.store.Read(ctx, id, 0)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		// Create temporary aggregate and replay up to version
		agg := NewAggregate(id)
		for _, evt := range events {
			if evt.Version > version {
				break
			}
			if err := agg.Apply(evt); err != nil {
				api.Error(w, http.StatusInternalServerError, "APPLY_FAILED", err.Error())
				return
			}
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":      agg.ID(),
			"version": version,
			"state":   agg.State(),
		})
	}
}





// Helper functions

func getIntQueryParam(r *http.Request, name string, defaultVal int) int {
	val := r.URL.Query().Get(name)
	return getInt(val, defaultVal)
}

func getInt(s string, defaultVal int) int {
	if s == "" {
		return defaultVal
	}

	intVal, err := strconv.Atoi(s)
	if err != nil {
		return defaultVal
	}

	return intVal
}


// HandleGetSchema returns the model schema JSON for the schema viewer.
func HandleGetSchema() http.HandlerFunc {
	// Schema JSON is embedded at generation time (base64 encoded)
	schemaBase64 := "ewogICJuYW1lIjogInRpYy10YWMtdG9lIiwKICAidmVyc2lvbiI6ICIyLjAuMCIsCiAgImRlc2NyaXB0aW9uIjogIlRpYy10YWMtdG9lIGdhbWUgbW9kZWxlZCBhcyBhIFBldHJpIG5ldCB3aXRoIHdpbiBwYXR0ZXJucyBhcyB0cmFuc2l0aW9ucyBmb3IgT0RFLWJhc2VkIHN0cmF0ZWdpYyBhbmFseXNpcyIsCiAgInBsYWNlcyI6IFsKICAgIHsKICAgICAgImlkIjogInAwMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgwLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiQ2VsbCAoMCwxKSBlbXB0eSIsCiAgICAgICJpbml0aWFsIjogMSwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIkNlbGwgKDAsMikgZW1wdHkiLAogICAgICAiaW5pdGlhbCI6IDEsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgxLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMTEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiQ2VsbCAoMSwxKSBlbXB0eSAtIGNlbnRlciIsCiAgICAgICJpbml0aWFsIjogMSwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIkNlbGwgKDEsMikgZW1wdHkiLAogICAgICAiaW5pdGlhbCI6IDEsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDZWxsICgyLDApIGVtcHR5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMjEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiQ2VsbCAoMiwxKSBlbXB0eSIsCiAgICAgICJpbml0aWFsIjogMSwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIkNlbGwgKDIsMikgZW1wdHkiLAogICAgICAiaW5pdGlhbCI6IDEsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIngwMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgwLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMCwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDAsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIngxMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgxLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MTEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMSwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDEsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIngyMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBpZWNlIGF0ICgyLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4MjEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwaWVjZSBhdCAoMiwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAieDIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGllY2UgYXQgKDIsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8wMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgwLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvMDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwaWVjZSBhdCAoMCwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAibzAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGllY2UgYXQgKDAsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8xMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgxLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvMTEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwaWVjZSBhdCAoMSwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAibzEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGllY2UgYXQgKDEsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm8yMCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBpZWNlIGF0ICgyLDApIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvMjEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwaWVjZSBhdCAoMiwxKSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAibzIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGllY2UgYXQgKDIsMikiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfdHVybiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYJ3MgdHVybiB0byBwbGF5IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3R1cm4iLAogICAgICAiZGVzY3JpcHRpb24iOiAiTydzIHR1cm4gdG8gcGxheSIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAid2luX3giLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBoYXMgd29uIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ3aW5fbyIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIGhhcyB3b24iLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogImNhbl9yZXNldCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJUb2tlbiBlbmFibGluZyByZXNldCBhY3Rpb24iLAogICAgICAiaW5pdGlhbCI6IDEsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogImdhbWVfYWN0aXZlIiwKICAgICAgImRlc2NyaXB0aW9uIjogIkdhbWUgaXMgYWN0aXZlIChjb25zdW1lZCBvbiB3aW4gdG8gcHJldmVudCByZXBlYXRlZCB3aW4gZGV0ZWN0aW9uKSIsCiAgICAgICJpbml0aWFsIjogMSwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9CiAgXSwKICAidHJhbnNpdGlvbnMiOiBbCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMDAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMCwwKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzAwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDAwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8wMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgwLDEpIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMDEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMDEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDAsMikiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8wMiIsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQwMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMTAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMSwwKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzEwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDEwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8xMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgxLDEpIC0gY2VudGVyIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMTEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMTEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDEsMikiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8xMiIsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQxMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3BsYXlfMjAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCBwbGF5cyBhdCAoMiwwKSIsCiAgICAgICJldmVudCI6ICJYUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF9wbGF5XzIwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiWFBsYXllZDIwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfcGxheV8yMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYXlzIGF0ICgyLDEpIiwKICAgICAgImV2ZW50IjogIlhQbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3BsYXlfMjEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJYUGxheWVkMjEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF9wbGF5XzIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggcGxheXMgYXQgKDIsMikiLAogICAgICAiZXZlbnQiOiAiWFBsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfcGxheV8yMiIsCiAgICAgICJldmVudF90eXBlIjogIlhQbGF5ZWQyMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMDAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMCwwKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzAwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDAwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8wMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgwLDEpIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMDEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMDEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzAyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDAsMikiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8wMiIsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQwMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMTAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMSwwKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzEwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDEwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8xMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgxLDEpIC0gY2VudGVyIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMTEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMTEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzEyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDEsMikiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8xMiIsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQxMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3BsYXlfMjAiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyBwbGF5cyBhdCAoMiwwKSIsCiAgICAgICJldmVudCI6ICJPUGxheWVkIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb19wbGF5XzIwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiT1BsYXllZDIwIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fcGxheV8yMSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHBsYXlzIGF0ICgyLDEpIiwKICAgICAgImV2ZW50IjogIk9QbGF5ZWQiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3BsYXlfMjEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJPUGxheWVkMjEiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib19wbGF5XzIyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxheXMgYXQgKDIsMikiLAogICAgICAiZXZlbnQiOiAiT1BsYXllZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fcGxheV8yMiIsCiAgICAgICJldmVudF90eXBlIjogIk9QbGF5ZWQyMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJyZXNldCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJSZXNldCBnYW1lIHRvIGluaXRpYWwgc3RhdGUiLAogICAgICAiZXZlbnQiOiAiR2FtZVJlc2V0IiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcmVzZXQiLAogICAgICAiY2xlYXJzSGlzdG9yeSI6IHRydWUsCiAgICAgICJldmVudF90eXBlIjogIkdhbWVSZXNldCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9yb3cwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyB0b3Agcm93ICgwLDApLSgwLDEpLSgwLDIpIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9yb3cwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbjAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAieF93aW5fcm93MSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHdpbnMgbWlkZGxlIHJvdyAoMSwwKS0oMSwxKS0oMSwyKSIsCiAgICAgICJldmVudCI6ICJYV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF93aW5fcm93MSIsCiAgICAgICJldmVudF90eXBlIjogIlhXb24xIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX3JvdzIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIGJvdHRvbSByb3cgKDIsMCktKDIsMSktKDIsMikiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX3JvdzIiLAogICAgICAiZXZlbnRfdHlwZSI6ICJYV29uMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9jb2wwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyBsZWZ0IGNvbHVtbiAoMCwwKS0oMSwwKS0oMiwwKSIsCiAgICAgICJldmVudCI6ICJYV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkveF93aW5fY29sMCIsCiAgICAgICJldmVudF90eXBlIjogIlhXb24wIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInhfd2luX2NvbDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiWCB3aW5zIGNlbnRlciBjb2x1bW4gKDAsMSktKDEsMSktKDIsMSkiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX2NvbDEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJYV29uMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9jb2wyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyByaWdodCBjb2x1bW4gKDAsMiktKDEsMiktKDIsMikiLAogICAgICAiZXZlbnQiOiAiWFdvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3hfd2luX2NvbDIiLAogICAgICAiZXZlbnRfdHlwZSI6ICJYV29uMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9kaWFnIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyBtYWluIGRpYWdvbmFsICgwLDApLSgxLDEpLSgyLDIpIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9kaWFnIiwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ4X3dpbl9hbnRpIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlggd2lucyBhbnRpLWRpYWdvbmFsICgwLDIpLSgxLDEpLSgyLDApIiwKICAgICAgImV2ZW50IjogIlhXb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS94X3dpbl9hbnRpIiwKICAgICAgImV2ZW50X3R5cGUiOiAiWFdvbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9yb3cwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyB0b3Agcm93ICgwLDApLSgwLDEpLSgwLDIpIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9yb3cwIiwKICAgICAgImV2ZW50X3R5cGUiOiAiT1dvbjAiCiAgICB9LAogICAgewogICAgICAiaWQiOiAib193aW5fcm93MSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJPIHdpbnMgbWlkZGxlIHJvdyAoMSwwKS0oMSwxKS0oMSwyKSIsCiAgICAgICJldmVudCI6ICJPV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb193aW5fcm93MSIsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24xIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fd2luX3JvdzIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyB3aW5zIGJvdHRvbSByb3cgKDIsMCktKDIsMSktKDIsMikiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX3JvdzIiLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9jb2wwIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyBsZWZ0IGNvbHVtbiAoMCwwKS0oMSwwKS0oMiwwKSIsCiAgICAgICJldmVudCI6ICJPV29uIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvb193aW5fY29sMCIsCiAgICAgICJldmVudF90eXBlIjogIk9Xb24wIgogICAgfSwKICAgIHsKICAgICAgImlkIjogIm9fd2luX2NvbDEiLAogICAgICAiZGVzY3JpcHRpb24iOiAiTyB3aW5zIGNlbnRlciBjb2x1bW4gKDAsMSktKDEsMSktKDIsMSkiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX2NvbDEiLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMSIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9jb2wyIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyByaWdodCBjb2x1bW4gKDAsMiktKDEsMiktKDIsMikiLAogICAgICAiZXZlbnQiOiAiT1dvbiIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL29fd2luX2NvbDIiLAogICAgICAiZXZlbnRfdHlwZSI6ICJPV29uMiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9kaWFnIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyBtYWluIGRpYWdvbmFsICgwLDApLSgxLDEpLSgyLDIpIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9kaWFnIiwKICAgICAgImV2ZW50X3R5cGUiOiAiT1dvbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJvX3dpbl9hbnRpIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gd2lucyBhbnRpLWRpYWdvbmFsICgwLDIpLSgxLDEpLSgyLDApIiwKICAgICAgImV2ZW50IjogIk9Xb24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9vX3dpbl9hbnRpIiwKICAgICAgImV2ZW50X3R5cGUiOiAiT1dvbiIKICAgIH0KICBdLAogICJhcmNzIjogWwogICAgewogICAgICAiZnJvbSI6ICJwMDAiLAogICAgICAidG8iOiAieF9wbGF5XzAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8wMCIsCiAgICAgICJ0byI6ICJ4MDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMDAiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDAxIiwKICAgICAgInRvIjogInhfcGxheV8wMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMDEiLAogICAgICAidG8iOiAieDAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzAxIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwMiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzAyIiwKICAgICAgInRvIjogIngwMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8wMiIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMTAiLAogICAgICAidG8iOiAieF9wbGF5XzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8xMCIsCiAgICAgICJ0byI6ICJ4MTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMTAiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDExIiwKICAgICAgInRvIjogInhfcGxheV8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMTEiLAogICAgICAidG8iOiAieDExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzExIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxMiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzEyIiwKICAgICAgInRvIjogIngxMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8xMiIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMjAiLAogICAgICAidG8iOiAieF9wbGF5XzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF90dXJuIiwKICAgICAgInRvIjogInhfcGxheV8yMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8yMCIsCiAgICAgICJ0byI6ICJ4MjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMjAiLAogICAgICAidG8iOiAib190dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDIxIiwKICAgICAgInRvIjogInhfcGxheV8yMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfdHVybiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3BsYXlfMjEiLAogICAgICAidG8iOiAieDIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzIxIiwKICAgICAgInRvIjogIm9fdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyMiIsCiAgICAgICJ0byI6ICJ4X3BsYXlfMjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3R1cm4iLAogICAgICAidG8iOiAieF9wbGF5XzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF9wbGF5XzIyIiwKICAgICAgInRvIjogIngyMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfcGxheV8yMiIsCiAgICAgICJ0byI6ICJvX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMDAiLAogICAgICAidG8iOiAib19wbGF5XzAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8wMCIsCiAgICAgICJ0byI6ICJvMDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMDAiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDAxIiwKICAgICAgInRvIjogIm9fcGxheV8wMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMDEiLAogICAgICAidG8iOiAibzAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzAxIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwMiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzAyIiwKICAgICAgInRvIjogIm8wMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8wMiIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMTAiLAogICAgICAidG8iOiAib19wbGF5XzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8xMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8xMCIsCiAgICAgICJ0byI6ICJvMTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMTAiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDExIiwKICAgICAgInRvIjogIm9fcGxheV8xMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMTEiLAogICAgICAidG8iOiAibzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzExIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxMiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMTIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzEyIiwKICAgICAgInRvIjogIm8xMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8xMiIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMjAiLAogICAgICAidG8iOiAib19wbGF5XzIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib190dXJuIiwKICAgICAgInRvIjogIm9fcGxheV8yMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8yMCIsCiAgICAgICJ0byI6ICJvMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMjAiLAogICAgICAidG8iOiAieF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDIxIiwKICAgICAgInRvIjogIm9fcGxheV8yMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fdHVybiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMjEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3BsYXlfMjEiLAogICAgICAidG8iOiAibzIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzIxIiwKICAgICAgInRvIjogInhfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyMiIsCiAgICAgICJ0byI6ICJvX3BsYXlfMjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3R1cm4iLAogICAgICAidG8iOiAib19wbGF5XzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib19wbGF5XzIyIiwKICAgICAgInRvIjogIm8yMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fcGxheV8yMiIsCiAgICAgICJ0byI6ICJ4X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDAiLAogICAgICAidG8iOiAieF93aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngwMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAyIiwKICAgICAgInRvIjogInhfd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MCIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzAiLAogICAgICAidG8iOiAieDAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MCIsCiAgICAgICJ0byI6ICJ4MDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cwIiwKICAgICAgInRvIjogIngwMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMCIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDExIiwKICAgICAgInRvIjogInhfd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTIiLAogICAgICAidG8iOiAieF93aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogInhfd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cxIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MSIsCiAgICAgICJ0byI6ICJ4MTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cxIiwKICAgICAgInRvIjogIngxMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzEiLAogICAgICAidG8iOiAieDEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIwIiwKICAgICAgInRvIjogInhfd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MjEiLAogICAgICAidG8iOiAieF93aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzIiLAogICAgICAidG8iOiAid2luX3giCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9yb3cyIiwKICAgICAgInRvIjogIngyMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX3JvdzIiLAogICAgICAidG8iOiAieDIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fcm93MiIsCiAgICAgICJ0byI6ICJ4MjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDAiLAogICAgICAidG8iOiAieF93aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMCIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIwIiwKICAgICAgInRvIjogInhfd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMCIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDAiLAogICAgICAidG8iOiAieDAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMCIsCiAgICAgICJ0byI6ICJ4MTAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wwIiwKICAgICAgInRvIjogIngyMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngwMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDExIiwKICAgICAgInRvIjogInhfd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MjEiLAogICAgICAidG8iOiAieF93aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogInhfd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wxIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMSIsCiAgICAgICJ0byI6ICJ4MDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wxIiwKICAgICAgInRvIjogIngxMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDEiLAogICAgICAidG8iOiAieDIxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDAyIiwKICAgICAgInRvIjogInhfd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MTIiLAogICAgICAidG8iOiAieF93aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngyMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAieF93aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDIiLAogICAgICAidG8iOiAid2luX3giCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9jb2wyIiwKICAgICAgInRvIjogIngwMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2NvbDIiLAogICAgICAidG8iOiAieDEyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fY29sMiIsCiAgICAgICJ0byI6ICJ4MjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MDAiLAogICAgICAidG8iOiAieF93aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngxMSIsCiAgICAgICJ0byI6ICJ4X3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDIyIiwKICAgICAgInRvIjogInhfd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJ4X3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fZGlhZyIsCiAgICAgICJ0byI6ICJ3aW5feCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2RpYWciLAogICAgICAidG8iOiAieDAwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fZGlhZyIsCiAgICAgICJ0byI6ICJ4MTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9kaWFnIiwKICAgICAgInRvIjogIngyMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIngwMiIsCiAgICAgICJ0byI6ICJ4X3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieDExIiwKICAgICAgInRvIjogInhfd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4MjAiLAogICAgICAidG8iOiAieF93aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogInhfd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9hbnRpIiwKICAgICAgInRvIjogIndpbl94IgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAieF93aW5fYW50aSIsCiAgICAgICJ0byI6ICJ4MDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJ4X3dpbl9hbnRpIiwKICAgICAgInRvIjogIngxMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInhfd2luX2FudGkiLAogICAgICAidG8iOiAieDIwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAwIiwKICAgICAgInRvIjogIm9fd2luX3JvdzAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDEiLAogICAgICAidG8iOiAib193aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMiIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fcm93MCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzAiLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cwIiwKICAgICAgInRvIjogIm8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzAiLAogICAgICAidG8iOiAibzAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MCIsCiAgICAgICJ0byI6ICJvMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTAiLAogICAgICAidG8iOiAib193aW5fcm93MSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMSIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzEyIiwKICAgICAgInRvIjogIm9fd2luX3JvdzEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MSIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzEiLAogICAgICAidG8iOiAibzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MSIsCiAgICAgICJ0byI6ICJvMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cxIiwKICAgICAgInRvIjogIm8xMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMCIsCiAgICAgICJ0byI6ICJvX3dpbl9yb3cyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIxIiwKICAgICAgInRvIjogIm9fd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjIiLAogICAgICAidG8iOiAib193aW5fcm93MiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX3JvdzIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cyIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fcm93MiIsCiAgICAgICJ0byI6ICJvMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9yb3cyIiwKICAgICAgInRvIjogIm8yMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX3JvdzIiLAogICAgICAidG8iOiAibzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAwIiwKICAgICAgInRvIjogIm9fd2luX2NvbDAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTAiLAogICAgICAidG8iOiAib193aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMCIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fY29sMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDAiLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wwIiwKICAgICAgInRvIjogIm8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDAiLAogICAgICAidG8iOiAibzEwIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMCIsCiAgICAgICJ0byI6ICJvMjAiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDEiLAogICAgICAidG8iOiAib193aW5fY29sMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMSIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIxIiwKICAgICAgInRvIjogIm9fd2luX2NvbDEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMSIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDEiLAogICAgICAidG8iOiAibzAxIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMSIsCiAgICAgICJ0byI6ICJvMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wxIiwKICAgICAgInRvIjogIm8yMSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8wMiIsCiAgICAgICJ0byI6ICJvX3dpbl9jb2wyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzEyIiwKICAgICAgInRvIjogIm9fd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMjIiLAogICAgICAidG8iOiAib193aW5fY29sMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImdhbWVfYWN0aXZlIiwKICAgICAgInRvIjogIm9fd2luX2NvbDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wyIiwKICAgICAgInRvIjogIndpbl9vIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fY29sMiIsCiAgICAgICJ0byI6ICJvMDIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9jb2wyIiwKICAgICAgInRvIjogIm8xMiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2NvbDIiLAogICAgICAidG8iOiAibzIyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzAwIiwKICAgICAgInRvIjogIm9fd2luX2RpYWciCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMTEiLAogICAgICAidG8iOiAib193aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8yMiIsCiAgICAgICJ0byI6ICJvX3dpbl9kaWFnIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ2FtZV9hY3RpdmUiLAogICAgICAidG8iOiAib193aW5fZGlhZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2RpYWciLAogICAgICAidG8iOiAid2luX28iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9kaWFnIiwKICAgICAgInRvIjogIm8wMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2RpYWciLAogICAgICAidG8iOiAibzExIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fZGlhZyIsCiAgICAgICJ0byI6ICJvMjIiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvMDIiLAogICAgICAidG8iOiAib193aW5fYW50aSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm8xMSIsCiAgICAgICJ0byI6ICJvX3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAibzIwIiwKICAgICAgInRvIjogIm9fd2luX2FudGkiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJnYW1lX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJvX3dpbl9hbnRpIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fYW50aSIsCiAgICAgICJ0byI6ICJ3aW5fbyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogIm9fd2luX2FudGkiLAogICAgICAidG8iOiAibzAyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAib193aW5fYW50aSIsCiAgICAgICJ0byI6ICJvMTEiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJvX3dpbl9hbnRpIiwKICAgICAgInRvIjogIm8yMCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImNhbl9yZXNldCIsCiAgICAgICJ0byI6ICJyZXNldCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInJlc2V0IiwKICAgICAgInRvIjogImNhbl9yZXNldCIKICAgIH0KICBdLAogICJldmVudHMiOiBbCiAgICB7CiAgICAgICJpZCI6ICJYUGxheWVkIiwKICAgICAgIm5hbWUiOiAiWFBsYXllZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJYIHBsYWNlZCBhIHBpZWNlIG9uIHRoZSBib2FyZCIsCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAicm93IiwKICAgICAgICAgICJ0eXBlIjogImludGVnZXIiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY29sIiwKICAgICAgICAgICJ0eXBlIjogImludGVnZXIiLAogICAgICAgICAgInJlcXVpcmVkIjogdHJ1ZQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgIHsKICAgICAgImlkIjogIk9QbGF5ZWQiLAogICAgICAibmFtZSI6ICJPUGxheWVkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIk8gcGxhY2VkIGEgcGllY2Ugb24gdGhlIGJvYXJkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJyb3ciLAogICAgICAgICAgInR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjb2wiLAogICAgICAgICAgInR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAicmVxdWlyZWQiOiB0cnVlCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAiR2FtZVJlc2V0IiwKICAgICAgIm5hbWUiOiAiR2FtZVJlc2V0IiwKICAgICAgImRlc2NyaXB0aW9uIjogIkdhbWUgd2FzIHJlc2V0IHRvIGluaXRpYWwgc3RhdGUiLAogICAgICAiZmllbGRzIjogbnVsbAogICAgfQogIF0sCiAgImFkbWluIjogewogICAgImVuYWJsZWQiOiB0cnVlLAogICAgInBhdGgiOiAiIiwKICAgICJyb2xlcyI6IG51bGwsCiAgICAiZmVhdHVyZXMiOiBudWxsCiAgfSwKICAiZGVidWciOiB7CiAgICAiZW5hYmxlZCI6IHRydWUsCiAgICAiZXZhbCI6IHRydWUKICB9LAogICJzb2Z0RGVsZXRlIjogewogICAgImVuYWJsZWQiOiB0cnVlLAogICAgInJldGVudGlvbkRheXMiOiAzMAogIH0sCiAgInN0YXR1cyI6IHsKICAgICJwbGFjZXMiOiB7CiAgICAgICJ3aW5fbyI6ICJPIFdpbnMiLAogICAgICAid2luX3giOiAiWCBXaW5zIgogICAgfSwKICAgICJkZWZhdWx0IjogIkluIFByb2dyZXNzIgogIH0KfQ=="

	return func(w http.ResponseWriter, r *http.Request) {
		schemaJSON, err := base64.StdEncoding.DecodeString(schemaBase64)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "schema_decode_error", "Failed to decode schema")
			return
		}
		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusOK)
		w.Write(schemaJSON)
	}
}

