// Code generated by petri-pilot. DO NOT EDIT.

package texasholdem

import (
	"encoding/base64"
	"encoding/json"
	"io/fs"
	"net/http"
	"os"
	"path/filepath"
	"strconv"
	"strings"

	"github.com/pflow-xyz/petri-pilot/pkg/runtime/api"
)

// BuildRouter creates an HTTP router for the texas-holdem workflow.
func BuildRouter(app *Application, middleware *Middleware, sessions SessionStore, debugBroker *DebugBroker) http.Handler {
	r := api.NewRouter()

	// Apply auth middleware to extract user from token (optional, doesn't require auth)
	r.Use(OptionalAuthMiddleware(sessions))

	// Health check - always returns ok if server is running
	r.GET("/health", "Health check", func(w http.ResponseWriter, r *http.Request) {
		api.JSON(w, http.StatusOK, map[string]string{"status": "ok"})
	})

	// Readiness check - verifies dependencies (database, etc.)
	r.GET("/ready", "Readiness check", HandleReady(app))

	// Debug WebSocket and eval endpoints
	r.GET("/ws/debug", "Debug WebSocket connection", HandleDebugWebSocket(debugBroker))
	r.GET("/api/debug/sessions", "List debug sessions", HandleListSessions(debugBroker))
	r.POST("/api/debug/sessions/{id}/eval", "Evaluate code in browser session", HandleSessionEval(debugBroker))
	r.POST("/api/debug/login", "Create debug guest session", HandleDebugGuestLogin())

	// Create new aggregate
	r.POST("/api/texasholdem", "Create new texas-holdem", HandleCreate(app))

	// Get aggregate state
	r.GET("/api/texasholdem/{id}", "Get texas-holdem state", HandleGetState(app))


	// Schema viewer endpoint
	r.GET("/api/schema", "Get model schema", HandleGetSchema())



	// Event replay endpoints
	r.GET("/api/texasholdem/{id}/events", "Get event history", HandleGetEvents(app))
	r.GET("/api/texasholdem/{id}/at/{version}", "Get state at version", HandleGetStateAtVersion(app))
	r.POST("/api/texasholdem/{id}/truncate", "Truncate event history to version", HandleTruncate(app))






















	// Transition endpoints
	r.Transition("start_hand", "/api/start_hand", "Start a new hand", HandleStartHand(app))
	r.Transition("deal_flop", "/api/deal_flop", "Deal the flop", HandleDealFlop(app))
	r.Transition("deal_turn", "/api/deal_turn", "Deal the turn", HandleDealTurn(app))
	r.Transition("deal_river", "/api/deal_river", "Deal the river", HandleDealRiver(app))
	r.Transition("go_showdown", "/api/go_showdown", "Go to showdown", HandleGoShowdown(app))
	r.Transition("determine_winner", "/api/determine_winner", "Determine winner", HandleDetermineWinner(app))
	r.Transition("end_hand", "/api/end_hand", "End the hand", HandleEndHand(app))
	r.Transition("p0_fold", "/api/p0_fold", "Player 0 folds", HandleP0Fold(app))
	r.Transition("p0_check", "/api/p0_check", "Player 0 checks", HandleP0Check(app))
	r.Transition("p0_call", "/api/p0_call", "Player 0 calls", HandleP0Call(app))
	r.Transition("p0_raise", "/api/p0_raise", "Player 0 raises", HandleP0Raise(app))
	r.Transition("p1_fold", "/api/p1_fold", "Player 1 folds", HandleP1Fold(app))
	r.Transition("p1_check", "/api/p1_check", "Player 1 checks", HandleP1Check(app))
	r.Transition("p1_call", "/api/p1_call", "Player 1 calls", HandleP1Call(app))
	r.Transition("p1_raise", "/api/p1_raise", "Player 1 raises", HandleP1Raise(app))
	r.Transition("p2_fold", "/api/p2_fold", "Player 2 folds", HandleP2Fold(app))
	r.Transition("p2_check", "/api/p2_check", "Player 2 checks", HandleP2Check(app))
	r.Transition("p2_call", "/api/p2_call", "Player 2 calls", HandleP2Call(app))
	r.Transition("p2_raise", "/api/p2_raise", "Player 2 raises", HandleP2Raise(app))
	r.Transition("p3_fold", "/api/p3_fold", "Player 3 folds", HandleP3Fold(app))
	r.Transition("p3_check", "/api/p3_check", "Player 3 checks", HandleP3Check(app))
	r.Transition("p3_call", "/api/p3_call", "Player 3 calls", HandleP3Call(app))
	r.Transition("p3_raise", "/api/p3_raise", "Player 3 raises", HandleP3Raise(app))
	r.Transition("p4_fold", "/api/p4_fold", "Player 4 folds", HandleP4Fold(app))
	r.Transition("p4_check", "/api/p4_check", "Player 4 checks", HandleP4Check(app))
	r.Transition("p4_call", "/api/p4_call", "Player 4 calls", HandleP4Call(app))
	r.Transition("p4_raise", "/api/p4_raise", "Player 4 raises", HandleP4Raise(app))
	r.Transition("p0_skip", "/api/p0_skip", "Skip player 0 (all-in/eliminated)", HandleP0Skip(app))
	r.Transition("p1_skip", "/api/p1_skip", "Skip player 1 (all-in/eliminated)", HandleP1Skip(app))
	r.Transition("p2_skip", "/api/p2_skip", "Skip player 2 (all-in/eliminated)", HandleP2Skip(app))
	r.Transition("p3_skip", "/api/p3_skip", "Skip player 3 (all-in/eliminated)", HandleP3Skip(app))
	r.Transition("p4_skip", "/api/p4_skip", "Skip player 4 (all-in/eliminated)", HandleP4Skip(app))

	// Serve frontend static files
	r.StaticFiles("/", StaticFileHandler())

	return r.Build()
}

// StaticFileHandler returns an http.Handler that serves static files from frontend/.
// It supports SPA routing by returning index.html for paths that don't match static files.
func StaticFileHandler() http.HandlerFunc {
	// Find frontend directory - try custom frontends first, then generated
	frontendPath := ""
	candidates := []string{
		"frontends/texas-holdem",                    // Custom frontend (top priority)
		"frontend",                                    // Running from service directory
		"generated/main/frontend",         // Generated frontend from repo root
		filepath.Join("generated", "main", "frontend"), // Platform-safe
	}

	// Also try relative to executable
	if exe, err := os.Executable(); err == nil {
		exeDir := filepath.Dir(exe)
		candidates = append(candidates,
			filepath.Join(exeDir, "frontends", "texas-holdem"),
			filepath.Join(exeDir, "frontend"),
			filepath.Join(exeDir, "generated", "main", "frontend"),
		)
	}

	for _, candidate := range candidates {
		if _, err := os.Stat(candidate); err == nil {
			frontendPath = candidate
			break
		}
	}

	return func(w http.ResponseWriter, r *http.Request) {
		// No frontend found
		if frontendPath == "" {
			http.Error(w, "Frontend not found", http.StatusNotFound)
			return
		}

		// Clean the path - strip leading slash and /frontend/ prefix
		path := strings.TrimPrefix(r.URL.Path, "/")
		path = strings.TrimPrefix(path, "frontend/")
		if path == "" {
			path = "index.html"
		}

		// Try to serve the file
		fullPath := filepath.Join(frontendPath, path)

		// Check if file exists
		info, err := os.Stat(fullPath)
		if err != nil || info.IsDir() {
			// File doesn't exist, serve index.html for SPA routing
			http.ServeFile(w, r, filepath.Join(frontendPath, "index.html"))
			return
		}

		http.ServeFile(w, r, fullPath)
	}
}

// StaticFS is a helper interface for embedding static files (optional).
type StaticFS interface {
	fs.FS
}

// HandleCreate creates a new aggregate instance.
func HandleCreate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		id, err := app.Create(ctx)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "CREATE_FAILED", err.Error())
			return
		}

		// Load the new aggregate to get initial state
		agg, err := app.Load(ctx, id)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "LOAD_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusCreated, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleGetState returns the current state of an aggregate.
func HandleGetState(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		if id == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate ID is required")
			return
		}

		agg, err := app.GetState(ctx, id)
		if err != nil {
			api.Error(w, http.StatusNotFound, "NOT_FOUND", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.StateResponse{
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.State(),
			Places:             agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}

// HandleReady checks if the application is ready to serve requests.
// Returns 200 if all dependencies are available, 503 otherwise.
func HandleReady(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		checks := make(map[string]string)
		ready := true

		// Check event store connectivity
		if err := app.HealthCheck(r.Context()); err != nil {
			checks["eventstore"] = err.Error()
			ready = false
		} else {
			checks["eventstore"] = "ok"
		}

		status := http.StatusOK
		statusText := "ready"
		if !ready {
			status = http.StatusServiceUnavailable
			statusText = "not ready"
		}

		api.JSON(w, status, map[string]any{
			"status": statusText,
			"checks": checks,
		})
	}
}


// HandleStartHand handles the start_hand transition.
func HandleStartHand(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionStartHand, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleDealFlop handles the deal_flop transition.
func HandleDealFlop(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionDealFlop, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleDealTurn handles the deal_turn transition.
func HandleDealTurn(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionDealTurn, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleDealRiver handles the deal_river transition.
func HandleDealRiver(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionDealRiver, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleGoShowdown handles the go_showdown transition.
func HandleGoShowdown(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionGoShowdown, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleDetermineWinner handles the determine_winner transition.
func HandleDetermineWinner(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionDetermineWinner, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleEndHand handles the end_hand transition.
func HandleEndHand(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionEndHand, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP0Fold handles the p0_fold transition.
func HandleP0Fold(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP0Fold, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP0Check handles the p0_check transition.
func HandleP0Check(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP0Check, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP0Call handles the p0_call transition.
func HandleP0Call(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP0Call, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP0Raise handles the p0_raise transition.
func HandleP0Raise(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP0Raise, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP1Fold handles the p1_fold transition.
func HandleP1Fold(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP1Fold, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP1Check handles the p1_check transition.
func HandleP1Check(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP1Check, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP1Call handles the p1_call transition.
func HandleP1Call(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP1Call, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP1Raise handles the p1_raise transition.
func HandleP1Raise(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP1Raise, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP2Fold handles the p2_fold transition.
func HandleP2Fold(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP2Fold, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP2Check handles the p2_check transition.
func HandleP2Check(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP2Check, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP2Call handles the p2_call transition.
func HandleP2Call(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP2Call, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP2Raise handles the p2_raise transition.
func HandleP2Raise(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP2Raise, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP3Fold handles the p3_fold transition.
func HandleP3Fold(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP3Fold, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP3Check handles the p3_check transition.
func HandleP3Check(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP3Check, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP3Call handles the p3_call transition.
func HandleP3Call(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP3Call, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP3Raise handles the p3_raise transition.
func HandleP3Raise(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP3Raise, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP4Fold handles the p4_fold transition.
func HandleP4Fold(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP4Fold, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP4Check handles the p4_check transition.
func HandleP4Check(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP4Check, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP4Call handles the p4_call transition.
func HandleP4Call(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP4Call, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP4Raise handles the p4_raise transition.
func HandleP4Raise(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP4Raise, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP0Skip handles the p0_skip transition.
func HandleP0Skip(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP0Skip, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP1Skip handles the p1_skip transition.
func HandleP1Skip(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP1Skip, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP2Skip handles the p2_skip transition.
func HandleP2Skip(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP2Skip, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP3Skip handles the p3_skip transition.
func HandleP3Skip(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP3Skip, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}


// HandleP4Skip handles the p4_skip transition.
func HandleP4Skip(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()

		var req api.TransitionRequest
		if err := api.DecodeJSON(r, &req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", err.Error())
			return
		}

		if req.AggregateID == "" {
			api.Error(w, http.StatusBadRequest, "MISSING_ID", "aggregate_id is required")
			return
		}

		agg, err := app.Execute(ctx, req.AggregateID, TransitionP4Skip, req.Data)
		if err != nil {
			api.Error(w, http.StatusConflict, "TRANSITION_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, api.TransitionResult{
			Success:            true,
			AggregateID:        agg.ID(),
			Version:            agg.Version(),
			State:              agg.Places(),
			EnabledTransitions: agg.EnabledTransitions(),
		})
	}
}






// HandleGetEvents returns the event history for an aggregate.
func HandleGetEvents(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		from := getIntQueryParam(r, "from", 0)

		events, err := app.store.Read(ctx, id, from)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"events": events,
		})
	}
}

// HandleGetStateAtVersion returns the aggregate state at a specific version.
func HandleGetStateAtVersion(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")
		versionStr := r.PathValue("version")

		version := getInt(versionStr, 0)
		if version <= 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be a positive integer")
			return
		}

		events, err := app.store.Read(ctx, id, 0)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "READ_FAILED", err.Error())
			return
		}

		// Create temporary aggregate and replay up to version
		agg := NewAggregate(id)
		for _, evt := range events {
			if evt.Version > version {
				break
			}
			if err := agg.Apply(evt); err != nil {
				api.Error(w, http.StatusInternalServerError, "APPLY_FAILED", err.Error())
				return
			}
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":      agg.ID(),
			"version": version,
			"state":   agg.State(),
		})
	}
}

// HandleTruncate truncates the event stream to a specific version.
// This enables "undo and redo differently" workflows by discarding events after the target version.
func HandleTruncate(app *Application) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		ctx := r.Context()
		id := r.PathValue("id")

		var req struct {
			Version int `json:"version"`
		}
		if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
			api.Error(w, http.StatusBadRequest, "INVALID_REQUEST", "request body must contain version field")
			return
		}

		if req.Version < 0 {
			api.Error(w, http.StatusBadRequest, "INVALID_VERSION", "version must be non-negative")
			return
		}

		agg, err := app.TruncateTo(ctx, id, req.Version)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "TRUNCATE_FAILED", err.Error())
			return
		}

		api.JSON(w, http.StatusOK, map[string]interface{}{
			"id":                    agg.ID(),
			"version":               agg.Version(),
			"state":                 agg.State(),
			"enabled_transitions":   agg.EnabledTransitions(),
		})
	}
}





// Helper functions

func getIntQueryParam(r *http.Request, name string, defaultVal int) int {
	val := r.URL.Query().Get(name)
	return getInt(val, defaultVal)
}

func getInt(s string, defaultVal int) int {
	if s == "" {
		return defaultVal
	}

	intVal, err := strconv.Atoi(s)
	if err != nil {
		return defaultVal
	}

	return intVal
}


// HandleGetSchema returns the model schema JSON for the schema viewer.
func HandleGetSchema() http.HandlerFunc {
	// Schema JSON is embedded at generation time (base64 encoded)
	schemaBase64 := "ewogICJuYW1lIjogInRleGFzLWhvbGRlbSIsCiAgImRlc2NyaXB0aW9uIjogIlRleGFzIEhvbGQnZW0gUG9rZXIgLSBTaW1wbGlmaWVkIDUtcGxheWVyIHRhYmxlIiwKICAicGxhY2VzIjogWwogICAgewogICAgICAiaWQiOiAid2FpdGluZyIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJXYWl0aW5nIGZvciBoYW5kIHRvIHN0YXJ0IiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwcmVmbG9wIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlByZS1mbG9wIGJldHRpbmcgcm91bmQiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogImZsb3AiLAogICAgICAiZGVzY3JpcHRpb24iOiAiRmxvcCBiZXR0aW5nIHJvdW5kIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJ0dXJuX3JvdW5kIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlR1cm4gYmV0dGluZyByb3VuZCIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAicml2ZXIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUml2ZXIgYmV0dGluZyByb3VuZCIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAic2hvd2Rvd24iLAogICAgICAiZGVzY3JpcHRpb24iOiAiU2hvd2Rvd24gLSBjb21wYXJlIGhhbmRzIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJjb21wbGV0ZSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJIYW5kIGNvbXBsZXRlIiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMF90dXJuIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAwJ3MgdHVybiB0byBhY3QiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxX3R1cm4iLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDEncyB0dXJuIHRvIGFjdCIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDJfdHVybiIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMidzIHR1cm4gdG8gYWN0IiwKICAgICAgImluaXRpYWwiOiAwLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwM190dXJuIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAzJ3MgdHVybiB0byBhY3QiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInA0X3R1cm4iLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDQncyB0dXJuIHRvIGFjdCIsCiAgICAgICJpbml0aWFsIjogMCwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDBfYWN0aXZlIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAwIGlzIGluIHRoZSBoYW5kIiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMV9hY3RpdmUiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDEgaXMgaW4gdGhlIGhhbmQiLAogICAgICAiaW5pdGlhbCI6IDEsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyX2FjdGl2ZSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMiBpcyBpbiB0aGUgaGFuZCIsCiAgICAgICJpbml0aWFsIjogMSwKICAgICAgImtpbmQiOiAidG9rZW4iCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDNfYWN0aXZlIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAzIGlzIGluIHRoZSBoYW5kIiwKICAgICAgImluaXRpYWwiOiAxLAogICAgICAia2luZCI6ICJ0b2tlbiIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwNF9hY3RpdmUiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDQgaXMgaW4gdGhlIGhhbmQiLAogICAgICAiaW5pdGlhbCI6IDEsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfSwKICAgIHsKICAgICAgImlkIjogImJldHRpbmdfZG9uZSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJDdXJyZW50IGJldHRpbmcgcm91bmQgaXMgY29tcGxldGUiLAogICAgICAiaW5pdGlhbCI6IDAsCiAgICAgICJraW5kIjogInRva2VuIgogICAgfQogIF0sCiAgInRyYW5zaXRpb25zIjogWwogICAgewogICAgICAiaWQiOiAic3RhcnRfaGFuZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJTdGFydCBhIG5ldyBoYW5kIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvc3RhcnRfaGFuZCIsCiAgICAgICJldmVudF90eXBlIjogImhhbmRfc3RhcnRlZCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJkZWFsX2Zsb3AiLAogICAgICAiZGVzY3JpcHRpb24iOiAiRGVhbCB0aGUgZmxvcCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL2RlYWxfZmxvcCIsCiAgICAgICJldmVudF90eXBlIjogImZsb3BfZGVhbHQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAiZGVhbF90dXJuIiwKICAgICAgImRlc2NyaXB0aW9uIjogIkRlYWwgdGhlIHR1cm4iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9kZWFsX3R1cm4iLAogICAgICAiZXZlbnRfdHlwZSI6ICJ0dXJuX2RlYWx0IgogICAgfSwKICAgIHsKICAgICAgImlkIjogImRlYWxfcml2ZXIiLAogICAgICAiZGVzY3JpcHRpb24iOiAiRGVhbCB0aGUgcml2ZXIiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9kZWFsX3JpdmVyIiwKICAgICAgImV2ZW50X3R5cGUiOiAicml2ZXJfZGVhbHQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAiZ29fc2hvd2Rvd24iLAogICAgICAiZGVzY3JpcHRpb24iOiAiR28gdG8gc2hvd2Rvd24iLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9nb19zaG93ZG93biIsCiAgICAgICJldmVudF90eXBlIjogInNob3dkb3duX3JlYWNoZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAiZGV0ZXJtaW5lX3dpbm5lciIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJEZXRlcm1pbmUgd2lubmVyIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvZGV0ZXJtaW5lX3dpbm5lciIsCiAgICAgICJldmVudF90eXBlIjogIndpbm5lcl9kZXRlcm1pbmVkIgogICAgfSwKICAgIHsKICAgICAgImlkIjogImVuZF9oYW5kIiwKICAgICAgImRlc2NyaXB0aW9uIjogIkVuZCB0aGUgaGFuZCIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL2VuZF9oYW5kIiwKICAgICAgImV2ZW50X3R5cGUiOiAiaGFuZF9lbmRlZCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMF9mb2xkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAwIGZvbGRzIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcDBfZm9sZCIsCiAgICAgICJldmVudF90eXBlIjogInAwX2ZvbGRlZCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMF9jaGVjayIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMCBjaGVja3MiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9wMF9jaGVjayIsCiAgICAgICJldmVudF90eXBlIjogInAwX2NoZWNrZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDBfY2FsbCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMCBjYWxscyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3AwX2NhbGwiLAogICAgICAiZXZlbnRfdHlwZSI6ICJwMF9jYWxsZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDBfcmFpc2UiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDAgcmFpc2VzIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcDBfcmFpc2UiLAogICAgICAiZXZlbnRfdHlwZSI6ICJwMF9yYWlzZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDFfZm9sZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMSBmb2xkcyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3AxX2ZvbGQiLAogICAgICAiZXZlbnRfdHlwZSI6ICJwMV9mb2xkZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDFfY2hlY2siLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDEgY2hlY2tzIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcDFfY2hlY2siLAogICAgICAiZXZlbnRfdHlwZSI6ICJwMV9jaGVja2VkIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxX2NhbGwiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDEgY2FsbHMiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9wMV9jYWxsIiwKICAgICAgImV2ZW50X3R5cGUiOiAicDFfY2FsbGVkIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxX3JhaXNlIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAxIHJhaXNlcyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3AxX3JhaXNlIiwKICAgICAgImV2ZW50X3R5cGUiOiAicDFfcmFpc2VkIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyX2ZvbGQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDIgZm9sZHMiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9wMl9mb2xkIiwKICAgICAgImV2ZW50X3R5cGUiOiAicDJfZm9sZGVkIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyX2NoZWNrIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAyIGNoZWNrcyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3AyX2NoZWNrIiwKICAgICAgImV2ZW50X3R5cGUiOiAicDJfY2hlY2tlZCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMl9jYWxsIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAyIGNhbGxzIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcDJfY2FsbCIsCiAgICAgICJldmVudF90eXBlIjogInAyX2NhbGxlZCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMl9yYWlzZSIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMiByYWlzZXMiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9wMl9yYWlzZSIsCiAgICAgICJldmVudF90eXBlIjogInAyX3JhaXNlZCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwM19mb2xkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAzIGZvbGRzIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcDNfZm9sZCIsCiAgICAgICJldmVudF90eXBlIjogInAzX2ZvbGRlZCIKICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwM19jaGVjayIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMyBjaGVja3MiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9wM19jaGVjayIsCiAgICAgICJldmVudF90eXBlIjogInAzX2NoZWNrZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDNfY2FsbCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMyBjYWxscyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3AzX2NhbGwiLAogICAgICAiZXZlbnRfdHlwZSI6ICJwM19jYWxsZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDNfcmFpc2UiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDMgcmFpc2VzIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcDNfcmFpc2UiLAogICAgICAiZXZlbnRfdHlwZSI6ICJwM19yYWlzZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDRfZm9sZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgNCBmb2xkcyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3A0X2ZvbGQiLAogICAgICAiZXZlbnRfdHlwZSI6ICJwNF9mb2xkZWQiCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDRfY2hlY2siLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDQgY2hlY2tzIiwKICAgICAgImh0dHBfbWV0aG9kIjogIlBPU1QiLAogICAgICAiaHR0cF9wYXRoIjogIi9hcGkvcDRfY2hlY2siLAogICAgICAiZXZlbnRfdHlwZSI6ICJwNF9jaGVja2VkIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInA0X2NhbGwiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDQgY2FsbHMiLAogICAgICAiaHR0cF9tZXRob2QiOiAiUE9TVCIsCiAgICAgICJodHRwX3BhdGgiOiAiL2FwaS9wNF9jYWxsIiwKICAgICAgImV2ZW50X3R5cGUiOiAicDRfY2FsbGVkIgogICAgfSwKICAgIHsKICAgICAgImlkIjogInA0X3JhaXNlIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciA0IHJhaXNlcyIsCiAgICAgICJodHRwX21ldGhvZCI6ICJQT1NUIiwKICAgICAgImh0dHBfcGF0aCI6ICIvYXBpL3A0X3JhaXNlIiwKICAgICAgImV2ZW50X3R5cGUiOiAicDRfcmFpc2VkIgogICAgfQogIF0sCiAgImFyY3MiOiBbCiAgICB7CiAgICAgICJmcm9tIjogIndhaXRpbmciLAogICAgICAidG8iOiAic3RhcnRfaGFuZCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInN0YXJ0X2hhbmQiLAogICAgICAidG8iOiAicHJlZmxvcCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInN0YXJ0X2hhbmQiLAogICAgICAidG8iOiAicDBfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX3R1cm4iLAogICAgICAidG8iOiAicDBfZm9sZCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwMF9mb2xkIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDBfZm9sZCIsCiAgICAgICJ0byI6ICJwMV90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDBfdHVybiIsCiAgICAgICJ0byI6ICJwMF9jaGVjayIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwMF9jaGVjayIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX2NoZWNrIiwKICAgICAgInRvIjogInAwX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX2NoZWNrIiwKICAgICAgInRvIjogInAxX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMF90dXJuIiwKICAgICAgInRvIjogInAwX2NhbGwiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMF9hY3RpdmUiLAogICAgICAidG8iOiAicDBfY2FsbCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX2NhbGwiLAogICAgICAidG8iOiAicDBfYWN0aXZlIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDBfY2FsbCIsCiAgICAgICJ0byI6ICJwMV90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDBfdHVybiIsCiAgICAgICJ0byI6ICJwMF9yYWlzZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwMF9yYWlzZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX3JhaXNlIiwKICAgICAgInRvIjogInAwX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAwX3JhaXNlIiwKICAgICAgInRvIjogInAxX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV90dXJuIiwKICAgICAgInRvIjogInAxX2ZvbGQiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9hY3RpdmUiLAogICAgICAidG8iOiAicDFfZm9sZCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxX2ZvbGQiLAogICAgICAidG8iOiAicDJfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxX3R1cm4iLAogICAgICAidG8iOiAicDFfY2hlY2siCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9hY3RpdmUiLAogICAgICAidG8iOiAicDFfY2hlY2siCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9jaGVjayIsCiAgICAgICJ0byI6ICJwMV9hY3RpdmUiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9jaGVjayIsCiAgICAgICJ0byI6ICJwMl90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDFfdHVybiIsCiAgICAgICJ0byI6ICJwMV9jYWxsIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDFfYWN0aXZlIiwKICAgICAgInRvIjogInAxX2NhbGwiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9jYWxsIiwKICAgICAgInRvIjogInAxX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxX2NhbGwiLAogICAgICAidG8iOiAicDJfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAxX3R1cm4iLAogICAgICAidG8iOiAicDFfcmFpc2UiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9hY3RpdmUiLAogICAgICAidG8iOiAicDFfcmFpc2UiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9yYWlzZSIsCiAgICAgICJ0byI6ICJwMV9hY3RpdmUiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMV9yYWlzZSIsCiAgICAgICJ0byI6ICJwMl90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfdHVybiIsCiAgICAgICJ0byI6ICJwMl9mb2xkIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfYWN0aXZlIiwKICAgICAgInRvIjogInAyX2ZvbGQiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMl9mb2xkIiwKICAgICAgInRvIjogInAzX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMl90dXJuIiwKICAgICAgInRvIjogInAyX2NoZWNrIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfYWN0aXZlIiwKICAgICAgInRvIjogInAyX2NoZWNrIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfY2hlY2siLAogICAgICAidG8iOiAicDJfYWN0aXZlIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfY2hlY2siLAogICAgICAidG8iOiAicDNfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyX3R1cm4iLAogICAgICAidG8iOiAicDJfY2FsbCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAyX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwMl9jYWxsIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfY2FsbCIsCiAgICAgICJ0byI6ICJwMl9hY3RpdmUiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMl9jYWxsIiwKICAgICAgInRvIjogInAzX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwMl90dXJuIiwKICAgICAgInRvIjogInAyX3JhaXNlIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfYWN0aXZlIiwKICAgICAgInRvIjogInAyX3JhaXNlIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfcmFpc2UiLAogICAgICAidG8iOiAicDJfYWN0aXZlIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDJfcmFpc2UiLAogICAgICAidG8iOiAicDNfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX3R1cm4iLAogICAgICAidG8iOiAicDNfZm9sZCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwM19mb2xkIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDNfZm9sZCIsCiAgICAgICJ0byI6ICJwNF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDNfdHVybiIsCiAgICAgICJ0byI6ICJwM19jaGVjayIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwM19jaGVjayIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX2NoZWNrIiwKICAgICAgInRvIjogInAzX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX2NoZWNrIiwKICAgICAgInRvIjogInA0X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwM190dXJuIiwKICAgICAgInRvIjogInAzX2NhbGwiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwM19hY3RpdmUiLAogICAgICAidG8iOiAicDNfY2FsbCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX2NhbGwiLAogICAgICAidG8iOiAicDNfYWN0aXZlIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDNfY2FsbCIsCiAgICAgICJ0byI6ICJwNF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDNfdHVybiIsCiAgICAgICJ0byI6ICJwM19yYWlzZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwM19yYWlzZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX3JhaXNlIiwKICAgICAgInRvIjogInAzX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInAzX3JhaXNlIiwKICAgICAgInRvIjogInA0X3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwNF90dXJuIiwKICAgICAgInRvIjogInA0X2ZvbGQiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwNF9hY3RpdmUiLAogICAgICAidG8iOiAicDRfZm9sZCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInA0X2ZvbGQiLAogICAgICAidG8iOiAiYmV0dGluZ19kb25lIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDRfdHVybiIsCiAgICAgICJ0byI6ICJwNF9jaGVjayIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInA0X2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwNF9jaGVjayIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInA0X2NoZWNrIiwKICAgICAgInRvIjogInA0X2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInA0X2NoZWNrIiwKICAgICAgInRvIjogImJldHRpbmdfZG9uZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInA0X3R1cm4iLAogICAgICAidG8iOiAicDRfY2FsbCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInA0X2FjdGl2ZSIsCiAgICAgICJ0byI6ICJwNF9jYWxsIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAicDRfY2FsbCIsCiAgICAgICJ0byI6ICJwNF9hY3RpdmUiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwNF9jYWxsIiwKICAgICAgInRvIjogImJldHRpbmdfZG9uZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInA0X3R1cm4iLAogICAgICAidG8iOiAicDRfcmFpc2UiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwNF9hY3RpdmUiLAogICAgICAidG8iOiAicDRfcmFpc2UiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwNF9yYWlzZSIsCiAgICAgICJ0byI6ICJwNF9hY3RpdmUiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwNF9yYWlzZSIsCiAgICAgICJ0byI6ICJiZXR0aW5nX2RvbmUiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJwcmVmbG9wIiwKICAgICAgInRvIjogImRlYWxfZmxvcCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImJldHRpbmdfZG9uZSIsCiAgICAgICJ0byI6ICJkZWFsX2Zsb3AiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJkZWFsX2Zsb3AiLAogICAgICAidG8iOiAiZmxvcCIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImRlYWxfZmxvcCIsCiAgICAgICJ0byI6ICJwMF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZmxvcCIsCiAgICAgICJ0byI6ICJkZWFsX3R1cm4iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJiZXR0aW5nX2RvbmUiLAogICAgICAidG8iOiAiZGVhbF90dXJuIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZGVhbF90dXJuIiwKICAgICAgInRvIjogInR1cm5fcm91bmQiCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJkZWFsX3R1cm4iLAogICAgICAidG8iOiAicDBfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInR1cm5fcm91bmQiLAogICAgICAidG8iOiAiZGVhbF9yaXZlciIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImJldHRpbmdfZG9uZSIsCiAgICAgICJ0byI6ICJkZWFsX3JpdmVyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZGVhbF9yaXZlciIsCiAgICAgICJ0byI6ICJyaXZlciIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImRlYWxfcml2ZXIiLAogICAgICAidG8iOiAicDBfdHVybiIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogInJpdmVyIiwKICAgICAgInRvIjogImdvX3Nob3dkb3duIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiYmV0dGluZ19kb25lIiwKICAgICAgInRvIjogImdvX3Nob3dkb3duIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZ29fc2hvd2Rvd24iLAogICAgICAidG8iOiAic2hvd2Rvd24iCiAgICB9LAogICAgewogICAgICAiZnJvbSI6ICJzaG93ZG93biIsCiAgICAgICJ0byI6ICJkZXRlcm1pbmVfd2lubmVyIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZGV0ZXJtaW5lX3dpbm5lciIsCiAgICAgICJ0byI6ICJjb21wbGV0ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImNvbXBsZXRlIiwKICAgICAgInRvIjogImVuZF9oYW5kIgogICAgfSwKICAgIHsKICAgICAgImZyb20iOiAiZW5kX2hhbmQiLAogICAgICAidG8iOiAid2FpdGluZyIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImVuZF9oYW5kIiwKICAgICAgInRvIjogInAwX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImVuZF9oYW5kIiwKICAgICAgInRvIjogInAxX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImVuZF9oYW5kIiwKICAgICAgInRvIjogInAyX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImVuZF9oYW5kIiwKICAgICAgInRvIjogInAzX2FjdGl2ZSIKICAgIH0sCiAgICB7CiAgICAgICJmcm9tIjogImVuZF9oYW5kIiwKICAgICAgInRvIjogInA0X2FjdGl2ZSIKICAgIH0KICBdLAogICJldmVudHMiOiBbCiAgICB7CiAgICAgICJpZCI6ICJoYW5kX3N0YXJ0ZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiQSBuZXcgaGFuZCBoYXMgc3RhcnRlZCIsCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiaGFuZF9udW1iZXIiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJkZWFsZXJfcG9zaXRpb24iLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAiZmxvcF9kZWFsdCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJGbG9wIGRlYWx0IiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjYXJkcyIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAidHVybl9kZWFsdCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJUdXJuIGRlYWx0IiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJjYXJkIiwKICAgICAgICAgICJ0eXBlIjogInN0cmluZyIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJyaXZlcl9kZWFsdCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJSaXZlciBkZWFsdCIsCiAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgewogICAgICAgICAgIm5hbWUiOiAiY2FyZCIsCiAgICAgICAgICAidHlwZSI6ICJzdHJpbmciCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDBfZm9sZGVkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAwIGZvbGRlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAwX2NoZWNrZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDAgY2hlY2tlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAwX2NhbGxlZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMCBjYWxsZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnQ2NCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMF9yYWlzZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDAgcmFpc2VkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDFfZm9sZGVkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAxIGZvbGRlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxX2NoZWNrZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDEgY2hlY2tlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAxX2NhbGxlZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMSBjYWxsZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnQ2NCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMV9yYWlzZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDEgcmFpc2VkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDJfZm9sZGVkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAyIGZvbGRlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyX2NoZWNrZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDIgY2hlY2tlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAyX2NhbGxlZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMiBjYWxsZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnQ2NCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwMl9yYWlzZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDIgcmFpc2VkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDNfZm9sZGVkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciAzIGZvbGRlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAzX2NoZWNrZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDMgY2hlY2tlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInAzX2NhbGxlZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgMyBjYWxsZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnQ2NCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwM19yYWlzZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDMgcmFpc2VkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAicDRfZm9sZGVkIiwKICAgICAgImRlc2NyaXB0aW9uIjogIlBsYXllciA0IGZvbGRlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInA0X2NoZWNrZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDQgY2hlY2tlZCIsCiAgICAgICJmaWVsZHMiOiBbXQogICAgfSwKICAgIHsKICAgICAgImlkIjogInA0X2NhbGxlZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJQbGF5ZXIgNCBjYWxsZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogImFtb3VudCIsCiAgICAgICAgICAidHlwZSI6ICJpbnQ2NCIKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICB7CiAgICAgICJpZCI6ICJwNF9yYWlzZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiUGxheWVyIDQgcmFpc2VkIiwKICAgICAgImZpZWxkcyI6IFsKICAgICAgICB7CiAgICAgICAgICAibmFtZSI6ICJhbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAic2hvd2Rvd25fcmVhY2hlZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJTaG93ZG93biByZWFjaGVkIiwKICAgICAgImZpZWxkcyI6IFtdCiAgICB9LAogICAgewogICAgICAiaWQiOiAid2lubmVyX2RldGVybWluZWQiLAogICAgICAiZGVzY3JpcHRpb24iOiAiV2lubmVyIGRldGVybWluZWQiLAogICAgICAiZmllbGRzIjogWwogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogIndpbm5lciIsCiAgICAgICAgICAidHlwZSI6ICJpbnQ2NCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICJuYW1lIjogInBvdF9hbW91bnQiLAogICAgICAgICAgInR5cGUiOiAiaW50NjQiCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgewogICAgICAiaWQiOiAiaGFuZF9lbmRlZCIsCiAgICAgICJkZXNjcmlwdGlvbiI6ICJIYW5kIGVuZGVkIiwKICAgICAgImZpZWxkcyI6IFtdCiAgICB9CiAgXQp9"

	return func(w http.ResponseWriter, r *http.Request) {
		schemaJSON, err := base64.StdEncoding.DecodeString(schemaBase64)
		if err != nil {
			api.Error(w, http.StatusInternalServerError, "schema_decode_error", "Failed to decode schema")
			return
		}
		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusOK)
		w.Write(schemaJSON)
	}
}

