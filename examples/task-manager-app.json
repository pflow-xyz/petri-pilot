{
  "name": "task-manager",
  "version": "1.0.0",
  "description": "A task management application with access control and workflows",
  "entities": [
    {
      "id": "task",
      "name": "Task",
      "description": "A task that can be assigned and tracked",
      "fields": [
        {
          "id": "title",
          "type": "string",
          "required": true
        },
        {
          "id": "description",
          "type": "text"
        },
        {
          "id": "assignee_id",
          "type": "string"
        },
        {
          "id": "priority",
          "type": "string"
        }
      ],
      "states": [
        {
          "id": "draft",
          "initial": true
        },
        {
          "id": "open"
        },
        {
          "id": "in_progress"
        },
        {
          "id": "completed",
          "terminal": true
        },
        {
          "id": "cancelled",
          "terminal": true
        }
      ],
      "actions": [
        {
          "id": "create",
          "from_states": [],
          "to_state": "draft",
          "input": [
            {"id": "title", "type": "string", "required": true},
            {"id": "description", "type": "text"}
          ],
          "http": {
            "method": "POST",
            "path": "/tasks"
          }
        },
        {
          "id": "submit",
          "from_states": ["draft"],
          "to_state": "open",
          "guard": "len(title) > 0",
          "http": {
            "method": "POST",
            "path": "/tasks/{id}/submit"
          }
        },
        {
          "id": "assign",
          "from_states": ["open"],
          "to_state": "in_progress",
          "input": [
            {"id": "assignee_id", "type": "string", "required": true}
          ],
          "effects": [
            {"field": "assignee_id", "value": "assignee_id"}
          ],
          "http": {
            "method": "POST",
            "path": "/tasks/{id}/assign"
          }
        },
        {
          "id": "complete",
          "from_states": ["in_progress"],
          "to_state": "completed",
          "guard": "user.id == assignee_id",
          "http": {
            "method": "POST",
            "path": "/tasks/{id}/complete"
          }
        },
        {
          "id": "cancel",
          "from_states": ["draft", "open", "in_progress"],
          "to_state": "cancelled",
          "http": {
            "method": "POST",
            "path": "/tasks/{id}/cancel"
          }
        }
      ],
      "access": [
        {
          "action": "create",
          "roles": ["user", "admin"]
        },
        {
          "action": "submit",
          "roles": ["user", "admin"],
          "guard": "user.id == assignee_id || role == 'admin'"
        },
        {
          "action": "assign",
          "roles": ["admin"]
        },
        {
          "action": "complete",
          "roles": ["user", "admin"],
          "guard": "user.id == assignee_id"
        },
        {
          "action": "cancel",
          "roles": ["admin"]
        }
      ]
    }
  ],
  "roles": [
    {
      "id": "user",
      "name": "User",
      "description": "Regular user who can create and complete their own tasks"
    },
    {
      "id": "admin",
      "name": "Administrator",
      "description": "Can manage all tasks and assign them to users",
      "inherits": ["user"]
    }
  ],
  "pages": [
    {
      "id": "tasks",
      "name": "Tasks",
      "path": "/tasks",
      "layout": {
        "type": "list",
        "entity": "task"
      }
    },
    {
      "id": "task-detail",
      "name": "Task Detail",
      "path": "/tasks/:id",
      "layout": {
        "type": "detail",
        "entity": "task"
      }
    },
    {
      "id": "new-task",
      "name": "New Task",
      "path": "/tasks/new",
      "layout": {
        "type": "form",
        "entity": "task"
      }
    }
  ],
  "workflows": [
    {
      "id": "task-notification",
      "name": "Task Assignment Notification",
      "description": "Send notification when task is assigned",
      "trigger": {
        "type": "event",
        "entity": "task",
        "action": "assign"
      },
      "steps": [
        {
          "id": "send-email",
          "type": "action",
          "entity": "notification",
          "action": "send",
          "input": {
            "recipient": "assignee_id",
            "subject": "New task assigned",
            "body": "You have been assigned a new task"
          }
        }
      ]
    }
  ]
}
