{
  "name": "loan-application",
  "description": "A loan application workflow: submit → credit check → manual review (if needed) → approve/deny → disbursement → repayment tracking → completion or default",
  "debug": {
    "enabled": true,
    "eval": true
  },
  "blobstore": {
    "enabled": true,
    "maxSize": 52428800,
    "allowedTypes": ["application/json", "application/pdf", "image/*"]
  },
  "comments": {
    "enabled": true,
    "moderation": false,
    "maxLength": 2000
  },
  "tags": {
    "enabled": true,
    "maxTags": 10,
    "predefined": ["urgent", "high-value", "first-time", "returning", "flagged"]
  },
  "activity": {
    "enabled": true,
    "retention": "90d"
  },
  "softDelete": {
    "enabled": true,
    "retention": "30d"
  },
  "places": [
    {"id": "submitted", "description": "Application submitted by customer", "initial": 1},
    {"id": "credit_check", "description": "Automated credit check in progress", "initial": 0},
    {"id": "auto_approved", "description": "Passed automatic approval criteria", "initial": 0},
    {"id": "manual_review", "description": "Requires manual underwriter review", "initial": 0},
    {"id": "approved", "description": "Loan has been approved", "initial": 0},
    {"id": "denied", "description": "Loan application denied", "initial": 0},
    {"id": "disbursed", "description": "Funds have been disbursed", "initial": 0},
    {"id": "repaying", "description": "Loan is being repaid", "initial": 0},
    {"id": "paid_off", "description": "Loan fully repaid", "initial": 0},
    {"id": "defaulted", "description": "Loan has defaulted", "initial": 0}
  ],
  "transitions": [
    {"id": "run_credit_check", "description": "Initiate automated credit check"},
    {"id": "auto_approve", "description": "Automatic approval based on credit score"},
    {"id": "flag_for_review", "description": "Flag application for manual review"},
    {"id": "underwriter_approve", "description": "Underwriter approves the application"},
    {"id": "underwriter_deny", "description": "Underwriter denies the application"},
    {"id": "auto_deny", "description": "Automatic denial based on credit score"},
    {"id": "finalize_approval", "description": "Finalize loan approval"},
    {"id": "disburse", "description": "Disburse loan funds to customer"},
    {"id": "start_repayment", "description": "Begin repayment period"},
    {"id": "make_payment", "description": "Customer makes a payment"},
    {"id": "complete", "description": "Final payment received, loan complete"},
    {"id": "mark_default", "description": "Mark loan as defaulted"}
  ],
  "arcs": [
    {"from": "submitted", "to": "run_credit_check"},
    {"from": "run_credit_check", "to": "credit_check"},
    {"from": "credit_check", "to": "auto_approve"},
    {"from": "auto_approve", "to": "auto_approved"},
    {"from": "credit_check", "to": "flag_for_review"},
    {"from": "flag_for_review", "to": "manual_review"},
    {"from": "credit_check", "to": "auto_deny"},
    {"from": "auto_deny", "to": "denied"},
    {"from": "manual_review", "to": "underwriter_approve"},
    {"from": "underwriter_approve", "to": "approved"},
    {"from": "manual_review", "to": "underwriter_deny"},
    {"from": "underwriter_deny", "to": "denied"},
    {"from": "auto_approved", "to": "finalize_approval"},
    {"from": "finalize_approval", "to": "approved"},
    {"from": "approved", "to": "disburse"},
    {"from": "disburse", "to": "disbursed"},
    {"from": "disbursed", "to": "start_repayment"},
    {"from": "start_repayment", "to": "repaying"},
    {"from": "repaying", "to": "make_payment"},
    {"from": "make_payment", "to": "repaying"},
    {"from": "repaying", "to": "complete"},
    {"from": "complete", "to": "paid_off"},
    {"from": "repaying", "to": "mark_default"},
    {"from": "mark_default", "to": "defaulted"}
  ],
  "roles": [
    {
      "id": "applicant",
      "name": "Applicant",
      "description": "Customer applying for a loan"
    },
    {
      "id": "system",
      "name": "System",
      "description": "Automated credit check and processing system"
    },
    {
      "id": "underwriter",
      "name": "Underwriter",
      "description": "Loan underwriter who reviews applications"
    },
    {
      "id": "admin",
      "name": "Administrator",
      "description": "Full access to all operations",
      "inherits": ["underwriter"]
    }
  ],
  "access": [
    {
      "transition": "run_credit_check",
      "roles": ["system"]
    },
    {
      "transition": "auto_approve",
      "roles": ["system"]
    },
    {
      "transition": "flag_for_review",
      "roles": ["system"]
    },
    {
      "transition": "auto_deny",
      "roles": ["system"]
    },
    {
      "transition": "underwriter_approve",
      "roles": ["underwriter"]
    },
    {
      "transition": "underwriter_deny",
      "roles": ["underwriter"]
    },
    {
      "transition": "finalize_approval",
      "roles": ["system"]
    },
    {
      "transition": "disburse",
      "roles": ["admin"]
    },
    {
      "transition": "start_repayment",
      "roles": ["system"]
    },
    {
      "transition": "make_payment",
      "roles": ["applicant"]
    },
    {
      "transition": "complete",
      "roles": ["system"]
    },
    {
      "transition": "mark_default",
      "roles": ["admin"]
    }
  ],
  "views": [
    {
      "id": "loan-table",
      "name": "Loans List",
      "kind": "table",
      "description": "List view of all loan applications",
      "groups": [
        {
          "id": "columns",
          "fields": [
            {"binding": "application_id", "label": "Application ID", "type": "text", "readonly": true},
            {"binding": "applicant_name", "label": "Applicant", "type": "text", "readonly": true},
            {"binding": "amount", "label": "Amount", "type": "number", "readonly": true},
            {"binding": "status", "label": "Status", "type": "text", "readonly": true},
            {"binding": "submitted_at", "label": "Submitted", "type": "date", "readonly": true}
          ]
        }
      ],
      "actions": ["underwriter_approve", "underwriter_deny", "disburse"]
    },
    {
      "id": "loan-detail",
      "name": "Loan Detail",
      "kind": "detail",
      "description": "Full loan application details",
      "groups": [
        {
          "id": "applicant",
          "name": "Applicant Information",
          "fields": [
            {"binding": "applicant_name", "label": "Name", "type": "text", "readonly": true},
            {"binding": "applicant_email", "label": "Email", "type": "email", "readonly": true},
            {"binding": "applicant_phone", "label": "Phone", "type": "text", "readonly": true},
            {"binding": "annual_income", "label": "Annual Income", "type": "number", "readonly": true}
          ]
        },
        {
          "id": "loan",
          "name": "Loan Details",
          "fields": [
            {"binding": "amount", "label": "Loan Amount", "type": "number", "readonly": true},
            {"binding": "term_months", "label": "Term (Months)", "type": "number", "readonly": true},
            {"binding": "interest_rate", "label": "Interest Rate", "type": "number", "readonly": true},
            {"binding": "purpose", "label": "Purpose", "type": "text", "readonly": true}
          ]
        },
        {
          "id": "credit",
          "name": "Credit Information",
          "fields": [
            {"binding": "credit_score", "label": "Credit Score", "type": "number", "readonly": true},
            {"binding": "debt_to_income", "label": "Debt-to-Income Ratio", "type": "number", "readonly": true}
          ]
        }
      ],
      "actions": ["underwriter_approve", "underwriter_deny", "disburse", "make_payment", "mark_default"]
    },
    {
      "id": "loan-application-form",
      "name": "Loan Application",
      "kind": "form",
      "description": "Form for submitting a loan application",
      "groups": [
        {
          "id": "personal",
          "name": "Personal Information",
          "fields": [
            {"binding": "applicant_name", "label": "Full Name", "type": "text", "required": true},
            {"binding": "applicant_email", "label": "Email", "type": "email", "required": true},
            {"binding": "applicant_phone", "label": "Phone", "type": "text", "required": true}
          ]
        },
        {
          "id": "loan",
          "name": "Loan Request",
          "fields": [
            {"binding": "amount", "label": "Requested Amount", "type": "number", "required": true, "placeholder": "10000"},
            {"binding": "term_months", "label": "Loan Term (Months)", "type": "number", "required": true},
            {"binding": "purpose", "label": "Purpose", "type": "text", "required": true}
          ]
        },
        {
          "id": "income",
          "name": "Income Information",
          "fields": [
            {"binding": "annual_income", "label": "Annual Income", "type": "number", "required": true},
            {"binding": "employer", "label": "Employer", "type": "text", "required": true}
          ]
        }
      ],
      "actions": ["run_credit_check"]
    }
  ]
}
