{
  "name": "order-system",
  "version": "1.0.0",
  "description": "Comprehensive order management system demonstrating all schema features: token/data places, HTTP bindings, event types, guards, arc weights, and constraints",
  "places": [
    {
      "id": "order_id",
      "description": "Unique order identifier",
      "kind": "data",
      "type": "string",
      "persisted": true
    },
    {
      "id": "customer_id",
      "description": "Customer who placed the order",
      "kind": "data",
      "type": "string",
      "persisted": true
    },
    {
      "id": "order_total",
      "description": "Total order amount in cents",
      "kind": "data",
      "type": "int64",
      "initial_value": 0,
      "persisted": true,
      "exported": true
    },
    {
      "id": "notes",
      "description": "Order notes and special instructions",
      "kind": "data",
      "type": "string",
      "initial_value": ""
    },
    {
      "id": "is_priority",
      "description": "Whether this is a priority order",
      "kind": "data",
      "type": "bool",
      "initial_value": false
    },
    {
      "id": "discount_pct",
      "description": "Discount percentage applied",
      "kind": "data",
      "type": "float64",
      "initial_value": 0.0
    },
    {
      "id": "line_items",
      "description": "Product quantities in order (product_id -> quantity)",
      "kind": "data",
      "type": "map[string]int64",
      "exported": true,
      "persisted": true
    },
    {
      "id": "inventory",
      "description": "Available inventory (product_id -> quantity)",
      "kind": "data",
      "type": "map[string]int64",
      "exported": true
    },
    {
      "id": "payments",
      "description": "Payment records (payment_id -> amount)",
      "kind": "data",
      "type": "map[string]int64",
      "persisted": true
    },
    {
      "id": "refunds",
      "description": "Refund records (refund_id -> amount)",
      "kind": "data",
      "type": "map[string]int64",
      "persisted": true
    },
    {
      "id": "product_prices",
      "description": "Product prices (product_id -> price in cents)",
      "kind": "data",
      "type": "map[string]int64"
    },
    {
      "id": "pending",
      "description": "Order created but not yet submitted",
      "kind": "token",
      "initial": 1
    },
    {
      "id": "submitted",
      "description": "Order submitted for processing",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "validated",
      "description": "Order passed validation",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "payment_required",
      "description": "Awaiting payment",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "paid",
      "description": "Payment received",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "ready_to_ship",
      "description": "Order ready for shipment",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "shipped",
      "description": "Order shipped to customer",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "delivered",
      "description": "Order delivered to customer",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "completed",
      "description": "Order fully completed",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "cancelled",
      "description": "Order cancelled",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "refunded",
      "description": "Order refunded",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "approval_tokens",
      "description": "Required approvals for high-value orders",
      "kind": "token",
      "initial": 0
    }
  ],
  "transitions": [
    {
      "id": "create_order",
      "description": "Initialize a new order with customer info",
      "event_type": "OrderCreated",
      "http_method": "POST",
      "http_path": "/orders",
      "bindings": {
        "order_id": "string",
        "customer_id": "string",
        "is_priority": "bool"
      }
    },
    {
      "id": "add_item",
      "description": "Add a product to the order",
      "guard": "inventory[product_id] >= quantity && quantity > 0",
      "event_type": "ItemAdded",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/items",
      "bindings": {
        "product_id": "string",
        "quantity": "int64",
        "unit_price": "int64",
        "line_total": "int64"
      }
    },
    {
      "id": "remove_item",
      "description": "Remove a product from the order",
      "guard": "line_items[product_id] >= quantity && quantity > 0 && order_total >= line_total",
      "event_type": "ItemRemoved",
      "http_method": "DELETE",
      "http_path": "/orders/{order_id}/items/{product_id}",
      "bindings": {
        "product_id": "string",
        "quantity": "int64",
        "line_total": "int64"
      }
    },
    {
      "id": "apply_discount",
      "description": "Apply a discount to the order",
      "guard": "discount >= 0.0 && discount <= 50.0",
      "event_type": "DiscountApplied",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/discount",
      "bindings": {
        "discount": "float64"
      }
    },
    {
      "id": "add_notes",
      "description": "Add special instructions to the order",
      "event_type": "NotesAdded",
      "http_method": "PATCH",
      "http_path": "/orders/{order_id}/notes",
      "bindings": {
        "notes": "string"
      }
    },
    {
      "id": "submit_order",
      "description": "Submit the order for processing",
      "guard": "order_total > 0",
      "event_type": "OrderSubmitted",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/submit"
    },
    {
      "id": "validate_order",
      "description": "Validate order contents and availability",
      "event_type": "OrderValidated",
      "bindings": {}
    },
    {
      "id": "require_approval",
      "description": "Flag high-value orders for approval",
      "guard": "order_total >= 100000",
      "event_type": "ApprovalRequired"
    },
    {
      "id": "approve_order",
      "description": "Approve a high-value order",
      "event_type": "OrderApproved",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/approve",
      "bindings": {
        "approver_id": "string"
      }
    },
    {
      "id": "process_payment",
      "description": "Process customer payment",
      "guard": "amount > 0 && amount <= order_total",
      "event_type": "PaymentProcessed",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/payments",
      "bindings": {
        "payment_id": "string",
        "amount": "int64"
      }
    },
    {
      "id": "confirm_payment",
      "description": "Confirm payment is complete",
      "event_type": "PaymentConfirmed"
    },
    {
      "id": "reserve_inventory",
      "description": "Reserve inventory for the order",
      "event_type": "InventoryReserved"
    },
    {
      "id": "ship_order",
      "description": "Ship the order to customer",
      "event_type": "OrderShipped",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/ship",
      "bindings": {
        "tracking_number": "string",
        "carrier": "string"
      }
    },
    {
      "id": "deliver_order",
      "description": "Mark order as delivered",
      "event_type": "OrderDelivered",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/deliver"
    },
    {
      "id": "complete_order",
      "description": "Mark order as completed",
      "event_type": "OrderCompleted"
    },
    {
      "id": "cancel_order",
      "description": "Cancel the order",
      "event_type": "OrderCancelled",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/cancel",
      "bindings": {
        "reason": "string"
      }
    },
    {
      "id": "request_refund",
      "description": "Request a refund after delivery",
      "guard": "amount > 0 && amount <= order_total",
      "event_type": "RefundRequested",
      "http_method": "POST",
      "http_path": "/orders/{order_id}/refunds",
      "bindings": {
        "refund_id": "string",
        "amount": "int64",
        "reason": "string"
      }
    },
    {
      "id": "process_refund",
      "description": "Process the refund payment",
      "event_type": "RefundProcessed"
    }
  ],
  "arcs": [
    {
      "from": "pending",
      "to": "create_order"
    },
    {
      "from": "create_order",
      "to": "pending"
    },
    {
      "from": "create_order",
      "to": "order_id",
      "value": "order_id"
    },
    {
      "from": "create_order",
      "to": "customer_id",
      "value": "customer_id"
    },
    {
      "from": "create_order",
      "to": "is_priority",
      "value": "is_priority"
    },
    {
      "from": "pending",
      "to": "add_item"
    },
    {
      "from": "add_item",
      "to": "pending"
    },
    {
      "from": "inventory",
      "to": "add_item",
      "keys": ["product_id"],
      "value": "quantity"
    },
    {
      "from": "add_item",
      "to": "line_items",
      "keys": ["product_id"],
      "value": "quantity"
    },
    {
      "from": "product_prices",
      "to": "add_item",
      "keys": ["product_id"],
      "value": "unit_price"
    },
    {
      "from": "add_item",
      "to": "order_total",
      "value": "line_total"
    },
    {
      "from": "pending",
      "to": "remove_item"
    },
    {
      "from": "remove_item",
      "to": "pending"
    },
    {
      "from": "line_items",
      "to": "remove_item",
      "keys": ["product_id"],
      "value": "quantity"
    },
    {
      "from": "remove_item",
      "to": "inventory",
      "keys": ["product_id"],
      "value": "quantity"
    },
    {
      "from": "order_total",
      "to": "remove_item",
      "value": "line_total"
    },
    {
      "from": "pending",
      "to": "apply_discount"
    },
    {
      "from": "apply_discount",
      "to": "pending"
    },
    {
      "from": "apply_discount",
      "to": "discount_pct",
      "value": "discount"
    },
    {
      "from": "pending",
      "to": "add_notes"
    },
    {
      "from": "add_notes",
      "to": "pending"
    },
    {
      "from": "add_notes",
      "to": "notes",
      "value": "notes"
    },
    {
      "from": "pending",
      "to": "submit_order"
    },
    {
      "from": "submit_order",
      "to": "submitted"
    },
    {
      "from": "submitted",
      "to": "validate_order"
    },
    {
      "from": "validate_order",
      "to": "validated"
    },
    {
      "from": "validated",
      "to": "require_approval"
    },
    {
      "from": "require_approval",
      "to": "payment_required"
    },
    {
      "from": "require_approval",
      "to": "approval_tokens",
      "weight": 2
    },
    {
      "from": "approval_tokens",
      "to": "approve_order"
    },
    {
      "from": "approve_order",
      "to": "payment_required"
    },
    {
      "from": "validated",
      "to": "process_payment"
    },
    {
      "from": "process_payment",
      "to": "payment_required"
    },
    {
      "from": "process_payment",
      "to": "payments",
      "keys": ["payment_id"],
      "value": "amount"
    },
    {
      "from": "payment_required",
      "to": "process_payment"
    },
    {
      "from": "process_payment",
      "to": "payment_required"
    },
    {
      "from": "payment_required",
      "to": "confirm_payment"
    },
    {
      "from": "confirm_payment",
      "to": "paid"
    },
    {
      "from": "paid",
      "to": "reserve_inventory"
    },
    {
      "from": "reserve_inventory",
      "to": "ready_to_ship"
    },
    {
      "from": "ready_to_ship",
      "to": "ship_order"
    },
    {
      "from": "ship_order",
      "to": "shipped"
    },
    {
      "from": "shipped",
      "to": "deliver_order"
    },
    {
      "from": "deliver_order",
      "to": "delivered"
    },
    {
      "from": "delivered",
      "to": "complete_order"
    },
    {
      "from": "complete_order",
      "to": "completed"
    },
    {
      "from": "pending",
      "to": "cancel_order"
    },
    {
      "from": "cancel_order",
      "to": "cancelled"
    },
    {
      "from": "submitted",
      "to": "cancel_order"
    },
    {
      "from": "payment_required",
      "to": "cancel_order"
    },
    {
      "from": "delivered",
      "to": "request_refund"
    },
    {
      "from": "request_refund",
      "to": "delivered"
    },
    {
      "from": "request_refund",
      "to": "refunds",
      "keys": ["refund_id"],
      "value": "amount"
    },
    {
      "from": "delivered",
      "to": "process_refund"
    },
    {
      "from": "process_refund",
      "to": "refunded"
    }
  ],
  "constraints": [
    {
      "id": "single_state",
      "expr": "pending + submitted + validated + payment_required + paid + ready_to_ship + shipped + delivered + completed + cancelled + refunded <= 1"
    },
    {
      "id": "non_negative_total",
      "expr": "order_total >= 0"
    },
    {
      "id": "valid_discount",
      "expr": "discount_pct >= 0.0 && discount_pct <= 100.0"
    },
    {
      "id": "approval_invariant",
      "expr": "approval_tokens >= 0 && approval_tokens <= 2"
    }
  ]
}
