{
  "name": "token-ledger",
  "description": "A token ledger demonstrating ORM patterns with guards, data state, and simple types",
  "places": [
    {
      "id": "name",
      "description": "Token name (e.g., 'My Token')",
      "kind": "data",
      "type": "string"
    },
    {
      "id": "symbol",
      "description": "Token symbol (e.g., 'MTK')",
      "kind": "data",
      "type": "string"
    },
    {
      "id": "totalSupply",
      "description": "Total supply of tokens",
      "kind": "data",
      "type": "int64",
      "initial": 0
    },
    {
      "id": "balances",
      "description": "Token balances by address",
      "kind": "data",
      "type": "map[string]int64",
      "exported": true
    },
    {
      "id": "allowances",
      "description": "Approved allowances (owner -> spender -> amount)",
      "kind": "data",
      "type": "map[string]map[string]int64"
    },
    {
      "id": "uninitialized",
      "description": "Control flow: ledger not yet initialized",
      "kind": "token",
      "initial": 1
    },
    {
      "id": "initialized",
      "description": "Control flow: ledger initialized",
      "kind": "token",
      "initial": 0
    },
    {
      "id": "active",
      "description": "Control flow: ledger is active",
      "kind": "token",
      "initial": 0
    }
  ],
  "transitions": [
    {
      "id": "initialize",
      "description": "Initialize the token with name and symbol",
      "guard": "name != \"\" && symbol != \"\"",
      "bindings": {
        "name": "string",
        "symbol": "string"
      }
    },
    {
      "id": "mint",
      "description": "Mint new tokens to an address",
      "guard": "amount > 0",
      "bindings": {
        "to": "address",
        "amount": "amount"
      }
    },
    {
      "id": "transfer",
      "description": "Transfer tokens from one address to another",
      "guard": "balances[from] >= amount && amount > 0",
      "bindings": {
        "from": "address",
        "to": "address",
        "amount": "amount"
      }
    },
    {
      "id": "approve",
      "description": "Approve spender to transfer tokens on behalf of owner",
      "guard": "amount >= 0",
      "bindings": {
        "owner": "address",
        "spender": "address",
        "amount": "amount"
      }
    },
    {
      "id": "transferFrom",
      "description": "Transfer tokens using an allowance",
      "guard": "balances[from] >= amount && allowances[from][spender] >= amount && amount > 0",
      "bindings": {
        "from": "address",
        "spender": "address",
        "to": "address",
        "amount": "amount"
      }
    },
    {
      "id": "burn",
      "description": "Burn tokens from an address",
      "guard": "balances[from] >= amount && amount > 0",
      "bindings": {
        "from": "address",
        "amount": "amount"
      }
    }
  ],
  "arcs": [
    {
      "from": "uninitialized",
      "to": "initialize"
    },
    {
      "from": "initialize",
      "to": "initialized"
    },
    {
      "from": "initialize",
      "to": "name",
      "value": "name"
    },
    {
      "from": "initialize",
      "to": "symbol",
      "value": "symbol"
    },
    {
      "from": "initialized",
      "to": "mint"
    },
    {
      "from": "mint",
      "to": "active"
    },
    {
      "from": "mint",
      "to": "balances",
      "keys": ["to"],
      "value": "amount"
    },
    {
      "from": "mint",
      "to": "totalSupply",
      "value": "amount"
    },
    {
      "from": "active",
      "to": "transfer"
    },
    {
      "from": "transfer",
      "to": "active"
    },
    {
      "from": "balances",
      "to": "transfer",
      "keys": ["from"],
      "value": "amount"
    },
    {
      "from": "transfer",
      "to": "balances",
      "keys": ["to"],
      "value": "amount"
    },
    {
      "from": "active",
      "to": "approve"
    },
    {
      "from": "approve",
      "to": "active"
    },
    {
      "from": "approve",
      "to": "allowances",
      "keys": ["owner", "spender"],
      "value": "amount"
    },
    {
      "from": "active",
      "to": "transferFrom"
    },
    {
      "from": "transferFrom",
      "to": "active"
    },
    {
      "from": "balances",
      "to": "transferFrom",
      "keys": ["from"],
      "value": "amount"
    },
    {
      "from": "allowances",
      "to": "transferFrom",
      "keys": ["from", "spender"],
      "value": "amount"
    },
    {
      "from": "transferFrom",
      "to": "balances",
      "keys": ["to"],
      "value": "amount"
    },
    {
      "from": "active",
      "to": "burn"
    },
    {
      "from": "burn",
      "to": "active"
    },
    {
      "from": "balances",
      "to": "burn",
      "keys": ["from"],
      "value": "amount"
    },
    {
      "from": "totalSupply",
      "to": "burn",
      "value": "amount"
    }
  ],
  "constraints": [
    {
      "id": "non_negative_supply",
      "expr": "totalSupply >= 0"
    }
  ]
}
